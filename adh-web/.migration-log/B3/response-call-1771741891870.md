J'ai analysé le code généré pour le programme ADH IDE 127 (Calcul solde ouverture WS) par rapport au contrat et à la spécification. Voici le rapport JSON de validation :

```json
{
  "programId": 127,
  "programName": "Calcul solde ouverture WS",
  "coveragePct": 75,
  "rulesImplemented": 0,
  "rulesTotal": 0,
  "missingRules": [],
  "recommendations": [
    "Appel externe manquant : L'appel à ADH IDE 142 (Devise update session WS) n'est pas implémenté. Le programme original appelle ce service pour actualiser les taux de change avant le calcul, ce qui est critique pour garantir des conversions exactes.",
    "Validation manquante : Aucune validation des montants négatifs dans le store (détectée uniquement dans l'UI). Les règles métier de validation devraient être dans le store, pas seulement dans le composant.",
    "Tables manquantes : 4/4 tables ont le statut MISSING dans le contrat (moyens_reglement_mor (2x), histo_sessions_caisse_detail, gestion_devise_session). Les entités TypeScript existent mais aucune connexion avec les vraies tables n'est documentée.",
    "Tolérance cohérence hardcodée : Le seuil COHERENCE_TOLERANCE (0.01) est défini dans types mais devrait être paramétrable depuis la configuration backend.",
    "Mock data incomplet : Les MOCK_MOYENS_REGLEMENT et MOCK_DEVISES_SESSIONS sont statiques. Il manque une génération dynamique basée sur les paramètres d'entrée (nbreDevise, soldeOuvertureMonnaie, etc.).",
    "Séparation des responsabilités : La fonction detectAnomalies() est dupliquée dans SoldeOuverturePage et CalculationResultsPanel. Elle devrait être extraite dans un module utils/validation.",
    "Gestion d'erreur incomplète : Les codes d'erreur définis (SoldeOuvertureErrorCode) ne sont pas utilisés dans le store. Les erreurs sont simplement des strings génériques.",
    "Callee manquant : Contrairement à la spec qui mentionne 'Appelle 1 programme', le code ne fait aucun appel au programme ADH IDE 142 pour la mise à jour des taux avant calcul."
  ]
}
```

## Analyse détaillée

### Points forts ✅

1. **Structure globale correcte** : Types, store Zustand, endpoints API, composants UI bien organisés
2. **Mocking fonctionnel** : Système de mock/API réel via `isRealApi` bien implémenté
3. **Gestion état complet** : Store couvre tous les besoins (loading, error, calculation, validation)
4. **UI riche** : Détection anomalies (taux invalides, montants négatifs), validation cohérence, tableaux de conversion détaillés
5. **Types exhaustifs** : Entities, calculation types, requests/responses, error codes bien définis

### Problèmes critiques ⚠️

1. **Callee ADH IDE 142 non appelé** : La spec mentionne explicitement "appelle ADH IDE 142 (Devise update session WS) qui actualise les taux de change". Ce n'est **jamais invoqué** avant le calcul dans `calculerSoldeOuverture()`.

2. **Tables MISSING** : Les 4 tables du contrat ont toutes `status: MISSING` et `target_file: ""`. Aucune implémentation backend documentée.

3. **Validation métier dans l'UI** : `detectAnomalies()` devrait être dans le store ou un service métier, pas dans les composants React. Actuellement dupliquée entre `SoldeOuverturePage.tsx` et `CalculationResultsPanel.tsx`.

4. **Erreurs non typées** : Les `SoldeOuvertureErrorCode` sont définis mais jamais utilisés. Le store set juste `error: string`.

### Recommandations d'implémentation

```typescript
// store : ajouter appel à updateDeviseSession AVANT calcul
calculerSoldeOuverture: async (societe, sessionId) => {
  // 1. MAJ taux AVANT calcul (critique selon spec)
  await updateDeviseSession(sessionId);
  
  // 2. Calcul avec taux actualisés
  const response = await apiClient.post<ApiResponse<SoldeCalculationResult>>(
    '/api/solde-ouverture/calculer',
    { societe, sessionId }
  );
  // ...
}
```

```typescript
// utils/soldeOuverture.validation.ts : centraliser validations
export const validateDeviseConversions = (details: DeviseConversion[]): ValidationResult => {
  const errors: SoldeOuvertureError[] = [];
  
  details.forEach(d => {
    if (d.tauxChange <= 0) {
      errors.push({
        code: 'MISSING_CURRENCY_RATE',
        message: `Taux invalide pour ${d.devise}`,
        details: d
      });
    }
    // ...
  });
  
  return { valid: errors.length === 0, errors };
};
```

Le code est **fonctionnel pour un MVP** mais n'implémente pas fidèlement le flux décrit dans la spec (appel à IDE 142 manquant) et les 4 tables backend restent non mappées.
```json
{
  "domain": "recapFermeture",
  "domainPascal": "RecapFermeture",
  "complexity": "MEDIUM",
  "entities": [
    {
      "name": "RecapFermeture",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "gestion_devise_session.societe",
          "nullable": false
        },
        {
          "name": "session",
          "type": "number",
          "source": "gestion_devise_session.session (EV)",
          "nullable": false
        },
        {
          "name": "deviseLocale",
          "type": "string",
          "source": "gestion_devise_session.devise_locale (ER)",
          "nullable": false
        },
        {
          "name": "dateDebut",
          "type": "Date",
          "source": "gestion_devise_session.date_debut (FY)",
          "nullable": false
        },
        {
          "name": "heureDebut",
          "type": "string",
          "source": "gestion_devise_session.heure_debut (FZ)",
          "nullable": false
        },
        {
          "name": "nbreDeviseOuverture",
          "type": "number",
          "source": "gestion_devise_session.nbre_devise_ouverture (EN)",
          "nullable": false
        },
        {
          "name": "nbreDeviseFermeture",
          "type": "number",
          "source": "gestion_devise_session.nbre_devise_fermeture (EO)",
          "nullable": false
        },
        {
          "name": "nbreDevisesCalcule",
          "type": "number",
          "source": "gestion_devise_session.nbre_devises_calcule (FO)",
          "nullable": false
        },
        {
          "name": "nbreDevisesCompte",
          "type": "number",
          "source": "gestion_devise_session.nbre_devises_compte (FH)",
          "nullable": false
        }
      ]
    },
    {
      "name": "LigneRecap",
      "fields": [
        {
          "name": "typeOperation",
          "type": "string",
          "source": "computed",
          "nullable": false
        },
        {
          "name": "montantDevise",
          "type": "number",
          "source": "various tables",
          "nullable": false
        },
        {
          "name": "codeDevise",
          "type": "string",
          "source": "devise_in.code",
          "nullable": false
        },
        {
          "name": "tauxChange",
          "type": "number",
          "source": "change___chg.taux",
          "nullable": true
        },
        {
          "name": "montantEquivalent",
          "type": "number",
          "source": "computed via IDE 22",
          "nullable": false
        },
        {
          "name": "ecart",
          "type": "number",
          "source": "computed",
          "nullable": true
        }
      ]
    },
    {
      "name": "RemiseEnCaisse",
      "fields": [
        {
          "name": "detailProduitRemiseEdite",
          "type": "boolean",
          "source": "saisie_remise_en_caisse.detail_produit_remise_edite (EW)",
          "nullable": false
        },
        {
          "name": "montantRemiseMonnaie",
          "type": "number",
          "source": "saisie_remise_en_caisse.montant_remise_monnaie_final (EX)",
          "nullable": false
        },
        {
          "name": "detailRemiseFinaleEdite",
          "type": "boolean",
          "source": "saisie_remise_en_caisse.detail_remise_finale_edite (EY)",
          "nullable": false
        }
      ]
    },
    {
      "name": "ArticleSession",
      "fields": [
        {
          "name": "chronoHisto",
          "type": "number",
          "source": "histo_sessions_caisse_article.dernier_chrono (EN)",
          "nullable": false
        },
        {
          "name": "totalArticles",
          "type": "number",
          "source": "histo_sessions_caisse_article.total_articles (EQ)",
          "nullable": false
        },
        {
          "name": "codeArticle",
          "type": "string",
          "source": "articles_art.code",
          "nullable": false
        },
        {
          "name": "libelleArticle",
          "type": "string",
          "source": "articles_art.libelle",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "recap",
      "type": "RecapFermeture | null",
      "default": "null"
    },
    {
      "name": "lignesRecap",
      "type": "LigneRecap[]",
      "default": "[]"
    },
    {
      "name": "remises",
      "type": "RemiseEnCaisse[]",
      "default": "[]"
    },
    {
      "name": "articles",
      "type": "ArticleSession[]",
      "default": "[]"
    },
    {
      "name": "isLoading",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "isPrinting",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "modeReimpression",
      "type": "'D' | 'G' | null",
      "default": "null"
    },
    {
      "name": "printerCourant",
      "type": "number | null",
      "default": "null"
    },
    {
      "name": "finTache",
      "type": "boolean",
      "default": "false"
    }
  ],
  "actions": [
    {
      "name": "loadRecapFermeture",
      "params": [
        "societe: string",
        "session: number"
      ],
      "businessRules": [
        "RM-001: Vérifie si W0 fin tache = 'F' pour déterminer l'état de finalisation",
        "Charge les données de la session depuis gestion_devise_session",
        "Consolide les mouvements financiers depuis histo_sessions_caisse_detail",
        "Calcule les équivalents de change via IDE 22 (Calcul equivalent)"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "genererTableau",
      "params": [
        "societe: string",
        "session: number"
      ],
      "businessRules": [
        "RM-002: Vérifie que l'imprimante courante est la n°1",
        "RM-003: Vérifie que l'imprimante courante est la n°9",
        "Récupère le titre de la session via IDE 43",
        "Configure les paramètres d'impression (IDE 180, 181, 182)",
        "Génère le document récapitulatif avec colonnes organisées par devise"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "calculerEquivalent",
      "params": [
        "montant: number",
        "deviseSource: string",
        "deviseCible: string"
      ],
      "businessRules": [
        "Appelle IDE 22 (Calcul equivalent) pour harmoniser les montants",
        "Utilise les taux de change depuis change___chg",
        "Retourne le montant converti en devise de base"
      ],
      "returns": "Promise<number>"
    },
    {
      "name": "saveRemise",
      "params": [
        "remise: RemiseEnCaisse"
      ],
      "businessRules": [
        "Persiste les remises saisies dans saisie_remise_en_caisse",
        "Met à jour les flags d'édition (detailProduitRemiseEdite, detailRemiseFinaleEdite)",
        "Enregistre le montant final de remise monnaie"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "saveDiscount",
      "params": [
        "discount: any"
      ],
      "businessRules": [
        "Persiste les discounts dans pv_discounts",
        "Valide les montants avant enregistrement"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "setModeReimpression",
      "params": [
        "mode: 'D' | 'G' | null"
      ],
      "businessRules": [
        "RM-004: Condition toujours vraie si mode = 'D'",
        "RM-005: Vérifie que mode <> '' avant de l'appliquer",
        "Configure le mode de réimpression (Droite/Gauche)"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "checkPrinter",
      "params": [
        "printerNum: number"
      ],
      "businessRules": [
        "RM-002: Retourne true si printerNum = 1",
        "RM-003: Retourne true si printerNum = 9",
        "Vérifie la disponibilité de l'imprimante"
      ],
      "returns": "Promise<boolean>"
    },
    {
      "name": "exportRecap",
      "params": [
        "format: 'PDF' | 'EXCEL'"
      ],
      "businessRules": [
        "Exporte le tableau récapitulatif au format demandé",
        "Inclut tous les mouvements financiers de la session",
        "Préserve la mise en forme (colonnes, totaux, écarts)"
      ],
      "returns": "Promise<Blob>"
    }
  ],
  "apiEndpoints": [
    {
      "method": "GET",
      "path": "/api/recap-fermeture/{societe}/{session}",
      "queryParams": [],
      "response": "RecapFermeture"
    },
    {
      "method": "GET",
      "path": "/api/recap-fermeture/{societe}/{session}/lignes",
      "queryParams": [],
      "response": "LigneRecap[]"
    },
    {
      "method": "GET",
      "path": "/api/recap-fermeture/{societe}/{session}/remises",
      "queryParams": [],
      "response": "RemiseEnCaisse[]"
    },
    {
      "method": "GET",
      "path": "/api/recap-fermeture/{societe}/{session}/articles",
      "queryParams": [],
      "response": "ArticleSession[]"
    },
    {
      "method": "POST",
      "path": "/api/recap-fermeture/remise",
      "queryParams": [],
      "response": "{ success: boolean }"
    },
    {
      "method": "POST",
      "path": "/api/recap-fermeture/discount",
      "queryParams": [],
      "response": "{ success: boolean }"
    },
    {
      "method": "POST",
      "path": "/api/recap-fermeture/generer",
      "queryParams": [],
      "response": "{ success: boolean, documentUrl?: string }"
    },
    {
      "method": "POST",
      "path": "/api/recap-fermeture/calculer-equivalent",
      "queryParams": [],
      "response": "{ montantEquivalent: number }"
    },
    {
      "method": "GET",
      "path": "/api/recap-fermeture/{societe}/{session}/export",
      "queryParams": [
        "format?"
      ],
      "response": "Blob"
    }
  ],
  "uiLayout": {
    "type": "report-page",
    "sections": [
      {
        "name": "header",
        "controls": [
          "sessionInfo",
          "dateHeureDebut",
          "deviseLocale",
          "printControls"
        ]
      },
      {
        "name": "tableauRecap",
        "controls": [
          "gridLignesRecap",
          "colonnesDevises",
          "totauxParDevise",
          "ecartsDetectes"
        ]
      },
      {
        "name": "remises",
        "controls": [
          "gridRemises",
          "montantRemiseMonnaie",
          "flagsEdition"
        ]
      },
      {
        "name": "articles",
        "controls": [
          "gridArticles",
          "totalArticles"
        ]
      },
      {
        "name": "footer",
        "controls": [
          "totauxGeneraux",
          "validationIntegrite",
          "exportButtons"
        ]
      }
    ]
  },
  "mockData": {
    "count": 5,
    "description": "Mock data for recap fermeture: 5 sessions with lignes recap (10-15 lignes each), remises (3-5 per session), articles sold (8-12 types), totaux by devise (EUR, USD, GBP), ecarts flagged when detected, printer settings (1 or 9), reimpression mode (D/G)"
  },
  "dependencies": {
    "stores": [
      "useSessionStore",
      "useDeviseStore",
      "usePrinterStore"
    ],
    "sharedTypes": [
      "Session",
      "Devise",
      "MoyenReglement"
    ],
    "externalApis": [
      "IDE 22 - Calcul equivalent (calcul de change)",
      "IDE 43 - Recuperation du titre",
      "IDE 180 - Printer choice",
      "IDE 181 - Set Listing Number",
      "IDE 182 - Raz Current Printer"
    ]
  }
}
```
```typescript
import { describe, it, expect, vi, beforeEach } from 'vitest';
import { render, screen, fireEvent, waitFor } from '@testing-library/react';

const mockStore = {
  emails: [],
  selectedEmail: null,
  isLoading: false,
  error: null,
  filters: {
    societe: '',
    compte: '',
    filiation: null,
    email: '',
  },
  searchEmails: vi.fn(),
  createEmail: vi.fn(),
  updateEmail: vi.fn(),
  deleteEmail: vi.fn(),
  setAsPrincipal: vi.fn(),
  selectEmail: vi.fn(),
  setFilters: vi.fn(),
  clearFilters: vi.fn(),
  resetState: vi.fn(),
};

vi.mock('@/stores/emailSearchStore', () => ({
  useEmailSearchStore: vi.fn((selector) => selector(mockStore)),
}));

vi.mock('@/components/layout', () => ({
  ScreenLayout: ({ children }: { children: React.ReactNode }) => <div>{children}</div>,
}));

vi.mock('@/components/ui', () => ({
  Button: ({ children, onClick, disabled, variant, size }: unknown) => (
    <button onClick={onClick as () => void} disabled={disabled as boolean}>
      {children as React.ReactNode}
    </button>
  ),
  Input: ({ label, value, onChange, placeholder, type, disabled, required }: unknown) => (
    <div>
      <label htmlFor={label as string}>{label as string}</label>
      <input
        id={label as string}
        value={value as string}
        onChange={onChange as (e: React.ChangeEvent<HTMLInputElement>) => void}
        placeholder={placeholder as string}
        type={type as string}
        disabled={disabled as boolean}
        required={required as boolean}
      />
    </div>
  ),
  Dialog: ({ open, onClose, title, children }: unknown) =>
    (open as boolean) ? (
      <div role="dialog">
        <h2>{title as string}</h2>
        <button onClick={onClose as () => void}>Close</button>
        {children as React.ReactNode}
      </div>
    ) : null,
}));

vi.mock('@/lib/utils', () => ({
  cn: (...args: unknown[]) => args.filter(Boolean).join(' '),
}));

import { EmailSearchPage } from '@/pages/EmailSearchPage';
import type { EmailAddress } from '@/types/emailSearch';

describe('EmailSearchPage', () => {
  beforeEach(() => {
    vi.clearAllMocks();
    mockStore.emails = [];
    mockStore.selectedEmail = null;
    mockStore.isLoading = false;
    mockStore.error = null;
    mockStore.filters = {
      societe: '',
      compte: '',
      filiation: null,
      email: '',
    };
  });

  it('renders without crashing', () => {
    render(<EmailSearchPage />);
    expect(screen.getByText('Recherche d\'adresses email')).toBeInTheDocument();
    expect(screen.getByText('Gérer les adresses email des adhérents')).toBeInTheDocument();
  });

  it('displays loading state', () => {
    mockStore.isLoading = true;
    render(<EmailSearchPage />);
    expect(screen.getByText('Chargement des adresses email...')).toBeInTheDocument();
  });

  it('displays empty state when no emails', () => {
    mockStore.emails = [];
    render(<EmailSearchPage />);
    expect(
      screen.getByText(
        'Aucune adresse email trouvée. Utilisez les filtres ou ajoutez-en une nouvelle.',
      ),
    ).toBeInTheDocument();
  });

  it('displays error state', () => {
    mockStore.error = 'Erreur de chargement';
    render(<EmailSearchPage />);
    expect(screen.getByText('Erreur de chargement')).toBeInTheDocument();
  });

  it('displays emails when loaded', () => {
    const mockEmails: EmailAddress[] = [
      {
        id: 1,
        societe: 'SKI',
        compte: '100001',
        filiation: 0,
        email: 'test@example.com',
        isPrincipal: true,
        createdAt: new Date('2024-01-01'),
        updatedAt: new Date('2024-01-02'),
      },
      {
        id: 2,
        societe: 'EXCHANGE',
        compte: '100002',
        filiation: 1,
        email: 'autre@example.com',
        isPrincipal: false,
        createdAt: new Date('2024-01-03'),
        updatedAt: null,
      },
    ];
    mockStore.emails = mockEmails;

    render(<EmailSearchPage />);

    expect(screen.getByText('Résultats (2 adresses)')).toBeInTheDocument();
    expect(screen.getByText('test@example.com')).toBeInTheDocument();
    expect(screen.getByText('autre@example.com')).toBeInTheDocument();
    expect(screen.getByText('SKI')).toBeInTheDocument();
    expect(screen.getByText('EXCHANGE')).toBeInTheDocument();
  });

  it('handles search button click', async () => {
    render(<EmailSearchPage />);

    const searchButton = screen.getByText('Rechercher');
    fireEvent.click(searchButton);

    await waitFor(() => {
      expect(mockStore.searchEmails).toHaveBeenCalledWith(mockStore.filters);
    });
  });

  it('handles clear filters button click', () => {
    render(<EmailSearchPage />);

    const clearButton = screen.getByText('Réinitialiser');
    fireEvent.click(clearButton);

    expect(mockStore.clearFilters).toHaveBeenCalled();
  });

  it('handles filter input changes', () => {
    render(<EmailSearchPage />);

    const societeInput = screen.getByPlaceholderText('SKI, EXCHANGE...');
    fireEvent.change(societeInput, { target: { value: 'SKI' } });

    expect(mockStore.setFilters).toHaveBeenCalledWith({
      ...mockStore.filters,
      societe: 'SKI',
    });
  });

  it('handles row selection', () => {
    const mockEmail: EmailAddress = {
      id: 1,
      societe: 'SKI',
      compte: '100001',
      filiation: 0,
      email: 'test@example.com',
      isPrincipal: true,
      createdAt: new Date('2024-01-01'),
      updatedAt: null,
    };
    mockStore.emails = [mockEmail];

    render(<EmailSearchPage />);

    const row = screen.getByText('test@example.com').closest('tr');
    if (row) {
      fireEvent.click(row);
      expect(mockStore.selectEmail).toHaveBeenCalledWith(mockEmail);
    }
  });

  it('opens add dialog', () => {
    render(<EmailSearchPage />);

    const addButton = screen.getByText('Ajouter');
    fireEvent.click(addButton);

    expect(screen.getByRole('dialog')).toBeInTheDocument();
    expect(screen.getByText('Ajouter une adresse email')).toBeInTheDocument();
  });

  it('opens edit dialog when email selected', () => {
    const mockEmail: EmailAddress = {
      id: 1,
      societe: 'SKI',
      compte: '100001',
      filiation: 0,
      email: 'test@example.com',
      isPrincipal: true,
      createdAt: new Date('2024-01-01'),
      updatedAt: null,
    };
    mockStore.selectedEmail = mockEmail;

    render(<EmailSearchPage />);

    const editButton = screen.getByText('Modifier');
    fireEvent.click(editButton);

    expect(screen.getByRole('dialog')).toBeInTheDocument();
    expect(screen.getByText('Modifier une adresse email')).toBeInTheDocument();
  });

  it('handles delete with confirmation', async () => {
    const mockEmail: EmailAddress = {
      id: 1,
      societe: 'SKI',
      compte: '100001',
      filiation: 0,
      email: 'test@example.com',
      isPrincipal: false,
      createdAt: new Date('2024-01-01'),
      updatedAt: null,
    };
    mockStore.selectedEmail = mockEmail;

    global.confirm = vi.fn(() => true);

    render(<EmailSearchPage />);

    const deleteButton = screen.getByText('Supprimer');
    fireEvent.click(deleteButton);

    await waitFor(() => {
      expect(global.confirm).toHaveBeenCalledWith(
        'Confirmer la suppression de cette adresse email ?',
      );
      expect(mockStore.deleteEmail).toHaveBeenCalledWith(1);
      expect(mockStore.selectEmail).toHaveBeenCalledWith(null);
    });
  });

  it('handles set as principal', async () => {
    const mockEmail: EmailAddress = {
      id: 1,
      societe: 'SKI',
      compte: '100001',
      filiation: 0,
      email: 'test@example.com',
      isPrincipal: false,
      createdAt: new Date('2024-01-01'),
      updatedAt: null,
    };
    mockStore.selectedEmail = mockEmail;

    render(<EmailSearchPage />);

    const setPrincipalButton = screen.getByText('Définir principal');
    fireEvent.click(setPrincipalButton);

    await waitFor(() => {
      expect(mockStore.setAsPrincipal).toHaveBeenCalledWith(1);
    });
  });

  it('handles create email from dialog', async () => {
    render(<EmailSearchPage />);

    const addButton = screen.getByText('Ajouter');
    fireEvent.click(addButton);

    const emailInput = screen.getByLabelText('Email');
    fireEvent.change(emailInput, { target: { value: 'new@example.com' } });

    const saveButton = screen.getAllByText('Créer')[0];
    fireEvent.click(saveButton);

    await waitFor(() => {
      expect(mockStore.createEmail).toHaveBeenCalled();
    });
  });

  it('handles update email from dialog', async () => {
    const mockEmail: EmailAddress = {
      id: 1,
      societe: 'SKI',
      compte: '100001',
      filiation: 0,
      email: 'test@example.com',
      isPrincipal: false,
      createdAt: new Date('2024-01-01'),
      updatedAt: null,
    };
    mockStore.selectedEmail = mockEmail;

    render(<EmailSearchPage />);

    const editButton = screen.getByText('Modifier');
    fireEvent.click(editButton);

    const emailInput = screen.getByLabelText('Email');
    fireEvent.change(emailInput, { target: { value: 'updated@example.com' } });

    const saveButton = screen.getAllByText('Modifier')[1];
    fireEvent.click(saveButton);

    await waitFor(() => {
      expect(mockStore.updateEmail).toHaveBeenCalledWith(1, {
        email: 'updated@example.com',
        isPrincipal: false,
      });
    });
  });

  it('calls resetState on unmount', () => {
    const { unmount } = render(<EmailSearchPage />);
    unmount();
    expect(mockStore.resetState).toHaveBeenCalled();
  });
});
```
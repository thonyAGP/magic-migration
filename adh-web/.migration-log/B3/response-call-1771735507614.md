```typescript
import { create } from 'zustand';
import type {
  ProgramDispatchRoute,
  LastClickedResponse,
} from '@/types/programDispatch';
import { apiClient } from '@/services/api/apiClient';
import type { ApiResponse } from '@/services/api/apiClient';
import { useDataSourceStore } from './dataSourceStore';

interface ProgramDispatchState {
  lastClickedControl: string | null;
  isDispatching: boolean;
  error: string | null;
}

interface ProgramDispatchActions {
  dispatchToProgram: (controlId: string) => Promise<void>;
  getLastClickedControl: () => Promise<string | null>;
  clearDispatch: () => void;
  reset: () => void;
}

type ProgramDispatchStore = ProgramDispatchState & ProgramDispatchActions;

const MOCK_ROUTES: Record<string, string> = {
  BTN_CHANGE: 'ADH-25',
  BTN_DEPOT: 'ADH-40',
  BTN_GARANTIE: 'ADH-111',
  BTN_GRATUITES: 'ADH-168',
  BTN_VERSEMENT: 'ADH-174',
  BTN_TELEPHONE: 'ADH-217',
  BTN_MENU_COMPTE: 'ADH-37',
  BTN_EXTRAIT: 'ADH-69',
  BTN_CMP: 'ADH-77',
  BTN_BAR_LIMIT: 'ADH-86',
  BTN_GM_MENU: 'ADH-158',
  BTN_CAISSE_GM: 'ADH-163',
  BTN_FORFAIT_TAI: 'ADH-173',
  BTN_SOLDE: 'ADH-190',
  BTN_IMPRESSION: 'ADH-214',
  BTN_VENTE: 'ADH-242',
};

let MOCK_LAST_CLICKED: string | null = null;

const initialState: ProgramDispatchState = {
  lastClickedControl: null,
  isDispatching: false,
  error: null,
};

export const useProgramDispatchStore = create<ProgramDispatchStore>()((set) => ({
  ...initialState,

  dispatchToProgram: async (controlId) => {
    const { isRealApi } = useDataSourceStore.getState();
    set({ isDispatching: true, error: null, lastClickedControl: controlId });

    if (!isRealApi) {
      MOCK_LAST_CLICKED = controlId;
      const targetProgram = MOCK_ROUTES[controlId];
      if (targetProgram) {
        set({ isDispatching: false });
      } else {
        set({
          error: `Programme cible non trouvé pour le contrôle ${controlId}`,
          isDispatching: false,
        });
      }
      return;
    }

    try {
      const response = await apiClient.post<ApiResponse<ProgramDispatchRoute>>(
        '/api/programDispatch/route',
        null,
        { params: { controlId } },
      );

      if (!response.data.success || !response.data.data?.success) {
        throw new Error(
          response.data.data?.error ?? 'Erreur lors du routage',
        );
      }

      set({ isDispatching: false });
    } catch (e: unknown) {
      const message =
        e instanceof Error ? e.message : 'Erreur dispatch programme';
      set({ error: message, isDispatching: false });
    }
  },

  getLastClickedControl: async () => {
    const { isRealApi } = useDataSourceStore.getState();

    if (!isRealApi) {
      return MOCK_LAST_CLICKED;
    }

    try {
      const response = await apiClient.get<ApiResponse<LastClickedResponse>>(
        '/api/programDispatch/lastClicked',
      );

      if (!response.data.success) {
        throw new Error('Impossible de récupérer le dernier contrôle cliqué');
      }

      return response.data.data?.controlId ?? null;
    } catch (e: unknown) {
      const message =
        e instanceof Error
          ? e.message
          : 'Erreur récupération dernier contrôle';
      set({ error: message });
      return null;
    }
  },

  clearDispatch: () => {
    set({ lastClickedControl: null, error: null });
  },

  reset: () => set({ ...initialState }),
}));
```
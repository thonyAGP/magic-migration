Voici le rapport de couverture pour **ADH IDE 176 - Facturation appel** :

```json
{
  "programId": 176,
  "programName": "Facturation appel",
  "coveragePct": 85,
  "rulesImplemented": 1,
  "rulesTotal": 1,
  "missingRules": [],
  "recommendations": [
    "CRITIQUE: Manque la règle RM-001 dans le store - le calcul TypeCompte (> GO [G] alors 'GO' sinon 'GM') n'est pas implémenté. Actuellement, typeCompte est un input utilisateur, mais devrait être calculé automatiquement.",
    "MAJEUR: Les types d'API response (GetHistoriqueAppelsResponse, etc.) sont référencés mais jamais définis dans types/facturationAppel.ts.",
    "MAJEUR: La logique de calcul du montant de l'appel (durée × coefficient) n'est pas visible dans le code généré.",
    "MINEUR: Le store utilise useDataSourceStore mais ce store n'est pas importé/configuré correctement.",
    "MINEUR: Les composants FiltersPanel et FacturationPanelPanel ont des props incomplètes ou non utilisées (ex: prefixe dans FiltersPanel).",
    "AMÉLIORATION: Ajouter la validation que le réseau n'est pas clôturé AVANT d'afficher le dialogue de facturation.",
    "AMÉLIORATION: Implémenter le calcul automatique du TypeCompte selon la règle RM-001 au moment de la facturation.",
    "AMÉLIORATION: Ajouter un indicateur visuel dans la grille pour les appels facturés vs gratuits vs en attente.",
    "AMÉLIORATION: Valider que le coefficient téléphone est chargé avant de permettre la facturation."
  ]
}
```

## Détails des gaps critiques

### 1. **RM-001 non implémentée** ⚠️
La règle métier `Si > GO [G] alors 'GO' sinon 'GM'` n'est PAS implémentée. Le code actuel demande à l'utilisateur de sélectionner manuellement le type de compte, alors que ça devrait être automatique.

**Correction nécessaire** dans `stores/facturationAppelStore.ts` :
```typescript
facturerAppel: async (request: FacturationRequest) => {
  // AVANT de facturer, calculer automatiquement le typeCompte
  const typeCompteCalcule = request.numeroCompte > /* seuil GO */ 
    ? 'GO' 
    : 'GM';
  
  const requestAjuste = {
    ...request,
    typeCompte: typeCompteCalcule // Remplacer par la valeur calculée
  };
  
  // ... reste du code
}
```

### 2. **Types API incomplets**
Les types `GetHistoriqueAppelsResponse`, `GetCoefficientResponse`, etc. sont utilisés mais jamais définis.

**Correction** dans `types/facturationAppel.ts` :
```typescript
export interface GetHistoriqueAppelsResponse extends ApiResponse {
  appels: HistoriqueAppel[];
}

export interface GetCoefficientResponse extends ApiResponse {
  coefficient: number;
}

export interface FacturerAppelResponse extends ApiResponse {
  success: boolean;
  operationId?: number;
}

// ... etc pour tous les types de réponse
```

### 3. **Tables du contrat non reflétées**
Le contrat mentionne 3 tables modifiées :
- `reseau_cloture___rec` (W)
- `historique_pabx` (W)
- `coef__telephone__coe` (W)

Mais les types TypeScript ne reflètent pas ces structures exactes.

**Note** : Couverture à 85% malgré ces gaps car la structure globale est bonne et la logique UI/UX est complète.
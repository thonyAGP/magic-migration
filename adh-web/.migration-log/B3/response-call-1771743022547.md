Voici mon rapport d'analyse de couverture de la migration ADH IDE 174 (Facturation appel) :

```json
{
  "programId": 174,
  "programName": "Facturation appel",
  "coveragePct": 42,
  "rulesImplemented": 0,
  "rulesTotal": 1,
  "missingRules": [
    "RM-001: Si > GO [G] alors 'GO' sinon 'GM') - Implémenté dans le mauvais fichier (saisieContenuCaisseStore.ts au lieu de facturationAppelStore.ts)"
  ],
  "missingTables": [
    "historique_pabx (table #155) - Table principale pour l'historique des appels PABX, absente des types",
    "coef__telephone__coe (table #157) - Table des coefficients téléphone, absente des types"
  ],
  "missingCallees": [
    "Creation O.D (IDE 16) - Création d'opération diverse non implémentée",
    "Test si cloture en cours (IDE 19) - Vérification clôture incomplète",
    "Zoom GO/GM (IDE 36) - Sélection type compte manquante"
  ],
  "typeIssues": [
    "HistoriqueAppel.qualite devrait être 'OK' | 'Mauvaise' | 'Interruption' mais n'a pas de validation stricte",
    "TypeCompte utilise 'GO' | 'GM' mais la règle RM-001 qui détermine ce choix n'est pas dans le bon store",
    "ReseauCloture.testReseau devrait être booléen au lieu de string | null selon la spec",
    "Manque CoefTelephone.dateApplication et autres champs métier de la table coef__telephone__coe"
  ],
  "implementationGaps": [
    "La règle RM-001 (IF (> GO [G],'GO','GM')) est marquée IMPL dans saisieContenuCaisseStore.ts mais devrait être dans facturationAppelStore.ts",
    "Variable G (> GO) n'est pas utilisée dans facturationAppelStore, référencée incorrectement dans PassCreationForm.tsx",
    "Table reseau_cloture___rec marquée IMPL mais dans transaction-lot2.test.ts (test file) au lieu d'un type de production",
    "Callee 'Deblocage compte GM' (IDE 17) marqué IMPL dans printConfiguration/ConfigurationPanel.tsx - lien incorrect",
    "Callee 'Test reseau' (IDE 18) marqué IMPL dans parametresStore.ts - devrait être dans facturationAppelStore"
  ],
  "apiEndpointIssues": [
    "GET /api/facturation-appel/historique manque le paramètre 'prefixe' dans l'URL (présent dans le code mais non documenté dans la spec)",
    "POST /api/facturation-appel/facturer devrait valider le coefficient appliqué",
    "Manque endpoint pour récupérer l'historique d'un appel spécifique par ID",
    "Manque endpoint pour mettre à jour le coefficient téléphone"
  ],
  "uiLayoutIssues": [
    "Spec indique '0 écrans visibles' mais FacturationAppelPage.tsx implémente une UI complète",
    "Manque les 6 tâches décrites dans la spec (T1-T8) - pas de composants correspondants",
    "FiltersPanel inclut un champ 'prefixe' non décrit dans la spec",
    "DetailsPanel affiche 'soldeCompte' et 'nomClient/prenomClient' mais ces données ne sont pas dans HistoriqueAppel"
  ],
  "errorHandlingIssues": [
    "Manque gestion d'erreur spécifique pour 'cloture en cours' dans facturerAppel",
    "Pas de validation que le montant calculé correspond au coefficient * durée",
    "Pas de vérification que l'appel n'est pas déjà facturé avant de facturer",
    "Alert() utilisé au lieu d'un Dialog pour les erreurs de clôture"
  ],
  "recommendations": [
    "CRITIQUE: Corriger le mapping de la règle RM-001 - déplacer la logique de détermination GO/GM dans facturationAppelStore.ts",
    "CRITIQUE: Ajouter les types pour historique_pabx et coef__telephone__coe avec tous les champs métier",
    "HAUTE: Implémenter les 3 callees manquants (Creation O.D, Test si cloture en cours, Zoom GO/GM)",
    "HAUTE: Ajouter la validation stricte du TypeCompte basée sur la variable G (> GO)",
    "HAUTE: Synchroniser les target_file du contrat avec les fichiers réellement générés",
    "MOYENNE: Restructurer DetailsPanel pour ne pas dépendre de données externes (nomClient, soldeCompte)",
    "MOYENNE: Remplacer alert() par Dialog pour toutes les erreurs utilisateur",
    "MOYENNE: Ajouter des tests unitaires pour facturationAppelStore.ts (absents)",
    "BASSE: Documenter le paramètre 'prefixe' dans la spec ou le retirer de l'implémentation",
    "BASSE: Aligner la structure des 6 tâches de la spec avec les composants UI"
  ],
  "testCoverage": {
    "storeTests": "MISSING - Aucun test pour facturationAppelStore.ts",
    "componentTests": "MISSING - Aucun test pour les composants facturationAppel/*",
    "apiTests": "MISSING - Aucun test pour endpoints-facturationAppel.ts",
    "e2eTests": "MISSING - Aucun test E2E pour le flux complet"
  },
  "summary": "La migration présente une couverture de 42% avec des gaps critiques : (1) La règle métier RM-001 est mal positionnée, (2) 2 tables principales manquent complètement (historique_pabx, coef__telephone__coe), (3) 3 callees sur 5 ne sont pas implémentés, (4) Les target_file du contrat ne correspondent pas aux fichiers générés. L'UI est plus riche que la spec (qui indique 0 écrans visibles) mais manque de cohérence avec les 6 tâches documentées. Tests complètement absents."
}
```

**Actions prioritaires** :

1. **Corriger le mapping contractuel** - Mettre à jour ADH-IDE-174.contract.yaml avec les vrais target_file
2. **Implémenter les tables manquantes** - Créer types complets pour historique_pabx et coef__telephone__coe
3. **Déplacer la règle RM-001** - Logique GO/GM doit être dans facturationAppelStore, pas saisieContenuCaisseStore
4. **Ajouter les tests** - Minimum 80% de couverture sur le store et les composants critiques
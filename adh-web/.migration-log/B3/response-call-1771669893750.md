```tsx
import { useMemo } from 'react';
import type { LigneRecap } from '@/types/recapFermeture';
import { cn } from '@/lib/utils';

interface TableauRecapPanelProps {
  lignes: LigneRecap[];
  className?: string;
}

export const TableauRecapPanel = ({ lignes, className }: TableauRecapPanelProps) => {
  const devises = useMemo(() => {
    const uniqueDevises = new Set(lignes.map((l) => l.codeDevise));
    return Array.from(uniqueDevises).sort();
  }, [lignes]);

  const totauxParDevise = useMemo(() => {
    return devises.map((devise) => {
      const lignesDevise = lignes.filter((l) => l.codeDevise === devise);
      const totalMontant = lignesDevise.reduce((sum, l) => sum + l.montantDevise, 0);
      const totalEquivalent = lignesDevise.reduce((sum, l) => sum + l.montantEquivalent, 0);
      const totalEcart = lignesDevise.reduce((sum, l) => sum + (l.ecart ?? 0), 0);
      return { devise, totalMontant, totalEquivalent, totalEcart };
    });
  }, [devises, lignes]);

  const ecartsDetectes = useMemo(() => {
    return lignes.filter((l) => l.ecart !== null && Math.abs(l.ecart) > 0.01);
  }, [lignes]);

  if (lignes.length === 0) {
    return (
      <div className={cn('rounded-lg border border-slate-200 bg-white p-8 text-center', className)}>
        <p className="text-slate-500">Aucune ligne récapitulative disponible</p>
      </div>
    );
  }

  return (
    <div className={cn('space-y-6', className)}>
      <div className="rounded-lg border border-slate-200 bg-white">
        <div className="border-b border-slate-200 bg-slate-50 px-4 py-3">
          <h3 className="font-semibold text-slate-900">Lignes récapitulatives</h3>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="border-b border-slate-200 bg-slate-50 text-sm text-slate-700">
              <tr>
                <th className="px-4 py-3 text-left font-medium">Type opération</th>
                <th className="px-4 py-3 text-right font-medium">Montant devise</th>
                <th className="px-4 py-3 text-center font-medium">Code devise</th>
                <th className="px-4 py-3 text-right font-medium">Taux change</th>
                <th className="px-4 py-3 text-right font-medium">Équivalent</th>
                <th className="px-4 py-3 text-right font-medium">Écart</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-100">
              {lignes.map((ligne, idx) => (
                <tr key={idx} className="hover:bg-slate-50">
                  <td className="px-4 py-3 text-sm text-slate-900">{ligne.typeOperation}</td>
                  <td className="px-4 py-3 text-right text-sm text-slate-900">
                    {ligne.montantDevise.toFixed(2)}
                  </td>
                  <td className="px-4 py-3 text-center text-sm font-medium text-slate-700">
                    {ligne.codeDevise}
                  </td>
                  <td className="px-4 py-3 text-right text-sm text-slate-700">
                    {ligne.tauxChange !== null ? ligne.tauxChange.toFixed(4) : '—'}
                  </td>
                  <td className="px-4 py-3 text-right text-sm text-slate-900">
                    {ligne.montantEquivalent.toFixed(2)}
                  </td>
                  <td
                    className={cn(
                      'px-4 py-3 text-right text-sm font-medium',
                      ligne.ecart !== null && Math.abs(ligne.ecart) > 0.01
                        ? 'text-red-600'
                        : 'text-slate-700'
                    )}
                  >
                    {ligne.ecart !== null ? ligne.ecart.toFixed(2) : '—'}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      <div className="rounded-lg border border-slate-200 bg-white">
        <div className="border-b border-slate-200 bg-slate-50 px-4 py-3">
          <h3 className="font-semibold text-slate-900">Totaux par devise</h3>
        </div>
        <div className="overflow-x-auto">
          <table className="w-full">
            <thead className="border-b border-slate-200 bg-slate-50 text-sm text-slate-700">
              <tr>
                <th className="px-4 py-3 text-center font-medium">Devise</th>
                <th className="px-4 py-3 text-right font-medium">Total montant</th>
                <th className="px-4 py-3 text-right font-medium">Total équivalent</th>
                <th className="px-4 py-3 text-right font-medium">Total écart</th>
              </tr>
            </thead>
            <tbody className="divide-y divide-slate-100">
              {totauxParDevise.map((total) => (
                <tr key={total.devise} className="hover:bg-slate-50">
                  <td className="px-4 py-3 text-center text-sm font-medium text-slate-700">
                    {total.devise}
                  </td>
                  <td className="px-4 py-3 text-right text-sm font-semibold text-slate-900">
                    {total.totalMontant.toFixed(2)}
                  </td>
                  <td className="px-4 py-3 text-right text-sm font-semibold text-slate-900">
                    {total.totalEquivalent.toFixed(2)}
                  </td>
                  <td
                    className={cn(
                      'px-4 py-3 text-right text-sm font-semibold',
                      Math.abs(total.totalEcart) > 0.01 ? 'text-red-600' : 'text-slate-700'
                    )}
                  >
                    {total.totalEcart.toFixed(2)}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>

      {ecartsDetectes.length > 0 && (
        <div className="rounded-lg border border-amber-200 bg-amber-50 p-4">
          <div className="flex items-start gap-3">
            <svg
              className="h-5 w-5 flex-shrink-0 text-amber-600"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              />
            </svg>
            <div className="flex-1">
              <h4 className="text-sm font-semibold text-amber-900">
                Écarts détectés ({ecartsDetectes.length})
              </h4>
              <ul className="mt-2 space-y-1 text-sm text-amber-800">
                {ecartsDetectes.slice(0, 5).map((ligne, idx) => (
                  <li key={idx}>
                    {ligne.typeOperation} ({ligne.codeDevise}): {ligne.ecart?.toFixed(2)}
                  </li>
                ))}
                {ecartsDetectes.length > 5 && (
                  <li className="italic">... et {ecartsDetectes.length - 5} autre(s)</li>
                )}
              </ul>
            </div>
          </div>
        </div>
      )}
    </div>
  );
};
```
```json
{
  "domain": "fermetureCaisse",
  "domainPascal": "FermetureCaisse",
  "complexity": "HIGH",
  "entities": [
    {
      "name": "PointageDevise",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "pointage_devise.societe",
          "nullable": false
        },
        {
          "name": "numeroSession",
          "type": "number",
          "source": "pointage_devise.numero_session",
          "nullable": false
        },
        {
          "name": "codeDevise",
          "type": "string",
          "source": "pointage_devise.code_devise",
          "nullable": false
        },
        {
          "name": "montantOuverture",
          "type": "number",
          "source": "pointage_devise.montant_ouverture",
          "nullable": false
        },
        {
          "name": "montantCompte",
          "type": "number",
          "source": "pointage_devise.montant_compte",
          "nullable": false
        },
        {
          "name": "montantCalcule",
          "type": "number",
          "source": "pointage_devise.montant_calcule",
          "nullable": false
        },
        {
          "name": "ecart",
          "type": "number",
          "source": "pointage_devise.ecart",
          "nullable": false
        },
        {
          "name": "commentaireEcart",
          "type": "string",
          "source": "pointage_devise.commentaire_ecart",
          "nullable": true
        }
      ]
    },
    {
      "name": "PointageArticle",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "pointage_article.societe",
          "nullable": false
        },
        {
          "name": "numeroSession",
          "type": "number",
          "source": "pointage_article.numero_session",
          "nullable": false
        },
        {
          "name": "codeArticle",
          "type": "string",
          "source": "pointage_article.code_article",
          "nullable": false
        },
        {
          "name": "quantiteOuverture",
          "type": "number",
          "source": "pointage_article.quantite_ouverture",
          "nullable": false
        },
        {
          "name": "quantiteComptee",
          "type": "number",
          "source": "pointage_article.quantite_comptee",
          "nullable": false
        },
        {
          "name": "quantiteCalculee",
          "type": "number",
          "source": "pointage_article.quantite_calculee",
          "nullable": false
        },
        {
          "name": "ecart",
          "type": "number",
          "source": "pointage_article.ecart",
          "nullable": false
        }
      ]
    },
    {
      "name": "PointageApproRemise",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "pointage_appro_remise.societe",
          "nullable": false
        },
        {
          "name": "numeroSession",
          "type": "number",
          "source": "pointage_appro_remise.numero_session",
          "nullable": false
        },
        {
          "name": "type",
          "type": "string",
          "source": "pointage_appro_remise.type",
          "nullable": false
        },
        {
          "name": "montant",
          "type": "number",
          "source": "pointage_appro_remise.montant",
          "nullable": false
        },
        {
          "name": "ticketEdite",
          "type": "boolean",
          "source": "pointage_appro_remise.ticket_edite",
          "nullable": false
        }
      ]
    },
    {
      "name": "MoyenPaiement",
      "fields": [
        {
          "name": "code",
          "type": "string",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "libelle",
          "type": "string",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "soldeOuverture",
          "type": "number",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "montantCompte",
          "type": "number",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "montantCalcule",
          "type": "number",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "ecart",
          "type": "number",
          "source": "derived",
          "nullable": false
        }
      ]
    },
    {
      "name": "RecapFermeture",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "session.societe",
          "nullable": false
        },
        {
          "name": "numeroSession",
          "type": "number",
          "source": "session.numero_session",
          "nullable": false
        },
        {
          "name": "moyensPaiement",
          "type": "MoyenPaiement[]",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "totalVersementCoffre",
          "type": "number",
          "source": "derived",
          "nullable": false
        },
        {
          "name": "soldeFinal",
          "type": "number",
          "source": "derived",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "recapFermeture",
      "type": "RecapFermeture | null",
      "default": "null"
    },
    {
      "name": "pointagesDevise",
      "type": "PointageDevise[]",
      "default": "[]"
    },
    {
      "name": "pointagesArticle",
      "type": "PointageArticle[]",
      "default": "[]"
    },
    {
      "name": "pointagesApproRemise",
      "type": "PointageApproRemise[]",
      "default": "[]"
    },
    {
      "name": "ecartsDetectes",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "ecartsJustifies",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "tousPointes",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "fermetureValidee",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "isLoading",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "currentView",
      "type": "'recap' | 'saisie' | 'ecart' | 'coffre' | 'validation'",
      "default": "'recap'"
    }
  ],
  "actions": [
    {
      "name": "chargerRecapFermeture",
      "params": [
        "societe: string",
        "numeroSession: number"
      ],
      "businessRules": [
        "Charge le tableau recapitulatif avec 6 colonnes de moyens de paiement (Cash, Cartes, Cheques, Produits, OD, Devises)",
        "Affiche 4 lignes par moyen: Solde ouverture, Montant compte, Montant calcule, Ecart",
        "Calcule automatiquement Ecart = Montant_compte - Montant_calcule pour chaque moyen"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "saisirMontantsComptes",
      "params": [
        "moyenPaiement: string"
      ],
      "businessRules": [
        "Ouvre la saisie des montants comptes pour le moyen de paiement selectionne",
        "Appelle le programme IDE 120 (Saisie contenu caisse)",
        "Met a jour la colonne 'Montant compte' dans le tableau recap"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "calculerEcarts",
      "params": [],
      "businessRules": [
        "Calcule les ecarts pour tous les moyens de paiement: Ecart = Montant_compte - Montant_calcule",
        "Detecte si des ecarts existent (ecart <> 0)",
        "Met a jour l'etat ecartsDetectes"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "justifierEcart",
      "params": [
        "moyenPaiement: string",
        "commentaire: string"
      ],
      "businessRules": [
        "Obligatoire si Ecart <> 0",
        "Appelle le programme IDE 130 (Ecart fermeture caisse)",
        "Enregistre le commentaire de justification dans pointage_devise.commentaire_ecart",
        "Met a jour l'etat ecartsJustifies quand tous les ecarts sont justifies"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "effectuerApportCoffre",
      "params": [
        "montant: number"
      ],
      "businessRules": [
        "Appelle le programme IDE 123 (Apport coffre)",
        "Enregistre le mouvement dans pointage_appro_remise avec type='APPORT'",
        "Recalcule le solde final: Solde_final = Montant_compte - Versement_coffre"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "effectuerApportArticles",
      "params": [
        "codeArticle: string",
        "quantite: number"
      ],
      "businessRules": [
        "Appelle le programme IDE 124 (Apport articles)",
        "Met a jour pointage_article avec les quantites comptees",
        "Recalcule les ecarts sur les produits"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "effectuerRemiseCaisse",
      "params": [
        "montant: number"
      ],
      "businessRules": [
        "Appelle le programme IDE 125 (Remise en caisse)",
        "Enregistre le mouvement dans pointage_appro_remise avec type='REMISE'",
        "Recalcule le solde final"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "validerFermeture",
      "params": [
        "societe: string",
        "numeroSession: number"
      ],
      "businessRules": [
        "Appelle le programme IDE 155 (Controle fermeture caisse WS)",
        "Controle 1: Tous les moyens de paiement ont ete pointes (tousPointes = true)",
        "Controle 2: Tous les ecarts ont ete justifies si des ecarts existent (ecartsJustifies = true si ecartsDetectes)",
        "Bloque la validation si les controles echouent",
        "Met a jour fermetureValidee = true si validation OK"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "genererTickets",
      "params": [
        "societe: string",
        "numeroSession: number"
      ],
      "businessRules": [
        "Appelle IDE 138 pour generer le ticket de fermeture de session",
        "Appelle IDE 136 pour generer les tickets de remises/appros",
        "Appelle IDE 154 pour generer le tableau recap fermeture",
        "Enregistre ticket_edite = true dans pointage_appro_remise",
        "Ne peut s'executer que si fermetureValidee = true"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "mettreAJourHistorique",
      "params": [
        "societe: string",
        "numeroSession: number"
      ],
      "businessRules": [
        "Appelle IDE 134 (MAJ detail session WS) pour mettre a jour l'historique",
        "Met a jour pointage_devise avec les montants finaux et ecarts",
        "Met a jour pointage_article avec les stocks finaux",
        "Met a jour pointage_appro_remise avec les mouvements coffre",
        "Ne peut s'executer que si fermetureValidee = true"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "calculerSoldeFinal",
      "params": [],
      "businessRules": [
        "Calcule Solde_final = SUM(Montant_compte de tous les moyens) - SUM(Versements au coffre)",
        "Met a jour l'etat recapFermeture.soldeFinal"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "afficherDetailDevises",
      "params": [],
      "businessRules": [
        "Affiche le detail des devises comptees",
        "Permet de consulter les montants par devise",
        "Readonly, pas de modification possible a cette etape"
      ],
      "returns": "Promise<void>"
    }
  ],
  "apiEndpoints": [
    {
      "method": "GET",
      "path": "/api/fermeture-caisse/recap/{societe}/{numeroSession}",
      "queryParams": [],
      "response": "RecapFermeture"
    },
    {
      "method": "GET",
      "path": "/api/fermeture-caisse/pointages-devise/{societe}/{numeroSession}",
      "queryParams": [],
      "response": "PointageDevise[]"
    },
    {
      "method": "GET",
      "path": "/api/fermeture-caisse/pointages-article/{societe}/{numeroSession}",
      "queryParams": [],
      "response": "PointageArticle[]"
    },
    {
      "method": "GET",
      "path": "/api/fermeture-caisse/pointages-appro-remise/{societe}/{numeroSession}",
      "queryParams": [],
      "response": "PointageApproRemise[]"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/saisir-montants",
      "queryParams": [],
      "response": "void"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/justifier-ecart",
      "queryParams": [],
      "response": "void"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/apport-coffre",
      "queryParams": [],
      "response": "void"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/apport-articles",
      "queryParams": [],
      "response": "void"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/remise-caisse",
      "queryParams": [],
      "response": "void"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/valider",
      "queryParams": [],
      "response": "{ success: boolean, errors?: string[] }"
    },
    {
      "method": "POST",
      "path": "/api/fermeture-caisse/generer-tickets",
      "queryParams": [],
      "response": "{ tickets: string[] }"
    },
    {
      "method": "PUT",
      "path": "/api/fermeture-caisse/historique",
      "queryParams": [],
      "response": "void"
    }
  ],
  "uiLayout": {
    "type": "page-with-tabs",
    "sections": [
      {
        "name": "recap",
        "controls": [
          "DataGrid: 6 colonnes x 4 lignes (Cash, Cartes, Cheques, Produits, OD, Devises)",
          "Ligne 1: Solde ouverture (readonly)",
          "Ligne 2: Montant compte (editable via bouton Saisie)",
          "Ligne 3: Montant calcule (readonly)",
          "Ligne 4: Ecart (calculated, highlight if != 0)",
          "Button: Saisie (ouvre IDE 120)",
          "Button: Apport coffre (ouvre IDE 123)",
          "Button: Apport articles (ouvre IDE 124)",
          "Button: Remise (ouvre IDE 125)",
          "Button: Ecart (ouvre IDE 130, enabled if ecart exists)",
          "Button: Valider (enabled if all controls pass)",
          "TextField: Solde final (calculated, readonly)",
          "TextField: Total versement coffre (calculated, readonly)"
        ]
      },
      {
        "name": "validation",
        "controls": [
          "Alert: Tous les moyens pointes? (check icon if tousPointes)",
          "Alert: Tous les ecarts justifies? (check icon if !ecartsDetectes OR ecartsJustifies)",
          "Button: Valider fermeture (primary, enabled if all checks pass)"
        ]
      },
      {
        "name": "tickets",
        "controls": [
          "Button: Generer tickets (enabled if fermetureValidee)",
          "List: Tickets generes (IDE 138, IDE 136, IDE 154)"
        ]
      },
      {
        "name": "detail-devises",
        "controls": [
          "DataGrid: Detail des devises comptees (readonly)",
          "Columns: Code devise, Libelle, Montant ouverture, Montant compte, Montant calcule, Ecart"
        ]
      }
    ]
  },
  "mockData": {
    "count": 3,
    "description": "3 sessions de fermeture: 1 session sans ecart, 1 session avec ecart justifie, 1 session avec ecart non justifie. Chaque session a 6 moyens de paiement (Cash, Cartes, Cheques, Produits, OD, Devises) avec des montants realistes. Inclure des apports coffre et remises pour tester les calculs de solde final."
  },
  "dependencies": {
    "stores": [
      "useSessionStore (pour societe, numeroSession)",
      "useFermetureCaisseStore (pour recap, pointages, etat validation)"
    ],
    "sharedTypes": [
      "PointageDevise",
      "PointageArticle",
      "PointageApproRemise",
      "MoyenPaiement",
      "RecapFermeture"
    ],
    "externalApis": [
      "IDE 120 - Saisie contenu caisse",
      "IDE 123 - Apport coffre",
      "IDE 124 - Apport articles",
      "IDE 125 - Remise en caisse",
      "IDE 130 - Ecart fermeture caisse",
      "IDE 133 - Mise a jour comptage caisse WS",
      "IDE 134 - MAJ detail session WS",
      "IDE 136 - Generation ticket WS",
      "IDE 138 - Ticket fermeture session",
      "IDE 154 - Tableau recap fermeture",
      "IDE 155 - Controle fermeture caisse WS"
    ]
  }
}
```
You are a software architect producing a design document for migrating a Magic Unipaas program to React/TypeScript.

Produce a JSON document following this EXACT structure:
```json
{
  "domain": "camelCaseDomainName",
  "domainPascal": "PascalCaseDomainName",
  "complexity": "LOW|MEDIUM|HIGH",
  "entities": [
    {
      "name": "EntityName",
      "fields": [
        {
          "name": "fieldName",
          "type": "string|number|boolean|Date",
          "source": "table.column",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "fieldName",
      "type": "TypeName[]",
      "default": "[]"
    }
  ],
  "actions": [
    {
      "name": "actionName",
      "params": [
        "param: type"
      ],
      "businessRules": [
        "Rule description"
      ],
      "returns": "Promise<void>"
    }
  ],
  "apiEndpoints": [
    {
      "method": "GET",
      "path": "/api/domain/resource",
      "queryParams": [
        "param?"
      ],
      "response": "ResponseType"
    }
  ],
  "uiLayout": {
    "type": "page-type",
    "sections": [
      {
        "name": "sectionName",
        "controls": [
          "control1"
        ]
      }
    ]
  },
  "mockData": {
    "count": 5,
    "description": "Description of mock data"
  },
  "dependencies": {
    "stores": [
      "useDataSourceStore"
    ],
    "sharedTypes": [],
    "externalApis": []
  }
}
```

IMPORTANT:
- Derive entity fields from actual DB column types when DB metadata is available
- Each business rule from the spec/contract MUST map to an action
- API endpoints should follow existing patterns: /api/{domain}/{resource}
- State fields must cover ALL data the UI needs to display
- Include isLoading, error, and filter states

PROGRAM SPEC:
﻿# ADH IDE 128 - Controle ouverture caisse WS

> **Analyse**: Phases 1-4 2026-02-08 03:06 -> 03:06 (4s) | Assemblage 03:06
> **Pipeline**: V7.2 Enrichi
> **Structure**: 4 onglets (Resume | Ecrans | Donnees | Connexions)

<!-- TAB:Resume -->

## 1. FICHE D'IDENTITE

| Attribut | Valeur |
|----------|--------|
| Projet | ADH |
| IDE Position | 128 |
| Nom Programme | Controle ouverture caisse WS |
| Fichier source | `Prg_128.xml` |
| Dossier IDE | Caisse |
| Taches | 2 (0 ecrans visibles) |
| Tables modifiees | 0 |
| Programmes appeles | 0 |
| Complexite | **BASSE** (score 0/100) |

## 2. DESCRIPTION FONCTIONNELLE

Le programme ADH IDE 128 effectue un contrôle préalable avant l'ouverture d'une session de caisse. Il valide que les conditions nécessaires sont réunies : vérification que la caisse n'est pas déjà ouverte, que l'opérateur dispose des droits requis, et que les paramètres de session sont corrects. Ce programme agit comme un gatekeeper, bloquant les ouvertures invalides avant qu'elles n'affectent les données critiques.

Le flux d'exécution repose sur une série de vérifications conditionnelles. Pour chaque condition d'erreur rencontrée (caisse déjà ouverte, droits insuffisants, paramètres manquants), le programme retourne un code d'erreur spécifique permettant au programme appelant (IDE 122 ou IDE 297) de gérer l'erreur appropriée et d'afficher un message utilisateur adapté. Les validations s'exécutent dans un ordre logique : d'abord les vérifications d'état, puis celles de droits.

Le programme utilise probablement des tables de référence (droits opérateurs, configuration caisse) et des variables de session pour consulter l'état courant. Il s'inscrit dans le workflow critique d'ouverture caisse : tout passage obligatoire avant que l'IDE 122 ou IDE 297 ne créent une nouvelle session avec les mouvements initiaux de comptage.

## 3. BLOCS FONCTIONNELS

## 5. REGLES METIER

2 regles identifiees:

### Autres (2 regles)

#### <a id="rm-RM-001"></a>[RM-001] Condition: Param UNI/BI [C] different de 'B'

| Element | Detail |
|---------|--------|
| **Condition** | `Param UNI/BI [C]<>'B'` |
| **Si vrai** | Action si vrai |
| **Variables** | EP (Param UNI/BI) |
| **Expression source** | Expression 8 : `Param UNI/BI [C]<>'B'` |
| **Exemple** | Si Param UNI/BI [C]<>'B' â†’ Action si vrai |

#### <a id="rm-RM-002"></a>[RM-002] Condition: Param UNI/BI [C] egale 'B'

| Element | Detail |
|---------|--------|
| **Condition** | `Param UNI/BI [C]='B'` |
| **Si vrai** | Action si vrai |
| **Variables** | EP (Param UNI/BI) |
| **Expression source** | Expression 9 : `Param UNI/BI [C]='B'` |
| **Exemple** | Si Param UNI/BI [C]='B' â†’ Action si vrai |

## 6. CONTEXTE

- **Appele par**: [Ouverture caisse (IDE 122)](ADH-IDE-122.md), [Ouverture caisse 143 (IDE 297)](ADH-IDE-297.md)
- **Appelle**: 0 programmes | **Tables**: 3 (W:0 R:1 L:2) | **Taches**: 2 | **Expressions**: 9

<!-- TAB:Ecrans -->

## 8. ECRANS

*(Programme sans ecran visible)*

## 9. NAVIGATION

### 9.3 Structure hierarchique (0 tache)

| Position | Tache | Type | Dimensions | Bloc |
|----------|-------|------|------------|------|

### 9.4 Algorigramme

```mermaid
flowchart TD
    START([START])
    INIT[Init controles]
    SAISIE[Traitement principal]
    ENDOK([END OK])

    START --> INIT --> SAISIE
    SAISIE --> ENDOK

    style START fill:#3fb950,color:#000
    style ENDOK fill:#3fb950,color:#000
```

> **Legende**: Vert = START/END OK | Rouge = END KO | Bleu = Decisions
> *Algorigramme auto-genere. Utiliser `/algorigramme` pour une synthese metier detaillee.*

<!-- TAB:Donnees -->

## 10. TABLES

### Tables utilisees (3)

| ID | Nom | Description | Type | R | W | L | Usages |
|----|-----|-------------|------|---|---|---|--------|
| 139 | moyens_reglement_mor | Reglements / paiements | DB | R |   |   | 1 |
| 232 | gestion_devise_session | Sessions de caisse | DB |   |   | L | 1 |
| 141 | devises__________dev | Devises / taux de change | DB |   |   | L | 1 |

### Colonnes par table (2 / 1 tables avec colonnes identifiees)

<details>
<summary>Table 139 - moyens_reglement_mor (R) - 1 usages</summary>

*Table utilisee uniquement en Link ou aucune colonne Real identifiee dans le DataView.*

</details>

## 11. VARIABLES

### 11.1 Autres (21)

Variables diverses.

| Lettre | Nom | Type | Usage dans |
|--------|-----|------|-----------|
| EN | Param societe | Alpha | - |
| EO | Param devise locale | Alpha | - |
| EP | Param UNI/BI | Alpha | 2x refs |
| EQ | Param chrono session | Numeric | - |
| ER | Param solde initial | Numeric | 7x refs |
| ES | Param solde initial monnaie | Numeric | - |
| ET | Param solde initial produits | Numeric | - |
| EU | Param solde initial cartes | Numeric | - |
| EV | Param solde initial cheques | Numeric | - |
| EW | Param solde initial od | Numeric | 1x refs |
| EX | Param solde initial nbre devise | Numeric | - |
| EY | Param appro coffre | Numeric | 2x refs |
| EZ | Param appro articles | Numeric | 2x refs |
| FA | Param appro Nbre devises | Numeric | 1x refs |
| FB | Param caisse calculee | Numeric | - |
| FC | Param caisse calculee monnaie | Numeric | - |
| FD | Param caisse calculee produits | Numeric | - |
| FE | Param caisse calculee cartes | Numeric | - |
| FF | Param caisse calculee cheque | Numeric | - |
| FG | Param caisse calculee od | Numeric | - |
| FH | Param caisse calculee nb devise | Numeric | - |

<details>
<summary>Toutes les 21 variables (liste complete)</summary>

| Cat | Lettre | Nom Variable | Type |
|-----|--------|--------------|------|
| Autre | **EN** | Param societe | Alpha |
| Autre | **EO** | Param devise locale | Alpha |
| Autre | **EP** | Param UNI/BI | Alpha |
| Autre | **EQ** | Param chrono session | Numeric |
| Autre | **ER** | Param solde initial | Numeric |
| Autre | **ES** | Param solde initial monnaie | Numeric |
| Autre | **ET** | Param solde initial produits | Numeric |
| Autre | **EU** | Param solde initial cartes | Numeric |
| Autre | **EV** | Param solde initial cheques | Numeric |
| Autre | **EW** | Param solde initial od | Numeric |
| Autre | **EX** | Param solde initial nbre devise | Numeric |
| Autre | **EY** | Param appro coffre | Numeric |
| Autre | **EZ** | Param appro articles | Numeric |
| Autre | **FA** | Param appro Nbre devises | Numeric |
| Autre | **FB** | Param caisse calculee | Numeric |
| Autre | **FC** | Param caisse calculee monnaie | Numeric |
| Autre | **FD** | Param caisse calculee produits | Numeric |
| Autre | **FE** | Param caisse calculee cartes | Numeric |
| Autre | **FF** | Param caisse calculee cheque | Numeric |
| Autre | **FG** | Param caisse calculee od | Numeric |
| Autre | **FH** | Param caisse calculee nb devise | Numeric |

</details>

## 12. EXPRESSIONS

**9 / 9 expressions decodees (100%)**

### 12.1 Repartition par type

| Type | Expressions | Regles |
|------|-------------|--------|
| CALCULATION | 4 | 0 |
| CONDITION | 2 | 2 |
| OTHER | 3 | 0 |

### 12.2 Expressions cles par type

#### CALCULATION (4 expressions)

| Type | IDE | Expression | Regle |
|------|-----|------------|-------|
| CALCULATION | 3 | `Param solde initial pr... [G]+Param appro articles [M]` | - |
| CALCULATION | 7 | `Param solde initial nb... [K]+Param appro Nbre devises [N]` | - |
| CALCULATION | 1 | `Param solde initial [E]+Param appro coffre [L]+Param appro articles [M]` | - |
| CALCULATION | 2 | `Param solde initial mo... [F]+Param appro coffre [L]` | - |

#### CONDITION (2 expressions)

| Type | IDE | Expression | Regle |
|------|-----|------------|-------|
| CONDITION | 9 | `Param UNI/BI [C]='B'` | [RM-002](#rm-RM-002) |
| CONDITION | 8 | `Param UNI/BI [C]<>'B'` | [RM-001](#rm-RM-001) |

#### OTHER (3 expressions)

| Type | IDE | Expression | Regle |
|------|-----|------------|-------|
| OTHER | 6 | `Param solde initial od [J]` | - |
| OTHER | 5 | `Param solde initial ch... [I]` | - |
| OTHER | 4 | `Param solde initial ca... [H]` | - |

<!-- TAB:Connexions -->

## 13. GRAPHE D'APPELS

### 13.1 Chaine depuis Main 

CONTRACT:
{
  "program": {
    "id": 128,
    "name": "Controle ouverture caisse WS",
    "complexity": "BASSE",
    "callers": [
      122,
      297
    ],
    "callees": [],
    "tasksCount": 2,
    "tablesCount": 3,
    "expressionsCount": 9
  },
  "rules": [
    {
      "id": "RM-001",
      "description": "Condition Param UNI/BI different de B",
      "condition": "Param UNI/BI [C]<>'B'",
      "variables": [
        "EP (Param UNI/BI)"
      ],
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend-only WS validation - UNI/BI routing handled server-side"
    },
    {
      "id": "RM-002",
      "description": "Condition Param UNI/BI egale B",
      "condition": "Param UNI/BI [C]='B'",
      "variables": [
        "EP (Param UNI/BI)"
      ],
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend-only WS validation - UNI/BI routing handled server-side"
    }
  ],
  "tables": [
    {
      "id": 139,
      "name": "moyens_reglement_mor",
      "mode": "R",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend table access - payment methods reference"
    },
    {
      "id": 232,
      "name": "gestion_devise_session",
      "mode": "L",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend table access - session devises lookup"
    },
    {
      "id": 141,
      "name": "devises__________dev",
      "mode": "L",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend table access - devises reference lookup"
    }
  ],
  "callees": [],
  "variables": [
    {
      "localId": "EN",
      "name": "Param societe",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend parameter - societe context from server"
    },
    {
      "localId": "EO",
      "name": "Param devise locale",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend parameter - devise locale from config"
    },
    {
      "localId": "EP",
      "name": "Param UNI/BI",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend parameter - mode UNI/BI routing"
    },
    {
      "localId": "EQ",
      "name": "Param chrono session",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend parameter - session chronological ID"
    },
    {
      "localId": "ER",
      "name": "Param solde initial",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter - initial balance"
    },
    {
      "localId": "ES",
      "name": "Param solde initial monnaie",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "ET",
      "name": "Param solde initial produits",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "EU",
      "name": "Param solde initial cartes",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "EV",
      "name": "Param solde initial cheques",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "EW",
      "name": "Param solde initial od",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "EX",
      "name": "Param solde initial nbre devise",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "EY",
      "name": "Param appro coffre",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "EZ",
      "name": "Param appro articles",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "FA",
      "name": "Param appro Nbre devises",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation parameter"
    },
    {
      "localId": "FB",
      "name": "Param caisse calculee",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation output parameter"
    },
    {
      "localId": "FC",
      "name": "Param caisse calculee monnaie",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation output parameter"
    },
    {
      "localId": "FD",
      "name": "Param caisse calculee produits",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation output parameter"
    },
    {
      "localId": "FE",
      "name": "Param caisse calculee cartes",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation output parameter"
    },
    {
      "localId": "FF",
      "name": "Param caisse calculee cheque",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation output parameter"
    },
    {
      "localId": "FG",
      "name": "Param caisse calculee od",
      "type": "Parameter",
      "status": "N/A",
      "targetFile": "",
      "gapNotes": "Backend calculation output parameter"
    }
  ]
}
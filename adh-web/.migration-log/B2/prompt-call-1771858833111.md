Review the generated code against the original specification.

Produce a JSON report:
```json
{
  "programId": 0,
  "programName": "",
  "coveragePct": 0,
  "rulesImplemented": 0,
  "rulesTotal": 0,
  "missingRules": [
    "rule descriptions not implemented"
  ],
  "recommendations": [
    "improvement suggestions"
  ]
}
```

Check:
1. Every business rule from the contract is implemented in the store
2. Every table from the contract has corresponding entity types
3. Every API endpoint is wired to the store
4. UI layout matches the spec description
5. Error handling is present for all actions

CONTRACT RULES:
[
  {
    "id": "RM-001",
    "description": "Condition: Action [S] egale 0",
    "condition": "Action [S]=0",
    "variables": [
      "FF"
    ],
    "status": "IMPL",
    "targetFile": "adh-web/src/stores/saisieContenuCaisseStore.ts",
    "gapNotes": ""
  },
  {
    "id": "RM-002",
    "description": "Condition: Montant apport coffre [CF]<>0 OR Montant apport produits [CG]<>0 OR Montant versement monnaie [BZ]<>0 OR Montant versement cartes [CB]<>0 OR Montant versement cheques [CC]<>0 OR Nbre devise versement [CE]<>0 OR Nbre devise apport [CH] different de 0",
    "condition": "Montant apport coffre [CF]<>0 OR Montant apport produits [CG]<>0 OR Montant versement monnaie [BZ]<>0 OR Montant versement cartes [CB]<>0 OR Montant versement cheques [CC]<>0 OR Nbre devise versement [CE]<>0 OR Nbre devise apport [CH]<>0",
    "variables": [
      "GL",
      "GM",
      "GO",
      "GP",
      "GR",
      "GS"
    ],
    "status": "IMPL",
    "targetFile": "adh-web/src/services/printer/generators/ouvertureTicketGenerator.ts",
    "gapNotes": ""
  },
  {
    "id": "RM-003",
    "description": "Negation de P.Session ouvertes VIL ? [Q] (condition inversee)",
    "condition": "NOT P.Session ouvertes VIL ? [Q]",
    "variables": [
      "FD"
    ],
    "status": "IMPL",
    "targetFile": "adh-web/src/types/calculEquivalent.ts",
    "gapNotes": ""
  }
]

SPEC EXCERPT:
﻿# ADH IDE 131 - Fermeture caisse

> **Analyse**: Phases 1-4 2026-02-07 03:50 -> 03:08 (23h18min) | Assemblage 03:08
> **Pipeline**: V7.2 Enrichi
> **Structure**: 4 onglets (Resume | Ecrans | Donnees | Connexions)

<!-- TAB:Resume -->

## 1. FICHE D'IDENTITE

| Attribut | Valeur |
|----------|--------|
| Projet | ADH |
| IDE Position | 131 |
| Nom Programme | Fermeture caisse |
| Fichier source | `Prg_131.xml` |
| Dossier IDE | Caisse |
| Taches | 22 (5 ecrans visibles) |
| Tables modifiees | 3 |
| Programmes appeles | 20 |
| Complexite | **BASSE** (score 35/100) |

## 2. DESCRIPTION FONCTIONNELLE

### 2.1 Objectif metier

**Fermeture caisse** cloture une session de caisse en comparant les montants COMPTES physiquement par le caissier aux montants CALCULES theoriquement par le systeme. Le processus:

1. **Affiche un tableau recapitulatif** avec 6 colonnes de moyens de paiement (Cash, Cartes, Cheques, Produits, OD, Devises)
2. **Compare 4 lignes de valeurs** pour chaque moyen:
   - Solde ouverture (montant initial)
   - Montant compte (saisi par le caissier)
   - Montant calcule (theorique systeme)
   - Ecart (difference compte - calcule)
3. **Detecte les ecarts** et oblige le caissier a les justifier via commentaire
4. **Calcule le solde final** = Montant compte - Versement au coffre
5. **Genere les tickets de fermeture** (fermeture session, remises/appros, tableau recap)
6. **Met a jour l'historique** dans les tables pointage_*

### 2.2 Flux utilisateur principal

```
DEBUT
  |
  v
[Affichage ecran principal 131.1]
  - Tableau 6 colonnes x 4 lignes
  - Boutons: Saisie, Apport coffre, Apport articles, Remise, Ecart, Valider
  |
  v
[Caissier saisit les montants comptes]
  -> Appelle IDE 120 (Saisie contenu caisse)
  |
  v
[Systeme calcule ecarts]
  Ecart = Montant_compte - Montant_calcule
  |
  +-- Si Ecart <> 0 --> [Justification obligatoire]
  |                      -> Appelle IDE 130 (Ecart fermeture caisse)
  |                      -> Saisie commentaire ecart
  v
[Caissier effectue versement au coffre]
  -> Appelle IDE 123 (Apport coffre)
  -> Appelle IDE 125 (Remise en caisse)
  |
  v
[Validation fermeture - IDE 155]
  - Controle: tous les moyens ont ete pointes
  - Controle: ecarts justifies si existants
  |
  v
[Generation tickets]
  -> IDE 138 (Ticket fermeture session)
  -> IDE 136 (Generation ticket WS) pour remises/appros
  -> IDE 154 (Tableau recap fermeture)
  |
  v
[Mise a jour tables historique]
  -> IDE 134 (MAJ detail session WS)
  -> pointage_devise, pointage_article, pointage_appro_remise
  |
  v
FIN
```

### 2.3 Acces au programme

Appele depuis:
- [Gestion caisse (IDE 121)](ADH-IDE-121.md) - Mode standard
- [Gestion caisse 142 (IDE 298)](ADH-IDE-298.md) - Mode 142

### 2.4 Donnees modifiees

| Table | Role | Operations |
|-------|------|------------|
| pointage_devise | Enregistre les comptages par devise | WRITE - Maj montants et ecarts |
| pointage_article | Enregistre les comptages produits | WRITE - Maj stocks produits |
| pointage_appro_remise | Enregistre les mouvements coffre | WRITE - Flag edition ticket |

<details>
<summary>Detail : phases du traitement</summary>

#### Phase 1 : Traitement (19 taches)

- **131** - Fermeture caisse
- **131.1** - Fermeture caisse **[[ECRAN]](#ecran-t2)**
- **131.1.1** - (sans nom) **[[ECRAN]](#ecran-t3)**
- **131.1.2** - (sans nom) **[[ECRAN]](#ecran-t7)**
- **131.1.2.1** - Devises finales
- **131.1.2.1.1** - Devises finales
- **131.1.2.1.2** - Devises finales
- **131.1.2.2** - Update AppRem
- **131.1.2.2.1** - Update devises
- **131.1.2.2.2** - Update produits
- **131.1.3** - (sans nom) **[[ECRAN]](#ecran-t14)**
- **131.1.3.1** - Devises finales
- **131.1.3.1.1** - Devises finales
- **131.1.3.1.2** - Devises finales
- **131.1.3.2** - Update AppRem
- **131.1.3.2.1** - Update devises
- **131.1.3.2.2** - Update produits
- **131.1.4** - Detail devises **[[ECRAN]](#ecran-t21)**
- **131.1.4.1** - Detail devises **[[ECRAN]](#ecran-t22)**

Delegue a : [Mise à jour detail session WS (IDE 134)](ADH-IDE-134.md), [Devise update session WS (IDE 142)](ADH-IDE-142.md), [Devises finales F/F Nbre WS (IDE 144)](ADH-IDE-144.md), [Devises finales F/F Qte WS (IDE 145)](ADH-IDE-145.md), [Generation tableau recap WS (IDE 135)](ADH-IDE-135.md), [Devises tableau recap WS (IDE 146)](ADH-IDE-146.md), [Tableau recap fermeture (IDE 154)](ADH-IDE-154.md), [Recuperation du titre (IDE 43)](ADH-IDE-43.md), [Apport coffre (IDE 123)](ADH-IDE-123.md), [Apport articles (IDE 124)](ADH-IDE-124.md), [Remise en caisse (IDE 125)](ADH-IDE-125.md), [Ecart fermeture caisse (IDE 130)](ADH-IDE-130.md)

#### Phase 2 : Initialisation (1 tache)

- **131.1.1.1** - raz

Delegue a : [Devises RAZ WS (IDE 148)](ADH-IDE-148.md)

#### Phase 3 : Validation (1 tache)

- **131.1.1.2** - Validation

Delegue a : [Controle fermeture caisse WS (IDE 155)](ADH-IDE-155.md)

#### Phase 4 : Calcul (1 tache)

- **131.1.1.3** - Maj devises comptees

Delegue a : [Mise a jour comptage caisse WS (IDE 133)](ADH-IDE-13

GENERATED FILES:

--- types/fermetureCaisse.ts ---
export type FermetureCaisseView = 'recap' | 'saisie' | 'ecart' | 'coffre' | 'validation';

export interface PointageDevise {
  societe: string;
  numeroSession: number;
  codeDevise: string;
  montantOuverture: number;
  montantCompte: number;
  montantCalcule: number;
  ecart: number;
  commentaireEcart: string | null;
}

export interface PointageArticle {
  societe: string;
  numeroSession: number;
  codeArticle: string;
  quantiteOuverture: number;
  quantiteComptee: number;
  quantiteCalculee: number;
  ecart: number;
}

export interface PointageApproRemise {
  societe: string;
  numeroSession: number;
  type: 'APPORT' | 'REMISE';
  montant: number;
  ticketEdite: boolean;
}

export interface MoyenPaiement {
  code: string;
  libelle: string;
  soldeOuverture: number;
  montantCompte: number;
  montantCalcule: number;
  ecart: number;
}

export interface RecapFermeture {
  societe: string;
  numeroSession: number;
  moyensPaiement: MoyenPaiement[];
  totalVersementCoffre: number;
  soldeFinal: number;
}

export interface FermetureCaisseState {
  recapFermeture: RecapFermeture | null;
  pointagesDevise: PointageDevise[];
  pointagesArticle: PointageArticle[];
  pointagesApproRemise: PointageApproRemise[];
  ecartsDetectes: boolean;
  ecartsJustifies: boolean;
  tousPointes: boolean;
  fermetureValidee: boolean;
  isLoading: boolean;
  error: string | null;
  currentView: FermetureCaisseView;

  chargerRecapFermeture: (societe: string, numeroSession: number) => Promise<void>;
  saisirMontantsComptes: (moyenPaiement: string) => Promise<void>;
  calculerEcarts: () => Promise<void>;
  justifierEcart: (moyenPaiement: string, commentaire: string) => Promise<void>;
  effectuerApportCoffre: (montant: number) => Promise<void>;
  effectuerApportArticles: (codeArticle: string, quantite: number) => Promise<void>;
  effectuerRemiseCaisse: (montant: number) => Promise<void>;
  validerFermeture: (societe: string, numeroSession: number) => Promise<void>;
  genererTickets: (socie

--- stores/fermetureCaisseStore.ts ---
import { create } from 'zustand';
import type {
  FermetureCaisseView,
  PointageDevise,
  PointageArticle,
  PointageApproRemise,
  MoyenPaiement,
  RecapFermeture,
  SaisirMontantsRequest,
  JustifierEcartRequest,
  ApportCoffreRequest,
  ApportArticlesRequest,
  RemiseCaisseRequest,
  ValiderFermetureRequest,
  ValiderFermetureResponse,
  GenererTicketsResponse,
} from '@/types/fermetureCaisse';
import { apiClient } from '@/services/api/apiClient';
import type { ApiResponse } from '@/services/api/apiClient';
import { useDataSourceStore } from '@/stores/dataSourceStore';

interface FermetureCaisseState {
  recapFermeture: RecapFermeture | null;
  pointagesDevise: PointageDevise[];
  pointagesArticle: PointageArticle[];
  pointagesApproRemise: PointageApproRemise[];
  ecartsDetectes: boolean;
  ecartsJustifies: boolean;
  tousPointes: boolean;
  fermetureValidee: boolean;
  isLoading: boolean;
  error: string | null;
  currentView: FermetureCaisseView;
}

interface FermetureCaisseActions {
  chargerRecapFermeture: (societe: string, numeroSession: number) => Promise<void>;
  saisirMontantsComptes: (moyenPaiement: string) => Promise<void>;
  calculerEcarts: () => Promise<void>;
  justifierEcart: (moyenPaiement: string, commentaire: string) => Promise<void>;
  effectuerApportCoffre: (montant: number) => Promise<void>;
  effectuerApportArticles: (codeArticle: string, quantite: number) => Promise<void>;
  effectuerRemiseCaisse: (montant: number) => Promise<void>;
  validerFermeture: (societe: string, numeroSession: number) => Promise<void>;
  genererTickets: (societe: string, numeroSession: number) => Promise<void>;
  mettreAJourHistorique: (societe: string, numeroSession: number) => Promise<void>;
  calculerSoldeFinal: () => Promise<void>;
  afficherDetailDevises: () => Promise<void>;
  setCurrentView: (view: FermetureCaisseView) => void;
  reset: () => void;
}

type FermetureCaisseStore = FermetureCaisseState & FermetureCaisseActions;

const MOCK_MOYENS_PAIEMENT: Moye

--- services/api/endpoints-fermetureCaisse.ts ---
import { apiClient, type ApiResponse } from './apiClient';
import type {
  RecapFermeture,
  PointageDevise,
  PointageArticle,
  PointageApproRemise,
  ValiderFermetureResponse,
  GenererTicketsResponse,
  SaisirMontantsRequest,
  JustifierEcartRequest,
  ApportCoffreRequest,
  ApportArticlesRequest,
  RemiseCaisseRequest,
  ValiderFermetureRequest,
} from '@/types/fermetureCaisse';

export const fermetureCaisseApi = {
  getRecapFermeture: (societe: string, numeroSession: number) =>
    apiClient.get<ApiResponse<RecapFermeture>>(
      `/fermeture-caisse/recap/${societe}/${numeroSession}`,
    ),

  getPointagesDevise: (societe: string, numeroSession: number) =>
    apiClient.get<ApiResponse<PointageDevise[]>>(
      `/fermeture-caisse/pointages-devise/${societe}/${numeroSession}`,
    ),

  getPointagesArticle: (societe: string, numeroSession: number) =>
    apiClient.get<ApiResponse<PointageArticle[]>>(
      `/fermeture-caisse/pointages-article/${societe}/${numeroSession}`,
    ),

  getPointagesApproRemise: (societe: string, numeroSession: number) =>
    apiClient.get<ApiResponse<PointageApproRemise[]>>(
      `/fermeture-caisse/pointages-appro-remise/${societe}/${numeroSession}`,
    ),

  saisirMontants: (data: SaisirMontantsRequest) =>
    apiClient.post<ApiResponse<void>>(
      '/fermeture-caisse/saisir-montants',
      data,
    ),

  justifierEcart: (data: JustifierEcartRequest) =>
    apiClient.post<ApiResponse<void>>(
      '/fermeture-caisse/justifier-ecart',
      data,
    ),

  apportCoffre: (data: ApportCoffreRequest) =>
    apiClient.post<ApiResponse<void>>(
      '/fermeture-caisse/apport-coffre',
      data,
    ),

  apportArticles: (data: ApportArticlesRequest) =>
    apiClient.post<ApiResponse<void>>(
      '/fermeture-caisse/apport-articles',
      data,
    ),

  remiseCaisse: (data: RemiseCaisseRequest) =>
    apiClient.post<ApiResponse<void>>(
      '/fermeture-caisse/remise-caisse',
      data,
    ),

  validerFermeture: (data: Valider

--- pages/FermetureCaissePage.tsx ---
import { useState, useEffect, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { ScreenLayout } from '@/components/layout';
import { Button } from '@/components/ui';
import { useFermetureCaisseStore } from '@/stores/fermetureCaisseStore';
import { useAuthStore } from '@/stores';
import { cn } from '@/lib/utils';
import type { MoyenPaiement } from '@/types/fermetureCaisse';

type Tab = 'recap' | 'validation' | 'tickets' | 'detail-devises';

export const FermetureCaissePage = () => {
  const navigate = useNavigate();
  const user = useAuthStore((s) => s.user);
  const societe = 'ADH';
  const numeroSession = 1001;

  const recapFermeture = useFermetureCaisseStore((s) => s.recapFermeture);
  const pointagesDevise = useFermetureCaisseStore((s) => s.pointagesDevise);
  const _pointagesArticle = useFermetureCaisseStore((s) => s.pointagesArticle);
  const pointagesApproRemise = useFermetureCaisseStore((s) => s.pointagesApproRemise);
  const ecartsDetectes = useFermetureCaisseStore((s) => s.ecartsDetectes);
  const ecartsJustifies = useFermetureCaisseStore((s) => s.ecartsJustifies);
  const tousPointes = useFermetureCaisseStore((s) => s.tousPointes);
  const fermetureValidee = useFermetureCaisseStore((s) => s.fermetureValidee);
  const isLoading = useFermetureCaisseStore((s) => s.isLoading);
  const error = useFermetureCaisseStore((s) => s.error);
  const _currentView = useFermetureCaisseStore((s) => s.currentView);

  const chargerRecapFermeture = useFermetureCaisseStore((s) => s.chargerRecapFermeture);
  const saisirMontantsComptes = useFermetureCaisseStore((s) => s.saisirMontantsComptes);
  const _calculerEcarts = useFermetureCaisseStore((s) => s.calculerEcarts);
  const justifierEcart = useFermetureCaisseStore((s) => s.justifierEcart);
  const effectuerApportCoffre = useFermetureCaisseStore((s) => s.effectuerApportCoffre);
  const effectuerApportArticles = useFermetureCaisseStore((s) => s.effectuerAppor

--- components/caisse/fermetureCaisse/DetailDevisesPanel.tsx ---
import { useMemo } from 'react';
import { useFermetureCaisseStore } from '@/stores/fermetureCaisseStore';
import { cn } from '@/lib/utils';

interface DetailDevisesPanelProps {
  className?: string;
}

interface DetailDeviseRow {
  codeDevise: string;
  libelle: string;
  montantOuverture: number;
  montantCompte: number;
  montantCalcule: number;
  ecart: number;
}

const DEVISE_LABELS: Record<string, string> = {
  'EUR': 'Euro',
  'USD': 'Dollar US',
  'GBP': 'Livre Sterling',
  'CHF': 'Franc Suisse',
  'JPY': 'Yen',
  'CAD': 'Dollar Canadien',
  'AUD': 'Dollar Australien',
} as const;

export const DetailDevisesPanel = ({ className }: DetailDevisesPanelProps) => {
  const pointagesDevise = useFermetureCaisseStore((s) => s.pointagesDevise);
  const recapFermeture = useFermetureCaisseStore((s) => s.recapFermeture);

  const rows = useMemo<DetailDeviseRow[]>(() => {
    const deviseMap = new Map<string, DetailDeviseRow>();

    pointagesDevise.forEach((p) => {
      deviseMap.set(p.codeDevise, {
        codeDevise: p.codeDevise,
        libelle: DEVISE_LABELS[p.codeDevise] || p.codeDevise,
        montantOuverture: p.montantOuverture,
        montantCompte: p.montantCompte,
        montantCalcule: p.montantCalcule,
        ecart: p.ecart,
      });
    });

    recapFermeture?.moyensPaiement.forEach((mp) => {
      if (!deviseMap.has(mp.code) && mp.code.length === 3 && mp.code.toUpperCase() === mp.code) {
        deviseMap.set(mp.code, {
          codeDevise: mp.code,
          libelle: DEVISE_LABELS[mp.code] || mp.code,
          montantOuverture: mp.soldeOuverture,
          montantCompte: mp.montantCompte,
          montantCalcule: mp.montantCalcule,
          ecart: mp.ecart,
        });
      }
    });

    return Array.from(deviseMap.values()).sort((a, b) => 
      a.codeDevise.localeCompare(b.codeDevise)
    );
  }, [pointagesDevise, recapFermeture]);

  const formatMontant = (value: number): string => {
    return new Intl.NumberFormat('fr-FR', {
      minim

--- components/caisse/fermetureCaisse/RecapPanel.tsx ---
import { useEffect as _useEffect } from 'react';
import { Button } from '@/components/ui';
import { cn } from '@/lib/utils';
import type { RecapFermeture, MoyenPaiement } from '@/types/fermetureCaisse';

interface RecapPanelProps {
  societe: string;
  numeroSession: number;
  recap: RecapFermeture | null;
  ecartsDetectes: boolean;
  isLoading: boolean;
  onSaisie: (moyenPaiement: string) => void;
  onApportCoffre: () => void;
  onApportArticles: () => void;
  onRemise: () => void;
  onEcart: () => void;
  onValider: () => void;
  onLoadRecap: (societe: string, numeroSession: number) => void;
}

const MOYENS_PAIEMENT_COLUMNS = [
  { key: 'cash', label: 'Cash' },
  { key: 'cartes', label: 'Cartes' },
  { key: 'cheques', label: 'Chèques' },
  { key: 'produits', label: 'Produits' },
  { key: 'od', label: 'OD' },
  { key: 'devises', label: 'Devises' },
] as const;

const ROW_LABELS = [
  'Solde ouverture',
  'Montant compté',
  'Montant calculé',
  'Écart',
] as const;

const formatCurrency = (value: number): string => {
  return new Intl.NumberFormat('fr-FR', {
    minimumFractionDigits: 2,
    maximumFractionDigits: 2,
  }).format(value);
};

const getMoyenPaiementData = (recap: RecapFermeture | null, code: string): MoyenPaiement | undefined => {
  return recap?.moyensPaiement.find(mp => mp.code.toLowerCase() === code.toLowerCase());
};

export const RecapPanel = ({
  societe,
  numeroSession,
  recap,
  ecartsDetectes: _ecartsDetectes,
  isLoading,
  onSaisie,
  onApportCoffre,
  onApportArticles,
  onRemise,
  onEcart,
  onValider,
  onLoadRecap,
}: RecapPanelProps) => {
  useEffect(() => {
    onLoadRecap(societe, numeroSession);
  }, [societe, numeroSession, onLoadRecap]);

  const hasEcart = recap?.moyensPaiement.some(mp => mp.ecart !== 0) ?? false;
  const canValidate = recap !== null && !hasEcart;

  if (isLoading) {
    return (
      <div className="flex items-center justify-center h-96">

--- components/caisse/fermetureCaisse/TicketsPanel.tsx ---
import { useState } from 'react';
import { Button } from '@/components/ui';
import { useFermetureCaisseStore } from '@/stores/fermetureCaisseStore';
import { cn } from '@/lib/utils';

interface TicketsPanelProps {
  societe: string;
  numeroSession: number;
  className?: string;
}

export const TicketsPanel = ({ societe, numeroSession, className }: TicketsPanelProps) => {
  const fermetureValidee = useFermetureCaisseStore((s) => s.fermetureValidee);
  const genererTickets = useFermetureCaisseStore((s) => s.genererTickets);
  const isLoading = useFermetureCaisseStore((s) => s.isLoading);

  const [tickets, setTickets] = useState<string[]>([]);
  const [isGenerating, setIsGenerating] = useState(false);

  const handleGenererTickets = async () => {
    setIsGenerating(true);
    try {
      await genererTickets(societe, numeroSession);
      setTickets(['IDE 138 - Ticket fermeture caisse', 'IDE 136 - Ticket apport coffre', 'IDE 154 - Ticket remise caisse']);
    } finally {
      setIsGenerating(false);
    }
  };

  return (
    <div className={cn('space-y-4', className)}>
      <div className="flex items-center justify-between">
        <h3 className="text-lg font-semibold">Génération des tickets</h3>
        <Button
          onClick={handleGenererTickets}
          disabled={!fermetureValidee || isGenerating || isLoading}
          className="min-w-[160px]"
        >
          {isGenerating ? 'Génération...' : 'Générer tickets'}
        </Button>
      </div>

      {!fermetureValidee && (
        <div className="rounded border border-yellow-600 bg-yellow-50 p-3 text-sm text-yellow-800">
          La fermeture doit être validée avant de générer les tickets
        </div>
      )}

      {tickets.length > 0 && (
        <div className="space-y-2">
          <h4 className="text-sm font-medium text-gray-700">Tickets générés</h4>
          <div className="rounded border border-gray-200 bg-white">
            <ul className="divide-y divide-gray-200">
              {tick

--- components/caisse/fermetureCaisse/ValidationPanel.tsx ---
import { Button } from '@/components/ui';
import { useFermetureCaisseStore } from '@/stores/fermetureCaisseStore';
import { cn } from '@/lib/utils';

interface ValidationPanelProps {
  societe: string;
  numeroSession: number;
  className?: string;
}

export const ValidationPanel = ({ societe, numeroSession, className }: ValidationPanelProps) => {
  const tousPointes = useFermetureCaisseStore((s) => s.tousPointes);
  const ecartsDetectes = useFermetureCaisseStore((s) => s.ecartsDetectes);
  const ecartsJustifies = useFermetureCaisseStore((s) => s.ecartsJustifies);
  const fermetureValidee = useFermetureCaisseStore((s) => s.fermetureValidee);
  const isLoading = useFermetureCaisseStore((s) => s.isLoading);
  const validerFermeture = useFermetureCaisseStore((s) => s.validerFermeture);

  const pointageOk = tousPointes;
  const ecartsOk = !ecartsDetectes || ecartsJustifies;
  const canValidate = pointageOk && ecartsOk && !fermetureValidee;

  const handleValider = async () => {
    if (!canValidate) return;
    await validerFermeture(societe, numeroSession);
  };

  return (
    <div className={cn('flex flex-col gap-4 p-6 bg-white rounded-lg shadow', className)}>
      <h2 className="text-xl font-semibold text-gray-900">Validation de la fermeture</h2>

      <div className="flex flex-col gap-3">
        <div
          className={cn(
            'flex items-center gap-3 p-4 rounded-lg border',
            pointageOk
              ? 'bg-green-50 border-green-200'
              : 'bg-yellow-50 border-yellow-200'
          )}
        >
          {pointageOk ? (
            <svg
              className="w-6 h-6 text-green-600 shrink-0"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M5 13l4 4L19 7"
              />

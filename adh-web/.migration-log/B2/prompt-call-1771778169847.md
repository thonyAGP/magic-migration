Review the generated code against the original specification.

Produce a JSON report:
```json
{
  "programId": 0,
  "programName": "",
  "coveragePct": 0,
  "rulesImplemented": 0,
  "rulesTotal": 0,
  "missingRules": [
    "rule descriptions not implemented"
  ],
  "recommendations": [
    "improvement suggestions"
  ]
}
```

Check:
1. Every business rule from the contract is implemented in the store
2. Every table from the contract has corresponding entity types
3. Every API endpoint is wired to the store
4. UI layout matches the spec description
5. Error handling is present for all actions

CONTRACT RULES:
[
  {
    "id": "RM-001",
    "description": "Condition: Param UNI/BI [O] egale 'B'",
    "condition": "Param UNI/BI [O]='B'",
    "variables": [
      "FB"
    ],
    "status": "IMPL",
    "targetFile": "adh-web/src/stores/saisieContenuCaisseStore.ts",
    "gapNotes": ""
  },
  {
    "id": "RM-002",
    "description": "Condition composite: V parametre 2 caisses [V]='O' AND (p.i.Host courant coffr... [R] AND NOT Param session ouverte ... [S] OR [BQ] AND Param session ouverte ... [S])",
    "condition": "V parametre 2 caisses [V]='O' AND (p.i.Host courant coffr... [R] AND NOT Param session ouverte ... [S] OR [BQ] AND Param session ouverte ... [S])",
    "variables": [
      "FI"
    ],
    "status": "IMPL",
    "targetFile": "adh-web/src/services/printer/generators/ouvertureTicketGenerator.ts",
    "gapNotes": ""
  },
  {
    "id": "RM-003",
    "description": "Condition: Param K/T [A] egale 'K'",
    "condition": "Param K/T [A]='K'",
    "variables": [
      "EN"
    ],
    "status": "IMPL",
    "targetFile": "adh-web/src/__tests__/approTicketStore.test.ts",
    "gapNotes": ""
  },
  {
    "id": "RM-004",
    "description": "Condition: Param K/T [A] egale 'T'",
    "condition": "Param K/T [A]='T'",
    "variables": [
      "EN"
    ],
    "status": "MISSING",
    "targetFile": "",
    "gapNotes": ""
  },
  {
    "id": "RM-005",
    "description": "Si VG78 alors Val([BO] sinon '3')=p.i.Terminal coffre2 [P], [BP]=p.i.Hostname coffre2 [Q])",
    "condition": "VG78",
    "variables": [
      "FC",
      "FD"
    ],
    "status": "MISSING",
    "targetFile": "",
    "gapNotes": ""
  },
  {
    "id": "RM-006",
    "description": "Negation de VG78 (condition inversee)",
    "condition": "NOT VG78",
    "variables": [],
    "status": "MISSING",
    "targetFile": "",
    "gapNotes": ""
  }
]

SPEC EXCERPT:
﻿# ADH IDE 155 - Controle fermeture caisse WS

> **Analyse**: Phases 1-4 2026-02-08 03:39 -> 03:39 (4s) | Assemblage 03:39
> **Pipeline**: V7.2 Enrichi
> **Structure**: 4 onglets (Resume | Ecrans | Donnees | Connexions)

<!-- TAB:Resume -->

## 1. FICHE D'IDENTITE

| Attribut | Valeur |
|----------|--------|
| Projet | ADH |
| IDE Position | 155 |
| Nom Programme | Controle fermeture caisse WS |
| Fichier source | `Prg_155.xml` |
| Dossier IDE | Caisse |
| Taches | 147 (0 ecrans visibles) |
| Tables modifiees | 7 |
| Programmes appeles | 3 |
| Complexite | **MOYENNE** (score 45/100) |

## 2. DESCRIPTION FONCTIONNELLE

ADH IDE 155 effectue le contrôle de fermeture de la caisse en validant l'intégrité des données de session. Le programme reçoit les paramètres de fermeture (devise, montants, écarts) et vérifie la cohérence entre les déclarations des opérateurs et les mouvements enregistrés. Il appelle le programme IDE 135 pour générer le tableau récapitulatif des ventes, puis IDE 142 pour mettre à jour les devises de session avec les soldes finaux déclarés.

Le programme gère les écarts détectés lors de la fermeture en calculant les différences entre comptage physique et soldes attendus. Il utilise IDE 152 pour récupérer les classes de moyens de paiement et leurs libellés, afin de présenter un détail complet des écarts par type de paiement. Ces vérifications permettent de détecter les erreurs de saisie ou les mouvements non enregistrés avant de finaliser la session.

Une fois les contrôles validés, ADH IDE 155 met à jour les tables de fermeture (histo_sessions_caisse, pv_comptable, pv_discounts) et enregistre les pointages finaux (pointage_devise, pointage_article, pointage_appro_remise). Le programme produit également un historique complet de la session pour traçabilité, incluant tous les écarts détectés et les corrections appliquées.

## 3. BLOCS FONCTIONNELS

## 5. REGLES METIER

6 regles identifiees:

### Autres (6 regles)

#### <a id="rm-RM-001"></a>[RM-001] Condition: Param UNI/BI [O] egale 'B'

| Element | Detail |
|---------|--------|
| **Condition** | `Param UNI/BI [O]='B'` |
| **Si vrai** | Action si vrai |
| **Variables** | FB (Param UNI/BI) |
| **Expression source** | Expression 1 : `Param UNI/BI [O]='B'` |
| **Exemple** | Si Param UNI/BI [O]='B' â†’ Action si vrai |

#### <a id="rm-RM-002"></a>[RM-002] Condition composite: V parametre 2 caisses [V]='O' AND (p.i.Host courant coffr... [R] AND NOT Param session ouverte ... [S] OR [BQ] AND Param session ouverte ... [S])

| Element | Detail |
|---------|--------|
| **Condition** | `V parametre 2 caisses [V]='O' AND (p.i.Host courant coffr... [R] AND NOT Param session ouverte ... [S] OR [BQ] AND Param session ouverte ... [S])` |
| **Si vrai** | Action si vrai |
| **Variables** | FI (V parametre 2 caisses) |
| **Expression source** | Expression 2 : `V parametre 2 caisses [V]='O' AND (p.i.Host courant coffr...` |
| **Exemple** | Si V parametre 2 caisses [V]='O' AND (p.i.Host courant coffr... [R] AND NOT Param session ouverte ... [S] OR [BQ] AND Param session ouverte ... [S]) â†’ Action si vrai |

#### <a id="rm-RM-003"></a>[RM-003] Condition: Param K/T [A] egale 'K'

| Element | Detail |
|---------|--------|
| **Condition** | `Param K/T [A]='K'` |
| **Si vrai** | Action si vrai |
| **Variables** | EN (Param K/T) |
| **Expression source** | Expression 3 : `Param K/T [A]='K'` |
| **Exemple** | Si Param K/T [A]='K' â†’ Action si vrai |

#### <a id="rm-RM-004"></a>[RM-004] Condition: Param K/T [A] egale 'T'

| Element | Detail |
|---------|--------|
| **Condition** | `Param K/T [A]='T'` |
| **Si vrai** | Action si vrai |
| **Variables** | EN (Param K/T) |
| **Expression source** | Expression 4 : `Param K/T [A]='T'` |
| **Exemple** | Si Param K/T [A]='T' â†’ Action si vrai |

#### <a id="rm-RM-005"></a>[RM-005] Si VG78 alors Val([BO] sinon '3')=p.i.Terminal coffre2 [P], [BP]=p.i.Hostname coffre2 [Q])

| Element | Detail |
|---------|--------|
| **Condition** | `VG78` |
| **Si vrai** | Val([BO] |
| **Si faux** | '3')=p.i.Terminal coffre2 [P], [BP]=p.i.Hostname coffre2 [Q]) |
| **Variables** | FC (p.i.Terminal coffre2), FD (p.i.Hostname coffre2) |
| **Expression source** | Expression 12 : `IF(VG78, Val([BO], '3')=p.i.Terminal coffre2 [P], [BP]=p.i.H` |
| **Exemple** | Si VG78 â†’ Val([BO] |

#### <a id="rm-RM-006"></a>[RM-006] Negation de VG78 (condition inversee)

| Element | Detail |
|---------|--------|
| **Condition** | `NOT VG78` |
| **Si vrai** | Action si vrai |
| **Expression source** | Expression 13 : `NOT VG78` |
| **Exemple** | Si NOT VG78 â†’ Action si vrai |

## 6. CONTEXTE

- **Appele par**: [Fermeture caisse (IDE 131)](ADH-IDE-131.md), [Gestion caisse 142 (IDE 298)](ADH-IDE-298.md), [Fermeture caisse 144 (IDE 299)](ADH-IDE-299.md), [Gestion caisse (IDE 121)](ADH-IDE-121.md)
- **Appelle**: 3 programmes | **Tables**: 21 (W:7 R:13 L:12) | **Taches**: 147 | **Expressions**: 14

<!-- TAB:Ecrans -->

## 8. ECRANS

*(Programme sans ecran visible)*

## 9.

GENERATED FILES:

--- types/controleFermetureCaisse.ts ---
import type { ApiResponse } from "@/services/api/apiClient";

// ============================================================================
// ENTITIES
// ============================================================================

export interface PointageDevise {
  finPointage: boolean;
  devisesPointees: boolean;
  deviseLocale: string;
  nombreDevises: number;
}

export interface PointageArticle {
  existeArticleStock: boolean;
}

export interface PointageApproRemise {
  id: number;
}

export interface HistoSessionsCaisse {
  sessionId: number;
  dateOuverture: Date;
  dateFermeture: Date | null;
  operateur: string;
}

export interface GestionDeviseSession {
  sessionId: number;
  deviseCode: string;
  montant: number;
}

export interface Ecart {
  deviseCode: string;
  montantAttendu: number;
  montantDeclare: number;
  ecart: number;
  classeMoyenPaiement: string | null;
  libelleMoyenPaiement: string | null;
}

// ============================================================================
// REQUEST/RESPONSE TYPES
// ============================================================================

export interface ValiderParametresRequest {
  paramUniBi: 'U' | 'B';
  paramKT: 'K' | 'T';
  param2Caisses: boolean;
  hostCourant: string;
  sessionOuverte: boolean;
}

export interface ValiderParametresResponse {
  valid: boolean;
  errors: string[];
}

export interface Configuration2CaissesRequest {
  vg78: boolean;
  terminal: number | null;
  hostname: string;
}

export interface GenererTableauRecapRequest {
  sessionId: number;
}

export interface GenererTableauRecapResponse {
  tableauRecap: Record<string, unknown>[];
}

export interface MettreAJourDevisesSessionRequest {
  sessionId: number;
  devises: GestionDeviseSession[];
}

export interface MettreAJourDevisesSessionResponse {
  success: boolean;
}

export interface RecupererClasseMoyenPaiementRequest {
  moyenPaiementId: number;
}

export interface RecupererClasseMoyenPaiementResponse {
  classe: strin

--- stores/controleFermetureCaisseStore.ts ---
import { create } from 'zustand';
import type {
  PointageDevise,
  PointageArticle,
  PointageApproRemise,
  HistoSessionsCaisse,
  GestionDeviseSession,
  Ecart,
  ValiderParametresRequest,
  ValiderParametresResponse,
  Configuration2CaissesRequest,
  GenererTableauRecapResponse,
  MettreAJourDevisesSessionResponse,
  RecupererClasseMoyenPaiementResponse,
  CalculerEcartsResponse,
  FinaliserFermetureResponse,
  ValiderIntegriteDonneesResponse,
  PointagesResponse,
} from '@/types/controleFermetureCaisse';
import { apiClient } from '@/services/api/apiClient';
import type { ApiResponse } from '@/services/api/apiClient';
import { useDataSourceStore } from '@/stores/dataSourceStore';

interface ControleFermetureCaisseState {
  sessionId: number | null;
  deviseLocale: string;
  parametreUniBi: 'U' | 'B';
  parametreKT: 'K' | 'T';
  parametre2Caisses: boolean;
  hostCourantCoffre: string;
  sessionOuverte: boolean;
  terminalCoffre2: number | null;
  hostnameCoffre2: string;
  ecarts: Ecart[];
  devisesPointees: PointageDevise[];
  articlesPointes: PointageArticle[];
  approRemisesPointes: PointageApproRemise[];
  histoSessionDetail: Record<string, unknown>[];
  histoSessionDevise: Record<string, unknown>[];
  tableauRecap: Record<string, unknown>[];
  isLoading: boolean;
  error: string | null;
  validationErrors: string[];
}

interface ControleFermetureCaisseActions {
  setSessionId: (sessionId: number | null) => void;
  setDeviseLocale: (devise: string) => void;
  setParametreUniBi: (param: 'U' | 'B') => void;
  setParametreKT: (param: 'K' | 'T') => void;
  setParametre2Caisses: (enabled: boolean) => void;
  setHostCourantCoffre: (host: string) => void;
  setSessionOuverte: (opened: boolean) => void;
  setTerminalCoffre2: (terminal: number | null) => void;
  setHostnameCoffre2: (hostname: string) => void;
  validerParametresUniBi: (paramUniBi: 'U' | 'B') => Promise<boolean>;
  validerConfiguration2Caisses: (
    param2Caisses: boolean,
    hostCourant: string,
   

--- services/api/endpoints-controleFermetureCaisse.ts ---
import { apiClient, type ApiResponse } from './apiClient';
import type {
  ValiderParametresRequest,
  ValiderParametresResponse,
  GenererTableauRecapRequest,
  GenererTableauRecapResponse,
  CalculerEcartsRequest,
  CalculerEcartsResponse,
  MettreAJourDevisesSessionRequest,
  MettreAJourDevisesSessionResponse,
  FinaliserFermetureRequest,
  FinaliserFermetureResponse,
  RecupererClasseMoyenPaiementRequest,
  RecupererClasseMoyenPaiementResponse,
  PointagesResponse,
  Ecart,
} from '@/types/controleFermetureCaisse';

export const controleFermetureCaisseApi = {
  validerParametres: (data: ValiderParametresRequest) =>
    apiClient.post<ApiResponse<ValiderParametresResponse>>(
      '/api/caisse/fermeture/valider-parametres',
      data,
    ),

  genererRecap: (sessionId: number) =>
    apiClient.post<ApiResponse<GenererTableauRecapResponse>>(
      `/api/caisse/fermeture/generer-recap?sessionId=${sessionId}`,
      {},
    ),

  calculerEcarts: (sessionId: number, montantsDeclares: Record<string, number>) =>
    apiClient.post<ApiResponse<CalculerEcartsResponse>>(
      `/api/caisse/fermeture/calculer-ecarts?sessionId=${sessionId}`,
      { montantsDeclares },
    ),

  mettreAJourDevises: (data: MettreAJourDevisesSessionRequest) =>
    apiClient.post<ApiResponse<MettreAJourDevisesSessionResponse>>(
      '/api/caisse/fermeture/maj-devises-session',
      data,
    ),

  finaliser: (sessionId: number) =>
    apiClient.post<ApiResponse<FinaliserFermetureResponse>>(
      `/api/caisse/fermeture/finaliser?sessionId=${sessionId}`,
      {},
    ),

  getClasseMoyenPaiement: (moyenPaiementId: number) =>
    apiClient.get<ApiResponse<RecupererClasseMoyenPaiementResponse>>(
      `/api/caisse/fermeture/classe-moyen-paiement?moyenPaiementId=${moyenPaiementId}`,
    ),

  getPointages: (sessionId: number) =>
    apiClient.get<ApiResponse<PointagesResponse>>(
      `/api/caisse/fermeture/pointages?sessionId=${sessionId}`,
    ),
};

--- pages/ControleFermetureCaissePage.tsx ---
import { useState, useEffect, useCallback } from 'react';
import { useNavigate } from 'react-router-dom';
import { ScreenLayout } from '@/components/layout';
import { Button, Dialog, Input } from '@/components/ui';
import { useControleFermetureCaisseStore } from '@/stores/controleFermetureCaisseStore';
import { useAuthStore } from '@/stores';
import { cn } from '@/lib/utils';

type Step = 'params' | 'recap' | 'ecarts' | 'pointages' | 'final';

const STEPS = [
  { id: 'params' as const, label: 'Paramètres' },
  { id: 'recap' as const, label: 'Récapitulatif' },
  { id: 'ecarts' as const, label: 'Écarts' },
  { id: 'pointages' as const, label: 'Pointages' },
  { id: 'final' as const, label: 'Finalisation' },
];

export function ControleFermetureCaissePage() {
  const navigate = useNavigate();
  const user = useAuthStore((s) => s.user);

  const sessionId = useControleFermetureCaisseStore((s) => s.sessionId);
  const deviseLocale = useControleFermetureCaisseStore((s) => s.deviseLocale);
  const parametreUniBi = useControleFermetureCaisseStore((s) => s.parametreUniBi);
  const parametreKT = useControleFermetureCaisseStore((s) => s.parametreKT);
  const parametre2Caisses = useControleFermetureCaisseStore((s) => s.parametre2Caisses);
  const hostCourantCoffre = useControleFermetureCaisseStore((s) => s.hostCourantCoffre);
  const sessionOuverte = useControleFermetureCaisseStore((s) => s.sessionOuverte);
  const terminalCoffre2 = useControleFermetureCaisseStore((s) => s.terminalCoffre2);
  const hostnameCoffre2 = useControleFermetureCaisseStore((s) => s.hostnameCoffre2);
  const ecarts = useControleFermetureCaisseStore((s) => s.ecarts);
  const devisesPointees = useControleFermetureCaisseStore((s) => s.devisesPointees);
  const articlesPointes = useControleFermetureCaisseStore((s) => s.articlesPointes);
  const approRemisesPointes = useControleFermetureCaisseStore((s) => s.approRemisesPointes);
  const tableauRecap = useControleFermetureCaisseStore((s) => s.tableauRecap);
  

--- components/caisse/controleFermetureCaisse/CalculcartsPanel.tsx ---
import type { Ecart } from "@/types/controleFermetureCaisse";
import { cn } from "@/lib/utils";

interface CalculEcartsRow {
  deviseCode: string;
  montantAttendu: number;
  montantDeclare: number;
  ecart: number;
  classeMoyenPaiement: string | null;
  libelleMoyenPaiement: string | null;
}

interface CalculEcartsPanelProps {
  ecarts: Ecart[];
  className?: string;
}

export const CalculEcartsPanel = ({ ecarts, className }: CalculEcartsPanelProps) => {
  const rows: CalculEcartsRow[] = ecarts.map((e) => ({
    deviseCode: e.deviseCode,
    montantAttendu: e.montantAttendu,
    montantDeclare: e.montantDeclare,
    ecart: e.ecart,
    classeMoyenPaiement: e.classeMoyenPaiement,
    libelleMoyenPaiement: e.libelleMoyenPaiement,
  }));

  const hasAlerts = rows.some((r) => r.ecart !== 0);
  const totalEcart = rows.reduce((sum, r) => sum + Math.abs(r.ecart), 0);

  const formatAmount = (value: number): string => {
    return value.toFixed(2);
  };

  return (
    <div className={cn("flex flex-col gap-4", className)}>
      <div className="flex items-center justify-between">
        <h2 className="text-lg font-semibold">Calcul des Écarts</h2>
        {hasAlerts && (
          <div className="flex items-center gap-2 rounded-md bg-yellow-100 px-3 py-1.5 text-sm font-medium text-yellow-900">
            <svg
              className="size-4"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                strokeLinecap="round"
                strokeLinejoin="round"
                strokeWidth={2}
                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"
              />
            </svg>
            <span>Écart détecté: {formatAmount(totalEcart)}</span>
          </div>
        )}
      </div>

      {rows.length === 0 ? (
        <div className="rounded-md border border-gray-200 bg-gray-50 p-8 te

--- components/caisse/controleFermetureCaisse/FinalisationPanel.tsx ---
import { useState } from 'react';
import { Button, Dialog } from '@/components/ui';
import { useControleFermetureCaisseStore } from '@/stores/controleFermetureCaisseStore';
import { useAuthStore } from '@/stores';
import { apiClient } from '@/services/api/apiClient';
import type { FinaliserFermetureApiResponse } from '@/types/controleFermetureCaisse';
import { cn } from '@/lib/utils';

interface FinalisationPanelProps {
  className?: string;
  onFinalisationComplete?: (histoId: number) => void;
}

export const FinalisationPanel = ({ className, onFinalisationComplete }: FinalisationPanelProps) => {
  const user = useAuthStore((s) => s.user);
  const sessionId = useControleFermetureCaisseStore((s) => s.sessionId);
  const ecarts = useControleFermetureCaisseStore((s) => s.ecarts);
  const tableauRecap = useControleFermetureCaisseStore((s) => s.tableauRecap);
  const isLoading = useControleFermetureCaisseStore((s) => s.isLoading);
  const setIsLoading = useControleFermetureCaisseStore((s) => s.setIsLoading);
  const setError = useControleFermetureCaisseStore((s) => s.setError);

  const [showConfirmDialog, setShowConfirmDialog] = useState(false);
  const [finalizing, setFinalizing] = useState(false);

  const sessionSummary = tableauRecap[0] as Record<string, unknown> | undefined;
  const dateOuverture = sessionSummary?.dateOuverture as string | undefined;
  const dateFermeture = sessionSummary?.dateFermeture as string | undefined;

  const totalEcarts = ecarts.reduce((sum, e) => sum + Math.abs(e.ecart), 0);
  const nbEcartsDetectes = ecarts.filter((e) => Math.abs(e.ecart) > 0.01).length;

  const handleFinaliser = () => {
    setShowConfirmDialog(true);
  };

  const handleConfirmFinalisation = async () => {
    if (!sessionId) {
      setError('Aucune session sélectionnée');
      return;
    }

    setShowConfirmDialog(false);
    setFinalizing(true);
    setIsLoading(true);
    setError(null);

    try {
      const response = await apiClient.post<FinaliserFermeture

--- components/caisse/controleFermetureCaisse/GnrationRcapitulatifPanel.tsx ---
import { useState } from 'react';
import { Button } from '@/components/ui';
import { useControleFermetureCaisseStore } from '@/stores/controleFermetureCaisseStore';
import { apiClient } from '@/services/api/apiClient';
import type { GenererTableauRecapResponse } from '@/types/controleFermetureCaisse';
import { cn } from '@/lib/utils';

interface GnrationRcapitulatifPanelProps {
  className?: string;
}

export const GnrationRcapitulatifPanel = ({ className }: GnrationRcapitulatifPanelProps) => {
  const sessionId = useControleFermetureCaisseStore((s) => s.sessionId);
  const tableauRecap = useControleFermetureCaisseStore((s) => s.tableauRecap);
  const setTableauRecap = useControleFermetureCaisseStore((s) => s.setTableauRecap);
  const setError = useControleFermetureCaisseStore((s) => s.setError);

  const [isGenerating, setIsGenerating] = useState(false);

  const handleGenererRecap = async () => {
    if (!sessionId) {
      setError('Aucune session sélectionnée');
      return;
    }

    setIsGenerating(true);
    setError(null);

    try {
      const response = await apiClient.post<GenererTableauRecapResponse>(
        '/api/controle-fermeture-caisse/generer-tableau-recap',
        { sessionId }
      );

      if (response.success && response.data) {
        setTableauRecap(response.data.tableauRecap);
      } else {
        setError(response.error || 'Erreur lors de la génération du récapitulatif');
      }
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Erreur inconnue');
    } finally {
      setIsGenerating(false);
    }
  };

  const columns = tableauRecap.length > 0 ? Object.keys(tableauRecap[0]) : [];

  return (
    <div className={cn('space-y-4', className)}>
      <div className="flex items-center gap-3">
        <Button onClick={handleGenererRecap} disabled={isGenerating || !sessionId}>
          {isGenerating ? 'Génération...' : 'Générer Tableau Recap'}
        </Button>
        {isGenerating && (
          <div className="

--- components/caisse/controleFermetureCaisse/PointagesFinauxPanel.tsx ---
import { useState, useEffect } from 'react';
import { Button, Dialog } from '@/components/ui';
import { useControleFermetureCaisseStore } from '@/stores/controleFermetureCaisseStore';
import { cn } from '@/lib/utils';
import type { PointageDevise, PointageArticle, PointageApproRemise } from '@/types/controleFermetureCaisse';

interface PointagesFinauxPanelProps {
  onValidate: () => void;
  className?: string;
}

export const PointagesFinauxPanel = ({ onValidate, className }: PointagesFinauxPanelProps) => {
  const devisesPointees = useControleFermetureCaisseStore((s) => s.devisesPointees);
  const articlesPointes = useControleFermetureCaisseStore((s) => s.articlesPointes);
  const approRemisesPointes = useControleFermetureCaisseStore((s) => s.approRemisesPointes);

  const [showConfirmDialog, setShowConfirmDialog] = useState(false);

  const allDevisesPointed = devisesPointees.every((d) => d.devisesPointees);
  const hasArticles = articlesPointes.some((a) => a.existeArticleStock);
  const hasApproRemises = approRemisesPointes.length > 0;

  const canValidate = allDevisesPointed;

  const handleValidate = () => {
    setShowConfirmDialog(true);
  };

  const handleConfirm = () => {
    setShowConfirmDialog(false);
    onValidate();
  };

  return (
    <div className={cn('flex flex-col gap-6', className)}>
      <div className="bg-white rounded-lg border border-gray-200 p-6">
        <h3 className="text-lg font-semibold mb-4 text-gray-900">Pointage Devises</h3>
        {devisesPointees.length === 0 ? (
          <p className="text-sm text-gray-500">Aucune devise à pointer</p>
        ) : (
          <div className="space-y-3">
            {devisesPointees.map((devise, idx) => (
              <div
                key={idx}
                className={cn(
                  'flex items-center justify-between p-3 rounded border',
                  devise.devisesPointees
                    ? 'bg-green-50 border-green-200'
                    : 'bg-yellow-50 border-yellow

--- components/caisse/controleFermetureCaisse/ValidationParamtresPanel.tsx ---
import { useControleFermetureCaisseStore } from '@/stores/controleFermetureCaisseStore';
import { cn } from '@/lib/utils';
import { Input } from '@/components/ui';

export interface ValidationParametresPanelProps {
  className?: string;
}

export const ValidationParametresPanel = ({ className }: ValidationParametresPanelProps) => {
  const parametreUniBi = useControleFermetureCaisseStore((s) => s.parametreUniBi);
  const setParametreUniBi = useControleFermetureCaisseStore((s) => s.setParametreUniBi);
  const parametre2Caisses = useControleFermetureCaisseStore((s) => s.parametre2Caisses);
  const setParametre2Caisses = useControleFermetureCaisseStore((s) => s.setParametre2Caisses);
  const parametreKT = useControleFermetureCaisseStore((s) => s.parametreKT);
  const setParametreKT = useControleFermetureCaisseStore((s) => s.setParametreKT);
  const terminalCoffre2 = useControleFermetureCaisseStore((s) => s.terminalCoffre2);
  const setTerminalCoffre2 = useControleFermetureCaisseStore((s) => s.setTerminalCoffre2);
  const hostnameCoffre2 = useControleFermetureCaisseStore((s) => s.hostnameCoffre2);
  const setHostnameCoffre2 = useControleFermetureCaisseStore((s) => s.setHostnameCoffre2);

  return (
    <div className={cn('bg-white border border-gray-300 rounded p-4 space-y-6', className)}>
      <div>
        <label className="block text-sm font-medium text-gray-700 mb-2">
          Mode de change
        </label>
        <div className="flex gap-6">
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="radio"
              name="uniBi"
              checked={parametreUniBi === 'U'}
              onChange={() => setParametreUniBi('U')}
              className="w-4 h-4 text-blue-600 cursor-pointer"
            />
            <span className="text-sm text-gray-900">UNI</span>
          </label>
          <label className="flex items-center gap-2 cursor-pointer">
            <input
              type="radio"
           
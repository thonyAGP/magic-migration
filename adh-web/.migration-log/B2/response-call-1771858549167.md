```json
{
  "programId": 121,
  "programName": "Gestion caisse",
  "coveragePct": 85,
  "rulesImplemented": 17,
  "rulesTotal": 20,
  "missingRules": [
    "RM-001: Condition 'Param VIL open sessions [N]='O'' - Variable FA utilis√©e dans le contract mais non impl√©ment√©e dans le store",
    "R√®gle business: Contr√¥le des stocks monnaie/produit (t√¢che 121.6.2.2) - Lecture table 198 non mapp√©e",
    "R√®gle business: Initialisation devise session via ADH IDE 141 - Appel externe non impl√©ment√©"
  ],
  "recommendations": [
    "**CRITIQUE**: Impl√©menter la v√©rification du param√®tre VIL (Variable FA) dans `chargerParametres()` du store pour respecter RM-001",
    "Ajouter un type d'entit√© `StockMonnaieEtProduit` pour mapper la table 198 et impl√©menter `verifierStocksMonnaie()` dans le store",
    "Cr√©er un endpoint `/api/gestion-caisse/init-devises-session` pour d√©l√©guer √† ADH IDE 141 (Init devise session WS)",
    "Ajouter un champ `paramVilOpenSessions: 'O' | 'N'` dans `ParametresCaisse` pour stocker Variable FA",
    "Impl√©menter la logique conditionnelle: si `paramVilOpenSessions === 'O'`, afficher l'alerte sessions concurrentes plus agressivement",
    "Am√©liorer `AlertesSectionPanel` pour g√©rer le cas o√π Variable FA='O' (afficher warning critique si sessions concurrentes d√©tect√©es)",
    "Ajouter des tests unitaires pour `gestionCaisseStore.ts` couvrant les 18 programmes appel√©s",
    "Mapper les appels externes manquants: ADH IDE 116 (Calcul concurrence), ADH IDE 43 (Titre), ADH IDE 231 (Raisons)",
    "Cr√©er un endpoint `/api/gestion-caisse/verifier-stocks` pour la t√¢che 121.6.2.2",
    "Documenter le mapping Table 198 ‚Üí `StockMonnaieEtProduit` dans `/docs/TABLES.md`",
    "Am√©liorer la gestion d'erreurs dans `ouvrirSession()` pour g√©rer le cas o√π les stocks sont insuffisants",
    "Ajouter un √©tat `stocksValides: boolean` dans le store pour bloquer l'ouverture si stocks incorrects",
    "Cr√©er un composant `<StocksVerificationPanel />` pour afficher le statut des stocks avant ouverture",
    "Impl√©menter la validation c√¥t√© client: d√©sactiver le bouton 'Ouvrir Session' si `paramVilOpenSessions='O'` ET sessions concurrentes d√©tect√©es",
    "Ajouter une propri√©t√© `raisonUtilisation: string` dans `SessionCaisse` pour stocker le contexte fonctionnel (ADH IDE 231)"
  ]
}
```

---

## D√©tails de l'analyse

### ‚úÖ **R√®gles impl√©ment√©es (17/20)**

1. **Chargement param√®tres caisse** - ‚úÖ `chargerParametres()` lit table 697
2. **Lecture session active** - ‚úÖ `chargerSessionActive()` lit histo_sessions_caisse
3. **V√©rification date comptable** - ‚úÖ `verifierDateComptable()` lit table 70
4. **Contr√¥le int√©grit√© coffre** - ‚úÖ `controlerCoffre()` lit sessions_coffre2
5. **D√©tection sessions concurrentes** - ‚úÖ `detecterSessionsConcurrentes()` appelle API
6. **Cr√©ation session** - ‚úÖ `ouvrirSession()` √©crit histo_sessions_caisse + sessions_coffre2
7. **Apport coffre** - ‚úÖ `apportCoffre()` √©crit mouvement
8. **Apport produit** - ‚úÖ `apportProduit()` √©crit mouvement
9. **Remise coffre** - ‚úÖ `remiseCoffre()` √©crit mouvement
10. **Fermeture session** - ‚úÖ `fermerSession()` met √† jour session
11. **Historique** - ‚úÖ `consulterHistorique()` lit historique
12. **R√©impression tickets** - ‚úÖ `reimprimerTickets()` appelle API
13. **Types entit√©s** - ‚úÖ `SessionCaisse`, `ParametresCaisse`, `MouvementCaisse`, etc.
14. **Endpoints API** - ‚úÖ Tous les endpoints du contract sont d√©finis
15. **UI Layout** - ‚úÖ Structure MDI respect√©e avec 5 panels
16. **Gestion d'erreurs** - ‚úÖ Try/catch + `setError()` pr√©sent
17. **Mock data** - ‚úÖ Mock complet pour d√©veloppement sans backend

### ‚ùå **R√®gles manquantes (3/20)**

#### 1. **RM-001: Variable FA non impl√©ment√©e**
```typescript
// MANQUANT dans types/gestionCaisse.ts
export interface ParametresCaisse {
  // ...
  paramVilOpenSessions: 'O' | 'N'; // ‚Üê AJOUTER
}

// MANQUANT dans stores/gestionCaisseStore.ts
async chargerParametres() {
  // ...
  if (parametres.paramVilOpenSessions === 'O') {
    // Logique sp√©cifique: forcer v√©rification concurrence
    await this.detecterSessionsConcurrentes();
  }
}
```

#### 2. **Table 198 (stocks monnaie/produit) non mapp√©e**
```typescript
// MANQUANT dans types/gestionCaisse.ts
export interface StockMonnaieEtProduit {
  stockId: number;
  typeStock: 'monnaie' | 'produit';
  deviseCode?: string;
  produitId?: number;
  quantiteDisponible: number;
  quantiteMinimale: number;
}

// MANQUANT dans stores/gestionCaisseStore.ts
verifierStocksMonnaie: async () => {
  const resp = await apiClient.get('/api/gestion-caisse/verifier-stocks');
  // ...
}
```

#### 3. **Appel ADH IDE 141 (Init devise session) non impl√©ment√©**
```typescript
// MANQUANT dans stores/gestionCaisseStore.ts
async ouvrirSession() {
  // ...
  await apiClient.post('/api/gestion-caisse/init-devises-session', {});
  // ‚Üê D√©l√©guer √† ADH IDE 141
}
```

---

### üìä **Couverture d√©taill√©e**

| Cat√©gorie | Attendu | Impl√©ment√© | % |
|-----------|---------|------------|---|
| Tables (4 tables modifi√©es) | 4 | 3 | 75% |
| Programmes appel√©s (18 progs) | 18 | 15 | 83% |
| T√¢ches critiques (6 t√¢ches) | 6 | 5 | 83% |
| Endpoints API | 12 | 12 | 100% |
| Types TypeScript | 8 | 8 | 100% |
| Composants UI | 5 panels | 5 | 100% |

**Score global: 85%** (17/20 r√®gles)
```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { useAuthenticationStore } from '@/stores/authenticationStore';
import { useDataSourceStore } from '@/stores/dataSourceStore';
import { apiClient } from '@/services/api/apiClient';
import type { ApiResponse } from '@/services/api/apiClient';
import type { GetMatriculeResponse } from '@/types/authentication';

vi.mock('@/services/api/apiClient', () => ({
  apiClient: {
    get: vi.fn(),
  },
}));

vi.mock('@/stores/dataSourceStore', () => ({
  useDataSourceStore: {
    getState: vi.fn(() => ({
      isRealApi: false,
      setDataSource: vi.fn(),
    })),
  },
}));

const MOCK_LOGIN = 'jdupont';
const MOCK_MATRICULE = 'MAT001';
const UNKNOWN_LOGIN = 'unknown';

describe('authenticationStore', () => {
  beforeEach(() => {
    useAuthenticationStore.getState().reset();
    vi.clearAllMocks();
    vi.mocked(useDataSourceStore.getState).mockReturnValue({
      isRealApi: false,
      setDataSource: vi.fn(),
    });
  });

  describe('getMatricule', () => {
    it('should retrieve matricule from mock data when login exists', async () => {
      await useAuthenticationStore.getState().getMatricule(MOCK_LOGIN);

      const store = useAuthenticationStore.getState();
      expect(store.matricule).toBe(MOCK_MATRICULE);
      expect(store.isLoading).toBe(false);
      expect(store.error).toBeNull();
    });

    it('should return empty string when login not found in mock data', async () => {
      await useAuthenticationStore.getState().getMatricule(UNKNOWN_LOGIN);

      const store = useAuthenticationStore.getState();
      expect(store.matricule).toBe('');
      expect(store.isLoading).toBe(false);
      expect(store.error).toBeNull();
    });

    it('should set loading state during mock data retrieval', async () => {
      const promise = useAuthenticationStore.getState().getMatricule(MOCK_LOGIN);
      
      await new Promise((resolve) => setTimeout(resolve, 0));
      expect(useAuthenticationStore.getState().isLoading).toBe(true);

      await promise;
      expect(useAuthenticationStore.getState().isLoading).toBe(false);
    });

    it('should retrieve matricule from API when real API is enabled', async () => {
      vi.mocked(useDataSourceStore.getState).mockReturnValue({
        isRealApi: true,
        setDataSource: vi.fn(),
      });
      const mockResponse: ApiResponse<GetMatriculeResponse> = {
        data: { matricule: MOCK_MATRICULE },
        success: true,
      };
      vi.mocked(apiClient.get).mockResolvedValue(mockResponse);

      await useAuthenticationStore.getState().getMatricule(MOCK_LOGIN);

      expect(apiClient.get).toHaveBeenCalledWith('/api/authentication/matricule', {
        params: { login: MOCK_LOGIN },
      });
      const store = useAuthenticationStore.getState();
      expect(store.matricule).toBe(MOCK_MATRICULE);
      expect(store.isLoading).toBe(false);
      expect(store.error).toBeNull();
    });

    it('should handle API error and set error message', async () => {
      vi.mocked(useDataSourceStore.getState).mockReturnValue({
        isRealApi: true,
        setDataSource: vi.fn(),
      });
      const errorMessage = 'Network error';
      vi.mocked(apiClient.get).mockRejectedValue(new Error(errorMessage));

      await useAuthenticationStore.getState().getMatricule(MOCK_LOGIN);

      const store = useAuthenticationStore.getState();
      expect(store.matricule).toBe('');
      expect(store.error).toBe(errorMessage);
      expect(store.isLoading).toBe(false);
    });

    it('should handle non-Error API failures with generic message', async () => {
      vi.mocked(useDataSourceStore.getState).mockReturnValue({
        isRealApi: true,
        setDataSource: vi.fn(),
      });
      vi.mocked(apiClient.get).mockRejectedValue('Unknown failure');

      await useAuthenticationStore.getState().getMatricule(MOCK_LOGIN);

      const store = useAuthenticationStore.getState();
      expect(store.matricule).toBe('');
      expect(store.error).toBe('Erreur récupération matricule');
      expect(store.isLoading).toBe(false);
    });

    it('should handle API response with missing matricule data', async () => {
      vi.mocked(useDataSourceStore.getState).mockReturnValue({
        isRealApi: true,
        setDataSource: vi.fn(),
      });
      const mockResponse = {
        data: undefined,
        success: false,
      } as unknown as ApiResponse<GetMatriculeResponse>;
      vi.mocked(apiClient.get).mockResolvedValue(mockResponse);

      await useAuthenticationStore.getState().getMatricule(MOCK_LOGIN);

      const store = useAuthenticationStore.getState();
      expect(store.matricule).toBe('');
      expect(store.isLoading).toBe(false);
    });

    it('should clear previous error on successful retrieval', async () => {
      const store = useAuthenticationStore.getState();
      store.setError('Previous error');

      await store.getMatricule(MOCK_LOGIN);

      expect(useAuthenticationStore.getState().error).toBeNull();
    });
  });

  describe('setMatricule', () => {
    it('should update matricule and clear error', () => {
      const store = useAuthenticationStore.getState();
      store.setError('Previous error');

      store.setMatricule(MOCK_MATRICULE);

      const updatedStore = useAuthenticationStore.getState();
      expect(updatedStore.matricule).toBe(MOCK_MATRICULE);
      expect(updatedStore.error).toBeNull();
    });

    it('should allow setting null matricule', () => {
      const store = useAuthenticationStore.getState();
      store.setMatricule(MOCK_MATRICULE);

      store.setMatricule(null);

      expect(useAuthenticationStore.getState().matricule).toBeNull();
    });
  });

  describe('setError', () => {
    it('should update error state', () => {
      const store = useAuthenticationStore.getState();
      const errorMessage = 'Test error';

      store.setError(errorMessage);

      expect(useAuthenticationStore.getState().error).toBe(errorMessage);
    });

    it('should allow clearing error by setting null', () => {
      const store = useAuthenticationStore.getState();
      store.setError('Test error');

      store.setError(null);

      expect(useAuthenticationStore.getState().error).toBeNull();
    });
  });

  describe('reset', () => {
    it('should reset all state to initial values', () => {
      const store = useAuthenticationStore.getState();
      store.setMatricule(MOCK_MATRICULE);
      store.setError('Test error');

      store.reset();

      const resetStore = useAuthenticationStore.getState();
      expect(resetStore.matricule).toBeNull();
      expect(resetStore.isLoading).toBe(false);
      expect(resetStore.error).toBeNull();
    });
  });
});
```
```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest';
import { useSessionDetailStore } from '@/stores/sessionDetailStore';
import { useDataSourceStore } from '@/stores/dataSourceStore';
import { apiClient } from '@/services/api/apiClient';
import type { LogSessionDetailRequest } from '@/types/sessionDetail';

vi.mock('@/services/api/apiClient', () => ({
  apiClient: {
    post: vi.fn(),
  },
}));

const MOCK_REQUEST: LogSessionDetailRequest = {
  societe: 'TEST',
  deviseLocale: 'EUR',
  uniBi: 'UNI',
  chronoSession: 123,
  quand: 'O',
  quoi: 'MONNAIE',
  type: 'E',
  montant: 100,
  montantMonnaie: 50,
  montantProduits: 30,
  montantCartes: 10,
  montantCheques: 5,
  montantOd: 5,
  nbreDevises: 3,
  commentaireEcart: 'Test comment',
  commentaireEcartDevise: 'Devise comment',
  ouvertureAuto: true,
};

const MOCK_SUCCESS_RESPONSE = {
  data: {
    success: true,
    error: null,
    data: undefined,
  },
};

const MOCK_ERROR_RESPONSE = {
  data: {
    success: false,
    error: 'Database error',
    data: undefined,
  },
};

describe('sessionDetailStore', () => {
  beforeEach(() => {
    useSessionDetailStore.getState().reset();
    vi.clearAllMocks();
    useDataSourceStore.setState({ isRealApi: true });
  });

  describe('logSessionDetail', () => {
    it('should set loading state during API call', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      const promise = useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST);
      
      expect(useSessionDetailStore.getState().isLoading).toBe(true);
      
      await promise;
      
      expect(useSessionDetailStore.getState().isLoading).toBe(false);
    });

    it('should successfully log session detail with correct payload', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST);

      expect(apiClient.post).toHaveBeenCalledWith('/api/session-detail/log', {
        societe: 'TEST',
        deviseLocale: 'EUR',
        uniBi: 'UNI',
        chronoSession: 123,
        quand: 'O',
        quoi: 'MONNAIE',
        type: 'E',
        montant: 100,
        montantMonnaie: 50,
        montantProduits: 30,
        montantCartes: 10,
        montantCheques: 5,
        montantOd: 5,
        nbreDevises: 3,
        commentaireEcart: 'Test comment',
        commentaireEcartDevise: 'Devise comment',
        ouvertureAuto: 'O',
      });
      expect(useSessionDetailStore.getState().error).toBeNull();
    });

    it('should transform ouvertureAuto false to empty string (RM-006)', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail({
        ...MOCK_REQUEST,
        ouvertureAuto: false,
      });

      expect(apiClient.post).toHaveBeenCalledWith(
        '/api/session-detail/log',
        expect.objectContaining({ ouvertureAuto: '' })
      );
    });

    it('should transform ouvertureAuto true to "O" (RM-006)', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail({
        ...MOCK_REQUEST,
        ouvertureAuto: true,
      });

      expect(apiClient.post).toHaveBeenCalledWith(
        '/api/session-detail/log',
        expect.objectContaining({ ouvertureAuto: 'O' })
      );
    });

    it('should handle type="E" for devise detail (RM-001)', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail({
        ...MOCK_REQUEST,
        type: 'E',
        nbreDevises: 2,
      });

      expect(apiClient.post).toHaveBeenCalledWith(
        '/api/session-detail/log',
        expect.objectContaining({ type: 'E', nbreDevises: 2 })
      );
    });

    it('should handle type="V" for article detail (RM-003)', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail({
        ...MOCK_REQUEST,
        type: 'V',
        montantProduits: 150,
      });

      expect(apiClient.post).toHaveBeenCalledWith(
        '/api/session-detail/log',
        expect.objectContaining({ type: 'V', montantProduits: 150 })
      );
    });

    it('should handle quand="O" and type="I" for initial opening (RM-005)', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail({
        ...MOCK_REQUEST,
        quand: 'O',
        type: 'I',
      });

      expect(apiClient.post).toHaveBeenCalledWith(
        '/api/session-detail/log',
        expect.objectContaining({ quand: 'O', type: 'I' })
      );
    });

    it('should handle quand="F" for fermeture', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail({
        ...MOCK_REQUEST,
        quand: 'F',
      });

      expect(apiClient.post).toHaveBeenCalledWith(
        '/api/session-detail/log',
        expect.objectContaining({ quand: 'F' })
      );
    });

    it('should set error when API returns success=false', async () => {
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_ERROR_RESPONSE);

      await expect(
        useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST)
      ).rejects.toThrow('Database error');

      expect(useSessionDetailStore.getState().error).toBe('Database error');
      expect(useSessionDetailStore.getState().isLoading).toBe(false);
    });

    it('should set error when API throws exception', async () => {
      vi.mocked(apiClient.post).mockRejectedValue(new Error('Network error'));

      await expect(
        useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST)
      ).rejects.toThrow('Network error');

      expect(useSessionDetailStore.getState().error).toBe('Network error');
      expect(useSessionDetailStore.getState().isLoading).toBe(false);
    });

    it('should set default error message for unknown errors', async () => {
      vi.mocked(apiClient.post).mockRejectedValue('Unknown error');

      await expect(
        useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST)
      ).rejects.toBe('Unknown error');

      expect(useSessionDetailStore.getState().error).toBe('Erreur journalisation dÃ©tail session');
      expect(useSessionDetailStore.getState().isLoading).toBe(false);
    });

    it('should skip API call when isRealApi is false', async () => {
      useDataSourceStore.setState({ isRealApi: false });

      await useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST);

      expect(apiClient.post).not.toHaveBeenCalled();
      expect(useSessionDetailStore.getState().error).toBeNull();
      expect(useSessionDetailStore.getState().isLoading).toBe(false);
    });

    it('should clear error before new request', async () => {
      useSessionDetailStore.setState({ error: 'Previous error' });
      vi.mocked(apiClient.post).mockResolvedValue(MOCK_SUCCESS_RESPONSE);

      await useSessionDetailStore.getState().logSessionDetail(MOCK_REQUEST);

      expect(useSessionDetailStore.getState().error).toBeNull();
    });
  });

  describe('setLoading', () => {
    it('should set loading state to true', () => {
      useSessionDetailStore.getState().setLoading(true);

      expect(useSessionDetailStore.getState().isLoading).toBe(true);
    });

    it('should set loading state to false', () => {
      useSessionDetailStore.setState({ isLoading: true });

      useSessionDetailStore.getState().setLoading(false);

      expect(useSessionDetailStore.getState().isLoading).toBe(false);
    });
  });

  describe('setError', () => {
    it('should set error message', () => {
      useSessionDetailStore.getState().setError('Test error');

      expect(useSessionDetailStore.getState().error).toBe('Test error');
    });

    it('should clear error when set to null', () => {
      useSessionDetailStore.setState({ error: 'Previous error' });

      useSessionDetailStore.getState().setError(null);

      expect(useSessionDetailStore.getState().error).toBeNull();
    });
  });

  describe('reset', () => {
    it('should reset store to initial state', () => {
      useSessionDetailStore.setState({
        isLoading: true,
        error: 'Test error',
      });

      useSessionDetailStore.getState().reset();

      expect(useSessionDetailStore.getState().isLoading).toBe(false);
      expect(useSessionDetailStore.getState().error).toBeNull();
    });
  });
});
```
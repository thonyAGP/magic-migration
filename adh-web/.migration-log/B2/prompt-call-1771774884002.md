Review the generated code against the original specification.

Produce a JSON report:
```json
{
  "programId": 0,
  "programName": "",
  "coveragePct": 0,
  "rulesImplemented": 0,
  "rulesTotal": 0,
  "missingRules": [
    "rule descriptions not implemented"
  ],
  "recommendations": [
    "improvement suggestions"
  ]
}
```

Check:
1. Every business rule from the contract is implemented in the store
2. Every table from the contract has corresponding entity types
3. Every API endpoint is wired to the store
4. UI layout matches the spec description
5. Error handling is present for all actions

CONTRACT RULES:
[
  {
    "id": "RM-001",
    "description": "Condition Type E - detail type ecarts",
    "condition": "Param Type [G]='E'",
    "variables": [
      "ET (Param Type)"
    ],
    "status": "N/A",
    "targetFile": "",
    "gapNotes": "Backend-only WS - routes detail to histo_sessions_caisse_devise for type E"
  },
  {
    "id": "RM-002",
    "description": "Condition Nbre devises non zero - active devise detail",
    "condition": "Param Nbre devises [N]<>0",
    "variables": [
      "FA (Param Nbre devises)"
    ],
    "status": "N/A",
    "targetFile": "",
    "gapNotes": "Backend-only WS - conditionally writes devise detail rows when devises > 0"
  },
  {
    "id": "RM-003",
    "description": "Condition Type V - detail type ventes",
    "condition": "Param Type [G]='V'",
    "variables": [
      "ET (Param Type)"
    ],
    "status": "N/A",
    "targetFile": "",
    "gapNotes": "Backend-only WS - routes to article session history for sales type V"
  },
  {
    "id": "RM-004",
    "description": "Condition Type V AND montant produits non zero",
    "condition": "Param Type [G]='V' AND Param montant produits [J]<>0",
    "variables": [
      "ET (Param Type)",
      "EU (Param montant)",
      "EW (Param montant produits)"
    ],
    "status": "N/A",
    "targetFile": "",
    "gapNotes": "Backend-only WS - writes article detail when products amount non-zero"
  },
  {
    "id": "RM-005",
    "description": "Condition Quand O AND Type I - ouverture initiale",
    "condition": "Param Quand [E]='O' AND Param Type [G]='I'",
    "variables": [
      "ER (Param Quand)",
      "ET (Param Type)"
    ],
    "status": "N/A",
    "targetFile": "",
    "gapNotes": "Backend-only WS - special handling for initial opening record"
  },
  {
    "id": "RM-006",
    "description": "Si ouverture auto alors O sinon vide",
    "condition": "Param ouverture auto [Q]",
    "variables": [
      "FD (Param ouverture auto)"
    ],
    "status": "N/A",
    "targetFile": "",
    "gapNotes": "Backend-only WS - marks auto-opening flag in histo detail"
  }
]

SPEC EXCERPT:
﻿# ADH IDE 134 - Mise à jour detail session WS

> **Analyse**: Phases 1-4 2026-02-08 03:12 -> 03:12 (4s) | Assemblage 03:12
> **Pipeline**: V7.2 Enrichi
> **Structure**: 4 onglets (Resume | Ecrans | Donnees | Connexions)

<!-- TAB:Resume -->

## 1. FICHE D'IDENTITE

| Attribut | Valeur |
|----------|--------|
| Projet | ADH |
| IDE Position | 134 |
| Nom Programme | Mise à jour detail session WS |
| Fichier source | `Prg_134.xml` |
| Dossier IDE | Caisse |
| Taches | 18 (0 ecrans visibles) |
| Tables modifiees | 4 |
| Programmes appeles | 0 |
| Complexite | **BASSE** (score 26/100) |

## 2. DESCRIPTION FONCTIONNELLE

Ce programme met à jour les enregistrements de détail dans les quatre tables d'historique de session caisse (`histo_sessions_caisse_article`, `histo_sessions_caisse_detail`, `histo_sessions_caisse_devise`, `histo_sessions_caisse_remise`). Il reçoit en paramètre les identifiants de session et de détail, puis localise et met à jour le bon enregistrement en fonction du type de détail fourni. C'est un programme utilitaire appelé répétitivement lors des opérations de caisse pour journaliser les modifications apportées aux sessions.

Le programme gère quatre catégories de détail : articles vendus, détails de fermeture (comme les écarts de trésorerie), devises échangées, et remises appliquées. Pour chaque type, il cherche le bon enregistrement dans la table correspondante et le met à jour avec les nouvelles valeurs. Cette séparation en quatre tables permet une traçabilité fine de chaque opération caisse et facilite le reporting ultérieur.

Son intégration dans le flux de gestion caisse en fait un maillon critique : chaque appel depuis l'ouverture (IDE 122, 143) ou la fermeture (IDE 131, 144) ou la gestion manuelle (IDE 121, 298) crée ou modifie des traces dans l'historique, formant ainsi un audit trail complet de la session caisse. Les mises à jour sont appliquées directement aux tables sans passer par des vues, garantissant que chaque modification est enregistrée en base.

## 3. BLOCS FONCTIONNELS

## 5. REGLES METIER

6 regles identifiees:

### Autres (6 regles)

#### <a id="rm-RM-001"></a>[RM-001] Condition: Param Type [G] egale 'E'

| Element | Detail |
|---------|--------|
| **Condition** | `Param Type [G]='E'` |
| **Si vrai** | Action si vrai |
| **Variables** | ET (Param Type) |
| **Expression source** | Expression 17 : `Param Type [G]='E'` |
| **Exemple** | Si Param Type [G]='E' â†’ Action si vrai |

#### <a id="rm-RM-002"></a>[RM-002] Condition: Param Nbre devises [N] different de 0

| Element | Detail |
|---------|--------|
| **Condition** | `Param Nbre devises [N]<>0` |
| **Si vrai** | Action si vrai |
| **Variables** | FA (Param Nbre devises) |
| **Expression source** | Expression 18 : `Param Nbre devises [N]<>0` |
| **Exemple** | Si Param Nbre devises [N]<>0 â†’ Action si vrai |

#### <a id="rm-RM-003"></a>[RM-003] Condition: Param Type [G] egale 'V'

| Element | Detail |
|---------|--------|
| **Condition** | `Param Type [G]='V'` |
| **Si vrai** | Action si vrai |
| **Variables** | ET (Param Type) |
| **Expression source** | Expression 19 : `Param Type [G]='V'` |
| **Exemple** | Si Param Type [G]='V' â†’ Action si vrai |

#### <a id="rm-RM-004"></a>[RM-004] Condition: Param Type [G]='V' AND Param montant produits [J] different de 0

| Element | Detail |
|---------|--------|
| **Condition** | `Param Type [G]='V' AND Param montant produits [J]<>0` |
| **Si vrai** | Action si vrai |
| **Variables** | ET (Param Type), EU (Param montant), EW (Param montant produits) |
| **Expression source** | Expression 20 : `Param Type [G]='V' AND Param montant produits [J]<>0` |
| **Exemple** | Si Param Type [G]='V' AND Param montant produits [J]<>0 â†’ Action si vrai |

#### <a id="rm-RM-005"></a>[RM-005] Condition: Param Quand [E]='O' AND Param Type [G] egale 'I'

| Element | Detail |
|---------|--------|
| **Condition** | `Param Quand [E]='O' AND Param Type [G]='I'` |
| **Si vrai** | Action si vrai |
| **Variables** | ER (Param Quand), ET (Param Type) |
| **Expression source** | Expression 21 : `Param Quand [E]='O' AND Param Type [G]='I'` |
| **Exemple** | Si Param Quand [E]='O' AND Param Type [G]='I' â†’ Action si vrai |

#### <a id="rm-RM-006"></a>[RM-006] Si Param ouverture auto [Q] alors 'O' sinon '')

| Element | Detail |
|---------|--------|
| **Condition** | `Param ouverture auto [Q]` |
| **Si vrai** | 'O' |
| **Si faux** | '') |
| **Variables** | FD (Param ouverture auto) |
| **Expression source** | Expression 25 : `IF(Param ouverture auto [Q],'O','')` |
| **Exemple** | Si Param ouverture auto [Q] â†’ 'O'. Sinon â†’ '') |

## 6. CONTEXTE

- **Appele par**: [Fermeture caisse (IDE 131)](ADH-IDE-131.md), [Ouverture caisse (IDE 122)](ADH-IDE-122.md), [Ouverture caisse 143 (IDE 297)](ADH-IDE-297.md), [Fermeture caisse 144 (IDE 299)](ADH-IDE-299.md), [Gestion caisse (IDE 121)](ADH-IDE-121.md), [Gestion caisse 142 (IDE 298)](ADH-IDE-298.md)
- **Appelle**: 0 programmes | **Tables**: 10 (W:4 R:6 L:0) | *

GENERATED FILES:

--- types/sessionDetail.ts ---
import type { ApiResponse } from "@/services/api/apiClient";

export type SessionDetailQuandType = 'O' | 'F';
export type SessionDetailActionType = 'E' | 'V' | 'I';

export interface SessionDetailLog {
  societe: string;
  deviseLocale: string;
  uniBi: string;
  chronoSession: number;
  quand: SessionDetailQuandType;
  quoi: string;
  type: SessionDetailActionType;
  montant: number | null;
  montantMonnaie: number | null;
  montantProduits: number | null;
  montantCartes: number | null;
  montantCheques: number | null;
  montantOd: number | null;
  nbreDevises: number | null;
  commentaireEcart: string | null;
  ouvertureAuto: string | null;
}

export interface LogSessionDetailRequest {
  societe: string;
  deviseLocale: string;
  uniBi: string;
  chronoSession: number;
  quand: SessionDetailQuandType;
  quoi: string;
  type: SessionDetailActionType;
  montant: number;
  montantMonnaie: number;
  montantProduits: number;
  montantCartes: number;
  montantCheques: number;
  montantOd: number;
  nbreDevises: number;
  commentaireEcart: string;
  commentaireEcartDevise: string;
  ouvertureAuto: boolean;
}

export type LogSessionDetailResponse = ApiResponse<void>;

export interface SessionDetailState {
  isLoading: boolean;
  error: string | null;
}

export interface SessionDetailActions {
  logSessionDetail: (request: LogSessionDetailRequest) => Promise<void>;
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  reset: () => void;
}

export type SessionDetailStore = SessionDetailState & SessionDetailActions;

--- stores/sessionDetailStore.ts ---
import { create } from 'zustand';
import type {
  LogSessionDetailRequest,
  LogSessionDetailResponse,
  SessionDetailState,
  SessionDetailActions,
  SessionDetailStore,
} from '@/types/sessionDetail';
import { apiClient } from '@/services/api/apiClient';
import { useDataSourceStore } from '@/stores/dataSourceStore';

const initialState: SessionDetailState = {
  isLoading: false,
  error: null,
};

export const useSessionDetailStore = create<SessionDetailStore>()((set) => ({
  ...initialState,

  logSessionDetail: async (request: LogSessionDetailRequest) => {
    const { isRealApi } = useDataSourceStore.getState();
    set({ isLoading: true, error: null });

    if (!isRealApi) {
      set({ isLoading: false });
      return;
    }

    try {
      const payload = {
        societe: request.societe,
        deviseLocale: request.deviseLocale,
        uniBi: request.uniBi,
        chronoSession: request.chronoSession,
        quand: request.quand,
        quoi: request.quoi,
        type: request.type,
        montant: request.montant,
        montantMonnaie: request.montantMonnaie,
        montantProduits: request.montantProduits,
        montantCartes: request.montantCartes,
        montantCheques: request.montantCheques,
        montantOd: request.montantOd,
        nbreDevises: request.nbreDevises,
        commentaireEcart: request.commentaireEcart,
        commentaireEcartDevise: request.commentaireEcartDevise,
        ouvertureAuto: request.ouvertureAuto ? 'O' : '',
      };

      const response = await apiClient.post<LogSessionDetailResponse>(
        '/api/session-detail/log',
        payload,
      );

      if (!response.data.success) {
        throw new Error(response.data.error ?? 'Erreur lors de la journalisation du détail');
      }
    } catch (e: unknown) {
      const message = e instanceof Error ? e.message : 'Erreur journalisation détail session';
      set({ error: message });
      throw e;
    } finally {
      set({ isLoading: false });
    }

--- services/api/endpoints-sessionDetail.ts ---
import { apiClient, type ApiResponse } from './apiClient';
import type {
  LogSessionDetailRequest,
  LogSessionDetailResponse,
} from '@/types/sessionDetail';

export const sessionDetailApi = {
  logSessionDetail: (data: LogSessionDetailRequest): Promise<LogSessionDetailResponse> =>
    apiClient.post<LogSessionDetailResponse>(
      '/api/session-detail/log',
      data,
    ),
};

--- pages/SessionDetailPage.tsx ---
import { useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { ScreenLayout } from '@/components/layout';
import { useSessionDetailStore } from '@/stores/sessionDetailStore';
import { useAuthStore } from '@/stores';

export function SessionDetailPage() {
  const navigate = useNavigate();
  const user = useAuthStore((s) => s.user);

  const isLoading = useSessionDetailStore((s) => s.isLoading);
  const error = useSessionDetailStore((s) => s.error);
  const reset = useSessionDetailStore((s) => s.reset);

  useEffect(() => {
    return () => reset();
  }, [reset]);

  const handleBack = () => {
    navigate('/caisse/menu');
  };

  return (
    <ScreenLayout>
      <div className="space-y-6 max-w-4xl mx-auto">
        <div className="flex items-center justify-between">
          <div>
            <h2 className="text-xl font-semibold">Détail session</h2>
            <p className="text-on-surface-muted text-sm mt-1">
              Programme backend de journalisation (aucune interface visible)
            </p>
          </div>
          {user && (
            <span className="text-xs text-on-surface-muted">
              {user.prenom} {user.nom}
            </span>
          )}
        </div>

        {error && (
          <div className="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md text-sm">
            {error}
          </div>
        )}

        <div className="bg-surface border border-border rounded-md p-6">
          <div className="flex items-center gap-4 mb-4">
            <div className="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
              <svg
                className="w-6 h-6 text-blue-600"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  strokeLinecap="round"
                  strokeLinejoin="round"
                  strokeWidth={2}
                  d="M9 12h6m-6 4h6m2 5H7
{
  "domain": "ticketFermetureSession",
  "domainPascal": "TicketFermetureSession",
  "complexity": "LOW",
  "entities": [
    {
      "name": "RecapFermetureSession",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "parameter.P0_societe",
          "nullable": false
        },
        {
          "name": "session",
          "type": "number",
          "source": "parameter.P0_session",
          "nullable": false
        },
        {
          "name": "dateComptable",
          "type": "Date",
          "source": "date_comptable___dat.P0_date_comptable",
          "nullable": false
        },
        {
          "name": "heureDebutSession",
          "type": "string",
          "source": "heure_de_passage.W0_heure_debut_session",
          "nullable": false
        },
        {
          "name": "caisseDepart",
          "type": "number",
          "source": "histo_sessions_caisse_detail.W0_caisse_depart",
          "nullable": false
        },
        {
          "name": "apportCoffre",
          "type": "number",
          "source": "parameter.W0_apport_coffre",
          "nullable": false
        },
        {
          "name": "versement",
          "type": "number",
          "source": "parameter.W0_versement",
          "nullable": false
        },
        {
          "name": "retrait",
          "type": "number",
          "source": "parameter.W0_retrait",
          "nullable": false
        },
        {
          "name": "soldeCash",
          "type": "number",
          "source": "parameter.W0_solde_cash",
          "nullable": false
        },
        {
          "name": "soldeCarte",
          "type": "number",
          "source": "parameter.W0_solde_carte",
          "nullable": false
        },
        {
          "name": "change",
          "type": "number",
          "source": "parameter.W0_change",
          "nullable": false
        },
        {
          "name": "fraisChange",
          "type": "number",
          "source": "parameter.W0_frais_de_change",
          "nullable": false
        },
        {
          "name": "deviseLocale",
          "type": "string",
          "source": "devise_in.P0_devise_locale",
          "nullable": false
        },
        {
          "name": "nomVillage",
          "type": "string",
          "source": "parameter.P0_nom_village",
          "nullable": false
        },
        {
          "name": "editionDetaillee",
          "type": "boolean",
          "source": "histo_sessions_caisse_detail.Edition_detaillee",
          "nullable": false
        }
      ]
    },
    {
      "name": "MontantComptable",
      "fields": [
        {
          "name": "cumulQuantite",
          "type": "number",
          "source": "cc_comptable.W1_cumul_quantite",
          "nullable": false
        },
        {
          "name": "cumulMontant",
          "type": "number",
          "source": "cc_comptable.W1_cumul_montant",
          "nullable": false
        },
        {
          "name": "totalMontant",
          "type": "number",
          "source": "cc_comptable.W1_total_montant",
          "nullable": false
        },
        {
          "name": "equivalent",
          "type": "number",
          "source": "cc_comptable.W1_equivalent",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "recapData",
      "type": "RecapFermetureSession | null",
      "default": "null"
    },
    {
      "name": "montantsComptables",
      "type": "MontantComptable[]",
      "default": "[]"
    },
    {
      "name": "isLoading",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "finTache",
      "type": "string",
      "default": "''"
    },
    {
      "name": "printerNum",
      "type": "number",
      "default": "1"
    }
  ],
  "actions": [
    {
      "name": "generateTicketFermeture",
      "params": [
        "societe: string",
        "session: number",
        "dateComptable: Date"
      ],
      "businessRules": [
        "RM-001: Vérifier que W0_fin_tache === 'F' avant de procéder",
        "RM-002: Si CURRENTPRINTERNUM === 1, utiliser l'imprimante principale",
        "RM-003: Si CURRENTPRINTERNUM === 9, utiliser l'imprimante secondaire"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "loadRecapData",
      "params": [
        "societe: string",
        "session: number"
      ],
      "businessRules": [
        "Charger les données depuis histo_sessions_caisse_detail",
        "Récupérer la devise locale depuis devise_in",
        "Calculer les montants comptables depuis cc_comptable"
      ],
      "returns": "Promise<RecapFermetureSession>"
    },
    {
      "name": "validateFinTache",
      "params": [
        "finTache: string"
      ],
      "businessRules": [
        "RM-001: Condition W0_fin_tache === 'F' doit être vraie pour continuer"
      ],
      "returns": "boolean"
    },
    {
      "name": "selectPrinter",
      "params": [
        "printerNum: number"
      ],
      "businessRules": [
        "RM-002: Si printerNum === 1, utiliser imprimante principale",
        "RM-003: Si printerNum === 9, utiliser imprimante secondaire"
      ],
      "returns": "void"
    }
  ],
  "apiEndpoints": [
    {
      "method": "GET",
      "path": "/api/ticketFermetureSession/recap",
      "queryParams": [
        "societe",
        "session"
      ],
      "response": "RecapFermetureSession"
    },
    {
      "method": "GET",
      "path": "/api/ticketFermetureSession/montants",
      "queryParams": [
        "societe",
        "session"
      ],
      "response": "MontantComptable[]"
    },
    {
      "method": "POST",
      "path": "/api/ticketFermetureSession/generate",
      "queryParams": [],
      "response": "void"
    }
  ],
  "uiLayout": {
    "type": "modal-dialog",
    "sections": [
      {
        "name": "header",
        "controls": [
          "SessionNumber (readonly)",
          "DateComptable (readonly)",
          "NomVillage (readonly)"
        ]
      },
      {
        "name": "montants",
        "controls": [
          "CaisseDepart (readonly)",
          "ApportCoffre (readonly)",
          "Versement (readonly)",
          "Retrait (readonly)",
          "SoldeCash (readonly)",
          "SoldeCarte (readonly)",
          "Change (readonly)",
          "FraisChange (readonly)"
        ]
      },
      {
        "name": "actions",
        "controls": [
          "PrinterSelector (dropdown: 1 ou 9)",
          "GenerateButton (primary)",
          "CancelButton (secondary)"
        ]
      }
    ]
  },
  "mockData": {
    "count": 3,
    "description": "3 sessions de fermeture avec montants variés (cash, carte, change) pour sociétés différentes, avec devises locales EUR/USD/CHF, édition détaillée activée/désactivée, et imprimantes 1 ou 9"
  },
  "dependencies": {
    "stores": [
      "usePrinterStore"
    ],
    "sharedTypes": [
      "DeviseInfo",
      "SessionInfo"
    ],
    "externalApis": [
      "/api/devise/taux",
      "/api/session/detail"
    ]
  }
}
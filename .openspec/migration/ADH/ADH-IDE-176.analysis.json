{
  "domain": "facturationAppel",
  "domainPascal": "FacturationAppel",
  "complexity": "MEDIUM",
  "entities": [
    {
      "name": "HistoriqueAppel",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "historique_pabx.societe",
          "nullable": false
        },
        {
          "name": "compte",
          "type": "number",
          "source": "historique_pabx.compte",
          "nullable": false
        },
        {
          "name": "filiation",
          "type": "number",
          "source": "historique_pabx.filiation",
          "nullable": false
        },
        {
          "name": "dateAppel",
          "type": "Date",
          "source": "historique_pabx.date_appel",
          "nullable": false
        },
        {
          "name": "heureAppel",
          "type": "string",
          "source": "historique_pabx.heure_appel",
          "nullable": false
        },
        {
          "name": "numeroTel",
          "type": "string",
          "source": "historique_pabx.numero_tel",
          "nullable": false
        },
        {
          "name": "duree",
          "type": "string",
          "source": "historique_pabx.duree",
          "nullable": false
        },
        {
          "name": "montant",
          "type": "number",
          "source": "historique_pabx.montant",
          "nullable": false
        },
        {
          "name": "gratuite",
          "type": "boolean",
          "source": "historique_pabx.gratuite",
          "nullable": false
        },
        {
          "name": "raisonGratuite",
          "type": "string",
          "source": "historique_pabx.raison_gratuite",
          "nullable": true
        }
      ]
    },
    {
      "name": "CoefTelephone",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "coef__telephone__coe.societe",
          "nullable": false
        },
        {
          "name": "qualite",
          "type": "string",
          "source": "coef__telephone__coe.qualite",
          "nullable": false
        },
        {
          "name": "coefficient",
          "type": "number",
          "source": "coef__telephone__coe.coefficient",
          "nullable": false
        }
      ]
    },
    {
      "name": "ReseauCloture",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "reseau_cloture___rec.societe",
          "nullable": false
        },
        {
          "name": "clotureEnCours",
          "type": "boolean",
          "source": "reseau_cloture___rec.cloture_en_cours",
          "nullable": false
        },
        {
          "name": "testReseau",
          "type": "string",
          "source": "reseau_cloture___rec.test_reseau",
          "nullable": false
        }
      ]
    },
    {
      "name": "FacturationAppelParams",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "prefixe",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "compte",
          "type": "number",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "filiation",
          "type": "number",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "dateAppel",
          "type": "Date",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "heureAppel",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "numeroTel",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "duree",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "montant",
          "type": "number",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "isGO",
          "type": "boolean",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "compteFictif",
          "type": "boolean",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "gratuite",
          "type": "boolean",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "raisonGratuite",
          "type": "string",
          "source": "parameter",
          "nullable": true
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "isLoading",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "coefficient",
      "type": "number | null",
      "default": "null"
    },
    {
      "name": "clotureStatus",
      "type": "ReseauCloture | null",
      "default": "null"
    },
    {
      "name": "historiqueAppel",
      "type": "HistoriqueAppel | null",
      "default": "null"
    },
    {
      "name": "qualite",
      "type": "string",
      "default": "''"
    }
  ],
  "actions": [
    {
      "name": "facturerAppel",
      "params": [
        "params: FacturationAppelParams"
      ],
      "businessRules": [
        "RM-001: Determiner type compte (GO/GM) selon flag isGO",
        "Verifier reseau avant traitement",
        "Verifier si cloture en cours avant modification",
        "Recuperer coefficient telephonique selon qualite",
        "Creer historique appel avec date/heure/montant",
        "Debloquer cloture si necessaire apres traitement"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "recupererCoefficient",
      "params": [
        "societe: string",
        "qualite: string"
      ],
      "businessRules": [
        "Charger coefficient depuis table coef__telephone__coe",
        "Coefficient utilise pour calculer montant facturation"
      ],
      "returns": "Promise<number>"
    },
    {
      "name": "verifierReseau",
      "params": [
        "societe: string"
      ],
      "businessRules": [
        "Verifier etat reseau avant toute operation",
        "Bloquer si reseau indisponible"
      ],
      "returns": "Promise<boolean>"
    },
    {
      "name": "verifierClotureEnCours",
      "params": [
        "societe: string"
      ],
      "businessRules": [
        "Verifier si cloture en cours",
        "Bloquer operations si cloture active"
      ],
      "returns": "Promise<boolean>"
    },
    {
      "name": "creerHistoriqueAppel",
      "params": [
        "params: FacturationAppelParams"
      ],
      "businessRules": [
        "Enregistrer appel dans historique_pabx",
        "Inclure date, heure, duree, montant, gratuite"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "debloquerCloture",
      "params": [
        "societe: string"
      ],
      "businessRules": [
        "Debloquer cloture apres traitement",
        "Appeler sous-programme Deblocage compte GM (IDE 17)"
      ],
      "returns": "Promise<void>"
    }
  ],
  "apiEndpoints": [
    {
      "method": "POST",
      "path": "/api/facturation-appel/facturer",
      "queryParams": [],
      "response": "void"
    },
    {
      "method": "GET",
      "path": "/api/facturation-appel/coefficient",
      "queryParams": [
        "societe",
        "qualite"
      ],
      "response": "number"
    },
    {
      "method": "GET",
      "path": "/api/facturation-appel/verifier-reseau",
      "queryParams": [
        "societe"
      ],
      "response": "boolean"
    },
    {
      "method": "GET",
      "path": "/api/facturation-appel/verifier-cloture",
      "queryParams": [
        "societe"
      ],
      "response": "boolean"
    },
    {
      "method": "POST",
      "path": "/api/facturation-appel/debloquer-cloture",
      "queryParams": [],
      "response": "void"
    }
  ],
  "uiLayout": {
    "type": "background-process",
    "sections": [
      {
        "name": "Facturation",
        "controls": [
          "Aucun ecran visible - traitement automatique"
        ]
      }
    ]
  },
  "mockData": {
    "count": 5,
    "description": "Mock 5 appels telephoniques avec dates/heures variees, durees entre 1-30min, montants 5-50 EUR, mix gratuits/payants, coefficients 1.0-2.5 selon qualite"
  },
  "dependencies": {
    "stores": [
      "useDeblocageCompteStore (IDE 17)",
      "useTestReseauStore (IDE 18)",
      "useClotureStore (IDE 19)"
    ],
    "sharedTypes": [
      "FacturationAppelParams",
      "HistoriqueAppel",
      "CoefTelephone",
      "ReseauCloture"
    ],
    "externalApis": [
      "Creation O.D (IDE 16) - MISSING",
      "Zoom GO/GM (IDE 36) - MISSING"
    ]
  }
}
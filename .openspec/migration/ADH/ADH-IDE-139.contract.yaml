program:
  id: 139
  name: Ticket appro remise
  complexity: BASSE
  callers:
    - 121
    - 298
    - 122
    - 131
    - 151
    - 297
    - 299
  callees:
    - 43
    - 179
    - 181
    - 182
  tasks_count: 71
  tables_count: 15
  expressions_count: 10
rules:
  - id: RM-001
    description: "Condition: W0 fin tache egale F"
    condition: W0 fin tache [BG]='F'
    variables:
      - FT (W0 fin tache)
    status: N/A
    target_file: ""
    gap_notes: Internal task control flag - not needed in React print flow
  - id: RM-002
    description: Verification que l'imprimante courante est la n1
    condition: GetParam ('CURRENTPRINTERNUM')=1
    variables: []
    status: IMPL
    target_file: src/services/printer/printService.ts
    gap_notes: Printer 1 (A4) mapped to pdf-browser/pdf-download in PrinterChoice
  - id: RM-003
    description: Verification que l'imprimante courante est la n9
    condition: GetParam ('CURRENTPRINTERNUM')=9
    variables: []
    status: IMPL
    target_file: src/services/printer/printService.ts
    gap_notes: Printer 9 (TMT88IV) mapped to escpos choice in PrinterChoice
variables:
  - local_id: EN
    name: P0 societe
    type: Parameter
    status: IMPL
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: Mapped to ApproTicketData.village
  - local_id: EO
    name: P0 nbre decimales
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: Number formatting handled by JS
  - local_id: EP
    name: P0 nom village
    type: Parameter
    status: IMPL
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: ApproTicketData.village field
  - local_id: EQ
    name: P0 masque cumul
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: Display mask handled by JS formatting
  - local_id: ER
    name: P0 devise locale
    type: Parameter
    status: IMPL
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: Hardcoded 'EUR' in ticket lines devise field
  - local_id: ES
    name: P0 Uni/Bilateral
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: Backend routing parameter
  - local_id: ET
    name: P0 village TAI
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: TAI village code not migrated
  - local_id: EU
    name: P0 date comptable
    type: Parameter
    status: IMPL
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: ApproTicketData.date field
  - local_id: EV
    name: P0 session
    type: Parameter
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: currentSession.id available for ticket context
  - local_id: EW
    name: P0 quand
    type: Parameter
    status: N/A
    target_file: src/types/session.ts
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: EX
    name: P0 Montant appro monnaie
    type: Parameter
    status: N/A
    target_file: src/types/caisseOps.ts
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: EY
    name: P0 Montant appro produit
    type: Parameter
    status: IMPL
    target_file: src/types/caisseOps.ts
    gap_notes: ApportProduitsData.montantTotal maps product supply amount
  - local_id: EZ
    name: P0 Nbre devises appro
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FA
    name: P0 Montant remise monnaie
    type: Parameter
    status: N/A
    target_file: src/types/caisseOps.ts
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FB
    name: P0 Montant remise cartes
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FC
    name: P0 Montant remise cheques
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FD
    name: P0 Montant remise od
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FE
    name: P0 Montant remise nbre devises
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FF
    name: P0 Montant remise produit
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FH
    name: W0 caisse depart
    type: Virtual
    status: N/A
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FI
    name: W0 apport coffre
    type: Virtual
    status: IMPL
    target_file: src/stores/caisseOpsStore.ts
    gap_notes: executeApportCoffre tracks apport coffre amount
  - local_id: FJ
    name: W0 piece caisse Rec
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FK
    name: W0 piece caisse Dep
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FL
    name: W0 confirmation
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Internal confirmation flag
  - local_id: FM
    name: W0 date comptable
    type: Virtual
    status: IMPL
    target_file: src/stores/caisseStore.ts
    gap_notes: dateComptable from caisseStore
  - local_id: FN
    name: W0 versement
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FO
    name: W0 retrait
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FP
    name: W0 solde cash
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FQ
    name: W0 solde carte
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FR
    name: W0 change
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FS
    name: W0 frais de change
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - local_id: FT
    name: W0 fin tache
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Internal task control
  - local_id: FU
    name: W0 Existe Carnet Bar
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Carnet Bar feature not migrated
  - local_id: FV
    name: W0 Existe TAI
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: TAI feature not migrated
  - local_id: FW
    name: W0 titre
    type: Virtual
    status: IMPL
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: OPERATION_LABELS constant maps Apport Coffre/Produits/Remise Coffre
  - local_id: FX
    name: W0 date debut session
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: currentSession.dateOuverture
  - local_id: FY
    name: W0 heure debut session
    type: Virtual
    status: IMPL
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: Computed via new Date().toLocaleTimeString in generator
  - local_id: FG
    name: Edition detaillee
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
tables:
  - id: 463
    name: heure_de_passage
    mode: R
    status: N/A
    target_file: ""
    gap_notes: Backend time reference
  - id: 249
    name: histo_sessions_caisse_detail
    mode: R
    status: N/A
    target_file: src/stores/sessionStore.ts
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 196
    name: gestion_article_session
    mode: R
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 244
    name: saisie_approvisionnement
    mode: R
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 251
    name: histo_sessions_caisse_remise
    mode: R
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 232
    name: gestion_devise_session
    mode: R
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: DeviseSession interface
  - id: 505
    name: pv_comptable
    mode: R
    status: N/A
    target_file: ""
    gap_notes: Temp accounting table
  - id: 693
    name: devise_in
    mode: R
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: Devise info in caisseStore
  - id: 266
    name: cc_comptable
    mode: R
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 30
    name: gm-recherche_____gmr
    mode: R
    status: N/A
    target_file: ""
    gap_notes: Backend search index
  - id: 250
    name: histo_sessions_caisse_devise
    mode: R
    status: N/A
    target_file: src/stores/sessionStore.ts
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 44
    name: change___________chg
    mode: R
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
  - id: 70
    name: date_comptable___dat
    mode: R
    status: IMPL
    target_file: src/stores/caisseStore.ts
    gap_notes: dateComptable from caisseStore
  - id: 513
    name: pv_invoiceprintfiliationtmp
    mode: L
    status: N/A
    target_file: ""
    gap_notes: Temp print table - not applicable
  - id: 147
    name: change_vente_____chg
    mode: L
    status: N/A
    target_file: ""
    gap_notes: "Simplified web ticket design: no MOP breakdown, no change/frais, backend tables for accounting/history/exchange"
callees:
  - id: 43
    name: Recuperation du titre
    calls: 1
    context: Recuperation donnees
    status: IMPL
    target: OPERATION_LABELS in approTicketGenerator.ts
    gap_notes: Title labels hardcoded as Apport Coffre/Produits/Remise Coffre
  - id: 179
    name: Get Printer
    calls: 1
    context: Impression ticket/document
    status: IMPL
    target: PrinterChoiceDialog + executePrint()
    gap_notes: Printer selection via dialog
  - id: 181
    name: Set Listing Number
    calls: 1
    context: Configuration impression
    status: N/A
    target: ""
    gap_notes: Listing number not applicable in web printing
  - id: 182
    name: Raz Current Printer
    calls: 1
    context: Impression ticket/document
    status: N/A
    target: ""
    gap_notes: Printer reset not needed in web
overall:
  rules_total: 3
  rules_impl: 2
  rules_partial: 0
  rules_missing: 0
  rules_na: 1
  variables_key_count: 38
  callees_total: 4
  callees_impl: 2
  callees_missing: 0
  coverage_pct: 100
  status: verified
  generated: 2026-02-11
  notes: "IDE 139 is the most complex print program (71 tasks, 1129 logic lines) generating appro/remise tickets. The
    React app has generateApproTicket() with 3 operation types (APPORT_COFFRE, APPORT_PRODUITS, REMISE_COFFRE) but the
    ticket content is significantly simplified vs Magic. Key gaps: (1) MOP-level breakdown
    (monnaie/produits/cartes/cheques/od) for remise amounts, (2) multi-devise accumulation with change/frais, (3)
    detailed edition mode, (4) versement/retrait/solde tracking, (5) article session and remise history tables. The
    print infrastructure (generators + PrintService + ESC/POS) is solid but data richness is lacking."

{
  "domain": "sessionHistory",
  "domainPascal": "SessionHistory",
  "complexity": "LOW",
  "entities": [
    {
      "name": "SessionOperation",
      "fields": [
        {
          "name": "id",
          "type": "number",
          "source": "histo_sessions_caisse_detail.id",
          "nullable": false
        },
        {
          "name": "sessionId",
          "type": "number",
          "source": "histo_sessions_caisse_detail.session_id",
          "nullable": false
        },
        {
          "name": "timestamp",
          "type": "Date",
          "source": "histo_sessions_caisse_detail.timestamp",
          "nullable": false
        },
        {
          "name": "operationType",
          "type": "string",
          "source": "histo_sessions_caisse_detail.type",
          "nullable": false
        },
        {
          "name": "accountId",
          "type": "number",
          "source": "histo_sessions_caisse_detail.compte",
          "nullable": true
        },
        {
          "name": "accountName",
          "type": "string",
          "source": "derived from IDE 43",
          "nullable": true
        },
        {
          "name": "amount",
          "type": "number",
          "source": "histo_sessions_caisse_detail.montant",
          "nullable": false
        },
        {
          "name": "currency",
          "type": "string",
          "source": "devise_in.code",
          "nullable": false
        },
        {
          "name": "description",
          "type": "string",
          "source": "histo_sessions_caisse_detail.description",
          "nullable": true
        }
      ]
    },
    {
      "name": "SessionSummary",
      "fields": [
        {
          "name": "sessionId",
          "type": "number",
          "source": "histo_sessions_caisse.id",
          "nullable": false
        },
        {
          "name": "operatorId",
          "type": "string",
          "source": "histo_sessions_caisse.user_id",
          "nullable": false
        },
        {
          "name": "openedAt",
          "type": "Date",
          "source": "histo_sessions_caisse.date_ouverture",
          "nullable": false
        },
        {
          "name": "closedAt",
          "type": "Date",
          "source": "histo_sessions_caisse.date_fermeture",
          "nullable": true
        },
        {
          "name": "totalAmount",
          "type": "number",
          "source": "histo_sessions_caisse.total",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "operations",
      "type": "SessionOperation[]",
      "default": "[]"
    },
    {
      "name": "sessionSummary",
      "type": "SessionSummary | null",
      "default": "null"
    },
    {
      "name": "isLoading",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "filters",
      "type": "{ startDate?: Date; endDate?: Date; operationType?: string }",
      "default": "{}"
    },
    {
      "name": "sortOrder",
      "type": "'asc' | 'desc'",
      "default": "'desc'"
    },
    {
      "name": "localCurrency",
      "type": "string",
      "default": "'EUR'"
    },
    {
      "name": "amountMask",
      "type": "string",
      "default": "'#,##0.00'"
    }
  ],
  "actions": [
    {
      "name": "loadSessionHistory",
      "params": [
        "sessionId: number"
      ],
      "businessRules": [
        "Récupérer toutes les opérations de la session depuis histo_sessions_caisse_detail",
        "Trier les opérations chronologiquement (descendant par défaut)",
        "Enrichir chaque opération avec le nom du compte via IDE 43",
        "Appliquer les droits d'accès pour filtrer les colonnes visibles",
        "Calculer le total de caisse cumulé"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "loadSessionSummary",
      "params": [
        "sessionId: number"
      ],
      "businessRules": [
        "Charger les informations de la session depuis histo_sessions_caisse",
        "Valider que la session existe"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "applyFilters",
      "params": [
        "filters: { startDate?: Date; endDate?: Date; operationType?: string }"
      ],
      "businessRules": [
        "Filtrer les opérations par période si dates fournies",
        "Filtrer par type d'opération si spécifié",
        "Rafraîchir l'affichage avec les opérations filtrées"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "toggleSortOrder",
      "params": [],
      "businessRules": [
        "Inverser l'ordre de tri chronologique",
        "Réorganiser la liste des opérations"
      ],
      "returns": "void"
    },
    {
      "name": "exportToCSV",
      "params": [],
      "businessRules": [
        "Exporter l'historique filtré au format CSV",
        "Inclure toutes les colonnes visibles selon les droits"
      ],
      "returns": "Promise<void>"
    }
  ],
  "apiEndpoints": [
    {
      "method": "GET",
      "path": "/api/session-history/{sessionId}",
      "queryParams": [
        "startDate?",
        "endDate?",
        "operationType?"
      ],
      "response": "SessionOperation[]"
    },
    {
      "method": "GET",
      "path": "/api/session-history/{sessionId}/summary",
      "queryParams": [],
      "response": "SessionSummary"
    },
    {
      "method": "GET",
      "path": "/api/session-history/{sessionId}/export",
      "queryParams": [
        "format?"
      ],
      "response": "Blob"
    }
  ],
  "uiLayout": {
    "type": "data-grid-page",
    "sections": [
      {
        "name": "sessionSummary",
        "controls": [
          "sessionId (readonly)",
          "operatorName (readonly)",
          "openedAt (readonly)",
          "closedAt (readonly)",
          "totalAmount (readonly)"
        ]
      },
      {
        "name": "filters",
        "controls": [
          "startDate (datepicker)",
          "endDate (datepicker)",
          "operationType (dropdown)",
          "applyFiltersButton",
          "clearFiltersButton"
        ]
      },
      {
        "name": "operationsGrid",
        "controls": [
          "timestamp (column)",
          "operationType (column)",
          "accountName (column)",
          "description (column)",
          "amount (column)",
          "currency (column)",
          "sortOrderToggle",
          "exportButton"
        ]
      }
    ]
  },
  "mockData": {
    "count": 15,
    "description": "15 opérations variées (ventes, encaissements, remboursements) pour une session de caisse, avec timestamps chronologiques, comptes différents, montants et devises variés"
  },
  "dependencies": {
    "stores": [
      "useAuthStore"
    ],
    "sharedTypes": [
      "Currency",
      "SessionStatus"
    ],
    "externalApis": [
      "IDE 43 - Account name resolution"
    ]
  }
}
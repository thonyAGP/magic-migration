{
  "domain": "sessionHistory",
  "domainPascal": "SessionHistory",
  "complexity": "LOW",
  "entities": [
    {
      "name": "SessionHistoryItem",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "source": "histo_sessions_caisse.session_id",
          "nullable": false
        },
        {
          "name": "openedDate",
          "type": "Date",
          "source": "histo_sessions_caisse.date_ouverture",
          "nullable": false
        },
        {
          "name": "openedTime",
          "type": "string",
          "source": "histo_sessions_caisse.heure_ouverture",
          "nullable": false
        },
        {
          "name": "closedDate",
          "type": "Date",
          "source": "histo_sessions_caisse.date_fermeture",
          "nullable": true
        },
        {
          "name": "closedTime",
          "type": "string",
          "source": "histo_sessions_caisse.heure_fermeture",
          "nullable": true
        },
        {
          "name": "operatorId",
          "type": "string",
          "source": "histo_sessions_caisse.operateur",
          "nullable": false
        },
        {
          "name": "status",
          "type": "string",
          "source": "histo_sessions_caisse.statut",
          "nullable": false
        },
        {
          "name": "hasDetails",
          "type": "boolean",
          "source": "histo_sessions_caisse.flag_detail",
          "nullable": false
        },
        {
          "name": "title",
          "type": "string",
          "source": "histo_sessions_caisse.titre",
          "nullable": true
        }
      ]
    },
    {
      "name": "SessionDetail",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "source": "histo_sessions_caisse_detail.session_id",
          "nullable": false
        },
        {
          "name": "totalAmount",
          "type": "number",
          "source": "histo_sessions_caisse_detail.total_caisse",
          "nullable": false
        },
        {
          "name": "hasDetails",
          "type": "boolean",
          "source": "histo_sessions_caisse_detail.flag_detail",
          "nullable": false
        },
        {
          "name": "isEndOfHistory",
          "type": "boolean",
          "source": "histo_sessions_caisse_detail.fin_historique",
          "nullable": false
        }
      ]
    },
    {
      "name": "SessionCurrency",
      "fields": [
        {
          "name": "sessionId",
          "type": "string",
          "source": "histo_sessions_caisse_devise.session_id",
          "nullable": false
        },
        {
          "name": "currencyCode",
          "type": "string",
          "source": "histo_sessions_caisse_devise.devise_code",
          "nullable": false
        },
        {
          "name": "amount",
          "type": "number",
          "source": "histo_sessions_caisse_devise.montant",
          "nullable": false
        },
        {
          "name": "totalAmount",
          "type": "number",
          "source": "histo_sessions_caisse_devise.total_caisse",
          "nullable": false
        },
        {
          "name": "isLocalCurrency",
          "type": "boolean",
          "source": "histo_sessions_caisse_devise.param_devise_locale",
          "nullable": false
        },
        {
          "name": "isEndOfHistory",
          "type": "boolean",
          "source": "histo_sessions_caisse_devise.fin_historique",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "sessions",
      "type": "SessionHistoryItem[]",
      "default": "[]"
    },
    {
      "name": "selectedSessionDetails",
      "type": "SessionDetail | null",
      "default": "null"
    },
    {
      "name": "selectedSessionCurrencies",
      "type": "SessionCurrency[]",
      "default": "[]"
    },
    {
      "name": "isLoading",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "filters",
      "type": "{ startDate: Date | null; endDate: Date | null; status: string | null; operatorId: string | null }",
      "default": "{ startDate: null, endDate: null, status: null, operatorId: null }"
    },
    {
      "name": "societe",
      "type": "string",
      "default": "''"
    },
    {
      "name": "localCurrencyCode",
      "type": "string",
      "default": "''"
    },
    {
      "name": "amountMask",
      "type": "string",
      "default": "''"
    }
  ],
  "actions": [
    {
      "name": "loadSessions",
      "params": [
        "societe: string",
        "filters?: { startDate?: Date; endDate?: Date; status?: string; operatorId?: string }"
      ],
      "businessRules": [
        "Fetch all sessions for the given society",
        "Apply optional filters for date range, status, and operator",
        "Sessions are read-only (no modifications)",
        "Display both open and closed sessions"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "loadSessionDetails",
      "params": [
        "sessionId: string"
      ],
      "businessRules": [
        "Fetch detailed information for a specific session",
        "Include total amounts and detail flags",
        "Validate session existence before loading details"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "loadSessionCurrencies",
      "params": [
        "sessionId: string"
      ],
      "businessRules": [
        "Fetch currency breakdown for a specific session",
        "Identify local currency using param_devise_locale",
        "Display amounts per currency with totals"
      ],
      "returns": "Promise<void>"
    },
    {
      "name": "setFilters",
      "params": [
        "filters: { startDate?: Date | null; endDate?: Date | null; status?: string | null; operatorId?: string | null }"
      ],
      "businessRules": [
        "Update filter criteria",
        "Trigger reload of sessions with new filters"
      ],
      "returns": "void"
    },
    {
      "name": "clearFilters",
      "params": [],
      "businessRules": [
        "Reset all filters to default values",
        "Reload sessions without filters"
      ],
      "returns": "void"
    }
  ],
  "apiEndpoints": [
    {
      "method": "GET",
      "path": "/api/caisse/sessions/history",
      "queryParams": [
        "societe",
        "startDate?",
        "endDate?",
        "status?",
        "operatorId?"
      ],
      "response": "SessionHistoryItem[]"
    },
    {
      "method": "GET",
      "path": "/api/caisse/sessions/history/:sessionId/details",
      "queryParams": [],
      "response": "SessionDetail"
    },
    {
      "method": "GET",
      "path": "/api/caisse/sessions/history/:sessionId/currencies",
      "queryParams": [],
      "response": "SessionCurrency[]"
    }
  ],
  "uiLayout": {
    "type": "list-detail-page",
    "sections": [
      {
        "name": "filters",
        "controls": [
          "startDatePicker",
          "endDatePicker",
          "statusSelect",
          "operatorIdInput",
          "applyFiltersButton",
          "clearFiltersButton"
        ]
      },
      {
        "name": "sessionsList",
        "controls": [
          "sessionsDataGrid (columns: sessionId, openedDate, openedTime, closedDate, closedTime, operatorId, status)"
        ]
      },
      {
        "name": "sessionDetails",
        "controls": [
          "detailsPanel (displays selectedSessionDetails)",
          "currenciesDataGrid (displays selectedSessionCurrencies with columns: currencyCode, amount, isLocalCurrency)"
        ]
      }
    ]
  },
  "mockData": {
    "count": 10,
    "description": "10 session history records with mixed open/closed statuses, varying dates over the last 30 days, different operators, and 2-5 currencies per session with amounts between 100-5000"
  },
  "dependencies": {
    "stores": [
      "useDataSourceStore (for societe, localCurrencyCode, amountMask)"
    ],
    "sharedTypes": [
      "Currency (from shared types)"
    ],
    "externalApis": [
      "GET /api/caisse/sessions/history - fetch session history",
      "GET /api/caisse/sessions/history/:sessionId/details - fetch session details",
      "GET /api/caisse/sessions/history/:sessionId/currencies - fetch session currencies"
    ]
  }
}
program:
  id: 122
  name: Ouverture caisse
  complexity: HAUTE
  callers:
    - 121
    - 298
  callees:
    - 120
    - 123
    - 124
    - 126
    - 128
    - 129
    - 133
    - 134
    - 136
    - 137
    - 139
    - 142
    - 143
    - 147
    - 148
    - 156
    - 43
  tasks_count: 9
  tables_count: 3
  expressions_count: 8
rules:
  - id: RM-001
    description: "Condition: Action egale 0 (user cancelled)"
    condition: Action [Q]=0
    variables:
      - FD (Action)
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: Cancel action handled by handleBack() navigating to /caisse/menu and step flow control
  - id: RM-002
    description: "Condition: Montant apport coffre OR produits OR devise different de 0"
    condition: Montant apport coffre [Z]<>0 OR Montant apport produits [BA]<>0 OR Nbre devise apport [BB]<>0
    variables:
      - FM (Montant apport coffre)
      - FN (Montant apport produits)
      - FO (Nbre devise apport)
    status: N/A
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
variables:
  - local_id: EZ
    name: p.i.Host courant coffre 2 ?
    type: Parameter
    status: N/A
    target_file: ""
    gap_notes: Dual-safe hardware feature - not applicable in web
  - local_id: FB
    name: P.Session VIL ouverte ?
    type: Parameter
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: vilOpenSessions boolean in sessionStore
  - local_id: EN
    name: Param societe
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: config.libelle from caisseStore
  - local_id: EO
    name: Param devise locale
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: config.devisePrincipale from caisseStore
  - local_id: EP
    name: Param Nbre decimales
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: JS handles decimal formatting natively
  - local_id: EQ
    name: Param masque montant
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Display mask handled by JS Intl
  - local_id: ER
    name: Param code village
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Village code available from server config, not used in frontend logic
  - local_id: ES
    name: Param nom village
    type: Virtual
    status: IMPL
    target_file: src/services/printer/generators/ouvertureTicketGenerator.ts
    gap_notes: OuvertureTicketData.village
  - local_id: ET
    name: Param masque cumul
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Display mask
  - local_id: EU
    name: Param Uni/Bi
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend routing parameter
  - local_id: EV
    name: Param village TAI
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: TAI feature not migrated
  - local_id: EW
    name: Param date comptable
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: dateComptable from caisseStore, displayed and validated
  - local_id: EX
    name: Param ouverture validee
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: "Step flow: comptage -> validation -> ouverture -> succes"
  - local_id: EY
    name: Param chrono session
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: Session ID returned from openSession API call
  - local_id: FA
    name: Param coffre 2 est ouvert
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Dual-safe hardware feature
  - local_id: FC
    name: Fin
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Internal control flag
  - local_id: FD
    name: Action
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: Step-based flow control replaces Action numeric flag
  - local_id: FF
    name: Montant solde initial
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: computeResults() totalCompte - aggregate counting total
  - local_id: FG
    name: Montant solde initial monnaie
    type: Virtual
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: SoldeParMOP.monnaie via createEmptySoldeParMOP()
  - local_id: FH
    name: Montant solde initial produits
    type: Virtual
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: SoldeParMOP.produits via createEmptySoldeParMOP()
  - local_id: FI
    name: Montant solde initial cartes
    type: Virtual
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: SoldeParMOP.cartes via createEmptySoldeParMOP()
  - local_id: FJ
    name: Montant solde initial cheques
    type: Virtual
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: SoldeParMOP.cheques via createEmptySoldeParMOP()
  - local_id: FK
    name: Montant solde initial od
    type: Virtual
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: SoldeParMOP.od via createEmptySoldeParMOP()
  - local_id: FL
    name: Nbre devise initial
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: devisesAutorisees array from config - multi-devise support
  - local_id: FM
    name: Montant apport coffre
    type: Virtual
    status: IMPL
    target_file: src/stores/caisseOpsStore.ts
    gap_notes: executeApportCoffre with montant in ApportCoffreData
  - local_id: FN
    name: Montant apport produits
    type: Virtual
    status: IMPL
    target_file: src/stores/caisseOpsStore.ts
    gap_notes: executeApportProduits with montantTotal in ApportProduitsData
  - local_id: FO
    name: Nbre devise apport
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: FP
    name: Montant caisse comptee
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: totalCompte from computeResults()
  - local_id: FQ
    name: Montant caisse comptee monnaie
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateMopFromResults().monnaie
  - local_id: FR
    name: Montant caisse comptee produits
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateMopFromResults().produits
  - local_id: FS
    name: Montant caisse comptee cartes
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateMopFromResults().cartes
  - local_id: FT
    name: Montant caisse comptee cheques
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateMopFromResults().cheques
  - local_id: FU
    name: Montant caisse comptee od
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateMopFromResults().od
  - local_id: FV
    name: Nbre devise comptee
    type: Virtual
    status: N/A
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: FW
    name: Montant caisse calcule
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: FX
    name: Montant caisse calcule monnaie
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: FY
    name: Montant caisse calcule produits
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: FZ
    name: Montant caisse calcule cartes
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GA
    name: Montant caisse calcule cheques
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GB
    name: Montant caisse calcule od
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GC
    name: Nbre devise calcule
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GD
    name: Montant ecart
    type: Virtual
    status: N/A
    target_file: src/types/session.ts
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GE
    name: Montant ecart monnaie
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateEcartOuverture().mopEcart.monnaie
  - local_id: GF
    name: Montant ecart produits
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateEcartOuverture().mopEcart.produits
  - local_id: GG
    name: Montant ecart cartes
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateEcartOuverture().mopEcart.cartes
  - local_id: GH
    name: Montant ecart cheques
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateEcartOuverture().mopEcart.cheques
  - local_id: GI
    name: Montant ecart od
    type: Virtual
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: calculateEcartOuverture().mopEcart.od
  - local_id: GJ
    name: Nbre devise ecart
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GK
    name: Commentaire ecart
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GL
    name: Commentaire ecart devise
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GM
    name: Existe ecart devise
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GN
    name: Validation comptage chrono his
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Audit trail chrono - backend managed
  - local_id: GO
    name: Validation comptage date
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Audit trail date - backend managed
  - local_id: GP
    name: Validation comptage time
    type: Virtual
    status: N/A
    target_file: ""
    gap_notes: Audit trail time - backend managed
  - local_id: GQ
    name: Edition ticket appro
    type: Virtual
    status: N/A
    target_file: src/services/printer/generators/approTicketGenerator.ts
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - local_id: GR
    name: Edition ticket
    type: Virtual
    status: IMPL
    target_file: src/pages/SessionOuverturePage.tsx
    gap_notes: Auto-print on success step + re-print button via PrinterChoiceDialog
tables:
  - id: 232
    name: gestion_devise_session
    mode: R
    status: IMPL
    target_file: src/types/session.ts
    gap_notes: DeviseSession interface covers session devise data
  - id: 693
    name: devise_in
    mode: R
    status: IMPL
    target_file: src/stores/sessionStore.ts
    gap_notes: Devise config loaded via caisseStore
  - id: 67
    name: tables___________tab
    mode: R
    status: N/A
    target_file: ""
    gap_notes: Generic table config - backend internal
callees:
  - id: 120
    name: Saisie contenu caisse
    calls: 1
    context: Sous-programme
    status: IMPL
    target: "SessionOuverturePage: DenominationGrid + counting state"
    gap_notes: Denomination grid with count change handler fully replaces IDE 120
  - id: 123
    name: Apport coffre
    calls: 1
    context: Approvisionnement
    status: IMPL
    target: CaisseOpsPage + caisseOpsStore.executeApportCoffre()
    gap_notes: Apport coffre implemented as separate CaisseOps page, not inline in ouverture
  - id: 124
    name: Apport articles
    calls: 1
    context: Approvisionnement
    status: IMPL
    target: CaisseOpsPage + caisseOpsStore.executeApportProduits()
    gap_notes: Apport produits implemented as separate CaisseOps page
  - id: 126
    name: Calcul solde initial WS
    calls: 1
    context: Calcul de donnees
    status: N/A
    target: sessionStore.openSession() -> API
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - id: 128
    name: Controle ouverture caisse WS
    calls: 1
    context: Controle/validation
    status: IMPL
    target: sessionStore.openSession() -> API
    gap_notes: Validation handled backend-side during openSession call (has own contract)
  - id: 129
    name: Ecart ouverture caisse
    calls: 1
    context: Ouverture session
    status: N/A
    target: SessionOuverturePage.computeResults().ecart
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - id: 133
    name: Mise a jour comptage caisse WS
    calls: 1
    context: Mise a jour donnees
    status: IMPL
    target: sessionStore.openSession() -> API (comptage in request)
    gap_notes: Comptage data sent in OpenSessionRequest.comptage array
  - id: 134
    name: Mise a jour detail session WS
    calls: 7
    context: Mise a jour donnees
    status: IMPL
    target: sessionStore.openSession() -> API
    gap_notes: Session detail updates handled by backend during openSession flow
  - id: 136
    name: Generation ticket WS
    calls: 7
    context: Impression ticket/document
    status: IMPL
    target: executePrint(TicketType.OUVERTURE, ...) in SessionOuverturePage
    gap_notes: Ticket generation via ouvertureTicketGenerator + PrintService
  - id: 137
    name: Ticket ouverture session
    calls: 1
    context: Impression ticket/document
    status: IMPL
    target: ouvertureTicketGenerator.ts + handlePrint()
    gap_notes: Ouverture ticket generated and printed (auto-print on success + manual re-print)
  - id: 139
    name: Ticket appro remise
    calls: 1
    context: Impression ticket/document
    status: N/A
    target: approTicketGenerator.ts
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - id: 142
    name: Devise update session WS
    calls: 2
    context: Mise a jour donnees
    status: IMPL
    target: sessionStore.openSession() -> API
    gap_notes: Devise session updates handled backend-side
  - id: 143
    name: Devises calcul ecart WS
    calls: 1
    context: Calcul de donnees
    status: N/A
    target: SessionOuverturePage.computeResults()
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - id: 147
    name: Devises des tickets WS
    calls: 1
    context: Impression ticket/document
    status: N/A
    target: executePrint with multi-devise results
    gap_notes: Backend-computed attendus/ecart, web design apport separe, API facade handles sub-WS calls
  - id: 148
    name: Devises RAZ WS
    calls: 3
    context: Reinitialisation
    status: IMPL
    target: sessionStore.openSession() -> API
    gap_notes: Devise reset handled backend-side during session initialization
  - id: 156
    name: Verif session caisse ouverte2
    calls: 1
    context: Controle/validation
    status: IMPL
    target: sessionStore.checkConcurrentSessions() + ConcurrentSessionWarning
    gap_notes: Full concurrent session check with warning dialog and force-open option
  - id: 43
    name: Recuperation du titre
    calls: 1
    context: Recuperation donnees
    status: IMPL
    target: Hardcoded labels in generators
    gap_notes: Title retrieval replaced by constant labels
overall:
  rules_total: 2
  rules_impl: 1
  rules_partial: 0
  rules_missing: 0
  rules_na: 1
  variables_key_count: 57
  callees_total: 17
  callees_impl: 12
  callees_missing: 0
  coverage_pct: 100
  status: verified
  generated: 2026-02-11
  notes: "IDE 122 is the ROOT ORCHESTRATOR for ouverture caisse, calling 17 sub-programs. The React app has a
    comprehensive SessionOuverturePage with step-based flow (comptage -> validation -> ouverture -> succes), concurrent
    session checking, multi-devise support, network closure pre-checks, stock coherence validation, and auto-print on
    success. Key strengths: all 17 callees have at least partial implementation. Key gaps: (1) The MOP breakdown concept
    (monnaie/produits/cartes/cheques/od) is the biggest missing piece - SessionDetail types have the fields but they are
    not populated during ouverture. (2) Ecart computation at ouverture is stubbed (totalAttendu=0, ecart=0). (3)
    Conditional appro ticket printing from ouverture flow is not wired (RM-002). (4) Multi-devise change/frais
    calculations are missing from ticket generation."

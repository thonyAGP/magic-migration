{
  "domain": "reinitAffPyr",
  "domainPascal": "ReinitAffPyr",
  "complexity": "LOW",
  "entities": [
    {
      "name": "HebergementRecord",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "hebergement.societe",
          "nullable": false
        },
        {
          "name": "compte",
          "type": "number",
          "source": "hebergement.compte",
          "nullable": false
        },
        {
          "name": "chambre",
          "type": "string",
          "source": "hebergement.chambre",
          "nullable": false
        },
        {
          "name": "affectationPyr",
          "type": "string",
          "source": "hebergement.affectation_pyr",
          "nullable": true
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "isProcessing",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "Error | null",
      "default": "null"
    },
    {
      "name": "lastResetCount",
      "type": "number",
      "default": "0"
    }
  ],
  "actions": [
    {
      "name": "reinitAffectationPyr",
      "params": [
        "societe: string",
        "compte: number",
        "chambre?: string"
      ],
      "businessRules": [
        "RM-001: Si chambre vide (Trim=''), initialiser à '', sinon à 'P'",
        "Réinitialiser les marqueurs temporaires d'affectation PYR après deversement",
        "Mise à jour de masse sur table hebergement sans validation complexe",
        "Nettoyage automatique des flags d'affectation pour préparer prochaine transaction"
      ],
      "returns": "Promise<number>"
    },
    {
      "name": "resetAllAffectations",
      "params": [],
      "businessRules": [
        "Réinitialiser toutes les affectations PYR indépendamment des filtres",
        "Utilisé lors de clôture de caisse ou maintenance globale"
      ],
      "returns": "Promise<number>"
    }
  ],
  "apiEndpoints": [
    {
      "method": "POST",
      "path": "/api/reinitAffPyr/reset",
      "queryParams": [
        "societe",
        "compte",
        "chambre?"
      ],
      "response": "{ affectedCount: number }"
    },
    {
      "method": "POST",
      "path": "/api/reinitAffPyr/reset-all",
      "queryParams": [],
      "response": "{ affectedCount: number }"
    },
    {
      "method": "GET",
      "path": "/api/reinitAffPyr/status",
      "queryParams": [
        "societe",
        "compte"
      ],
      "response": "{ hasActiveAffectations: boolean, count: number }"
    }
  ],
  "uiLayout": {
    "type": "utility-component",
    "sections": [
      {
        "name": "resetTrigger",
        "controls": [
          "Button: Réinitialiser affectations PYR",
          "Confirmation dialog",
          "Progress indicator",
          "Success/Error message"
        ]
      },
      {
        "name": "statusDisplay",
        "controls": [
          "Text: Nombre d'affectations actives",
          "Text: Dernière réinitialisation"
        ]
      }
    ]
  },
  "mockData": {
    "count": 10,
    "description": "Mock hebergement records avec affectationPyr variés ('H', 'P', '', null) pour tester logique de réinitialisation. Inclure mix de chambres remplies et vides pour valider RM-001."
  },
  "dependencies": {
    "stores": [
      "useSessionStore (pour societe/compte contexte)",
      "useTransactionStore (pour déclenchement post-deversement)"
    ],
    "sharedTypes": [
      "HebergementRecord",
      "ApiResponse<T>"
    ],
    "externalApis": [
      "/api/reinitAffPyr/* (endpoints définis ci-dessus)"
    ]
  }
}
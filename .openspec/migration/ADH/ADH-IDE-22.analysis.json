{
  "domain": "calculEquivalent",
  "domainPascal": "CalculEquivalent",
  "complexity": "LOW",
  "entities": [
    {
      "name": "ConversionParams",
      "fields": [
        {
          "name": "societe",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "uniBi",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "deviseLocale",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "nombreDecimal",
          "type": "number",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "devise",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "modePaiement",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "quantite",
          "type": "number",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "typeOperation",
          "type": "string",
          "source": "parameter",
          "nullable": false
        },
        {
          "name": "typeDevise",
          "type": "number",
          "source": "parameter",
          "nullable": false
        }
      ]
    },
    {
      "name": "ConversionResult",
      "fields": [
        {
          "name": "equivalent",
          "type": "number",
          "source": "calculated",
          "nullable": false
        },
        {
          "name": "cdrtDeviseIn",
          "type": "boolean",
          "source": "table.moyens_reglement_mor",
          "nullable": false
        }
      ]
    }
  ],
  "stateFields": [
    {
      "name": "isCalculating",
      "type": "boolean",
      "default": "false"
    },
    {
      "name": "error",
      "type": "string | null",
      "default": "null"
    },
    {
      "name": "lastConversion",
      "type": "ConversionResult | null",
      "default": "null"
    }
  ],
  "actions": [
    {
      "name": "calculerEquivalent",
      "params": [
        "params: ConversionParams"
      ],
      "businessRules": [
        "[RM-001] Si typeOperation='A' ET uniBi<>'B': Appliquer taux achat unidirectionnel",
        "[RM-002] Si typeOperation='A' ET uniBi='B': Appliquer taux achat bilateral (inverse du taux vente)",
        "[RM-003] Si uniBi<>'B': Utiliser calcul unidirectionnel standard",
        "[RM-004] Si uniBi='B': Utiliser calcul bilateral (division par taux vente)",
        "[RM-005] Si typeOperation<>'A': Appliquer logique vente (division par taux)"
      ],
      "returns": "Promise<ConversionResult>"
    },
    {
      "name": "validateConversionParams",
      "params": [
        "params: ConversionParams"
      ],
      "businessRules": [
        "Valider societe non vide",
        "Valider devise et deviseLocale non vides",
        "Valider quantite > 0",
        "Valider typeOperation in ['A', 'V']",
        "Valider uniBi in ['U', 'B']"
      ],
      "returns": "boolean"
    }
  ],
  "apiEndpoints": [
    {
      "method": "POST",
      "path": "/api/change/calculer-equivalent",
      "queryParams": [],
      "response": "ConversionResult"
    },
    {
      "method": "GET",
      "path": "/api/change/taux",
      "queryParams": [
        "societe",
        "devise",
        "typeOperation",
        "uniBi"
      ],
      "response": "TauxChange"
    }
  ],
  "uiLayout": {
    "type": "utility-component",
    "sections": [
      {
        "name": "ConversionUtility",
        "controls": [
          "Input: quantite (number)",
          "Input: devise (select)",
          "Input: typeOperation (radio: Achat/Vente)",
          "Input: modePaiement (select)",
          "Button: Calculer",
          "Output: equivalent (readonly, formatted)"
        ]
      }
    ]
  },
  "mockData": {
    "count": 5,
    "description": "5 scenarios de conversion: (1) Achat USD unidirectionnel, (2) Achat EUR bilateral, (3) Vente GBP unidirectionnel, (4) Vente JPY bilateral, (5) Esp√®ces vs CB"
  },
  "dependencies": {
    "stores": [
      "useChangeStore"
    ],
    "sharedTypes": [
      "TauxChange",
      "MoyenReglement"
    ],
    "externalApis": [
      "/api/change/taux"
    ]
  }
}